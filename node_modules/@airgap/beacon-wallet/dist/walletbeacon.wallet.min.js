(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.beacon=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var int_1=require("@stablelib/int");function readInt16BE(array,offset){if(offset===void 0){offset=0}return(array[offset+0]<<8|array[offset+1])<<16>>16}exports.readInt16BE=readInt16BE;function readUint16BE(array,offset){if(offset===void 0){offset=0}return(array[offset+0]<<8|array[offset+1])>>>0}exports.readUint16BE=readUint16BE;function readInt16LE(array,offset){if(offset===void 0){offset=0}return(array[offset+1]<<8|array[offset])<<16>>16}exports.readInt16LE=readInt16LE;function readUint16LE(array,offset){if(offset===void 0){offset=0}return(array[offset+1]<<8|array[offset])>>>0}exports.readUint16LE=readUint16LE;function writeUint16BE(value,out,offset){if(out===void 0){out=new Uint8Array(2)}if(offset===void 0){offset=0}out[offset+0]=value>>>8;out[offset+1]=value>>>0;return out}exports.writeUint16BE=writeUint16BE;exports.writeInt16BE=writeUint16BE;function writeUint16LE(value,out,offset){if(out===void 0){out=new Uint8Array(2)}if(offset===void 0){offset=0}out[offset+0]=value>>>0;out[offset+1]=value>>>8;return out}exports.writeUint16LE=writeUint16LE;exports.writeInt16LE=writeUint16LE;function readInt32BE(array,offset){if(offset===void 0){offset=0}return array[offset]<<24|array[offset+1]<<16|array[offset+2]<<8|array[offset+3]}exports.readInt32BE=readInt32BE;function readUint32BE(array,offset){if(offset===void 0){offset=0}return(array[offset]<<24|array[offset+1]<<16|array[offset+2]<<8|array[offset+3])>>>0}exports.readUint32BE=readUint32BE;function readInt32LE(array,offset){if(offset===void 0){offset=0}return array[offset+3]<<24|array[offset+2]<<16|array[offset+1]<<8|array[offset]}exports.readInt32LE=readInt32LE;function readUint32LE(array,offset){if(offset===void 0){offset=0}return(array[offset+3]<<24|array[offset+2]<<16|array[offset+1]<<8|array[offset])>>>0}exports.readUint32LE=readUint32LE;function writeUint32BE(value,out,offset){if(out===void 0){out=new Uint8Array(4)}if(offset===void 0){offset=0}out[offset+0]=value>>>24;out[offset+1]=value>>>16;out[offset+2]=value>>>8;out[offset+3]=value>>>0;return out}exports.writeUint32BE=writeUint32BE;exports.writeInt32BE=writeUint32BE;function writeUint32LE(value,out,offset){if(out===void 0){out=new Uint8Array(4)}if(offset===void 0){offset=0}out[offset+0]=value>>>0;out[offset+1]=value>>>8;out[offset+2]=value>>>16;out[offset+3]=value>>>24;return out}exports.writeUint32LE=writeUint32LE;exports.writeInt32LE=writeUint32LE;function readInt64BE(array,offset){if(offset===void 0){offset=0}var hi=readInt32BE(array,offset);var lo=readInt32BE(array,offset+4);return hi*4294967296+lo-(lo>>31)*4294967296}exports.readInt64BE=readInt64BE;function readUint64BE(array,offset){if(offset===void 0){offset=0}var hi=readUint32BE(array,offset);var lo=readUint32BE(array,offset+4);return hi*4294967296+lo}exports.readUint64BE=readUint64BE;function readInt64LE(array,offset){if(offset===void 0){offset=0}var lo=readInt32LE(array,offset);var hi=readInt32LE(array,offset+4);return hi*4294967296+lo-(lo>>31)*4294967296}exports.readInt64LE=readInt64LE;function readUint64LE(array,offset){if(offset===void 0){offset=0}var lo=readUint32LE(array,offset);var hi=readUint32LE(array,offset+4);return hi*4294967296+lo}exports.readUint64LE=readUint64LE;function writeUint64BE(value,out,offset){if(out===void 0){out=new Uint8Array(8)}if(offset===void 0){offset=0}writeUint32BE(value/4294967296>>>0,out,offset);writeUint32BE(value>>>0,out,offset+4);return out}exports.writeUint64BE=writeUint64BE;exports.writeInt64BE=writeUint64BE;function writeUint64LE(value,out,offset){if(out===void 0){out=new Uint8Array(8)}if(offset===void 0){offset=0}writeUint32LE(value>>>0,out,offset);writeUint32LE(value/4294967296>>>0,out,offset+4);return out}exports.writeUint64LE=writeUint64LE;exports.writeInt64LE=writeUint64LE;function readUintBE(bitLength,array,offset){if(offset===void 0){offset=0}if(bitLength%8!==0){throw new Error("readUintBE supports only bitLengths divisible by 8")}if(bitLength/8>array.length-offset){throw new Error("readUintBE: array is too short for the given bitLength")}var result=0;var mul=1;for(var i=bitLength/8+offset-1;i>=offset;i--){result+=array[i]*mul;mul*=256}return result}exports.readUintBE=readUintBE;function readUintLE(bitLength,array,offset){if(offset===void 0){offset=0}if(bitLength%8!==0){throw new Error("readUintLE supports only bitLengths divisible by 8")}if(bitLength/8>array.length-offset){throw new Error("readUintLE: array is too short for the given bitLength")}var result=0;var mul=1;for(var i=offset;i<offset+bitLength/8;i++){result+=array[i]*mul;mul*=256}return result}exports.readUintLE=readUintLE;function writeUintBE(bitLength,value,out,offset){if(out===void 0){out=new Uint8Array(bitLength/8)}if(offset===void 0){offset=0}if(bitLength%8!==0){throw new Error("writeUintBE supports only bitLengths divisible by 8")}if(!int_1.isSafeInteger(value)){throw new Error("writeUintBE value must be an integer")}var div=1;for(var i=bitLength/8+offset-1;i>=offset;i--){out[i]=value/div&255;div*=256}return out}exports.writeUintBE=writeUintBE;function writeUintLE(bitLength,value,out,offset){if(out===void 0){out=new Uint8Array(bitLength/8)}if(offset===void 0){offset=0}if(bitLength%8!==0){throw new Error("writeUintLE supports only bitLengths divisible by 8")}if(!int_1.isSafeInteger(value)){throw new Error("writeUintLE value must be an integer")}var div=1;for(var i=offset;i<offset+bitLength/8;i++){out[i]=value/div&255;div*=256}return out}exports.writeUintLE=writeUintLE;function readFloat32BE(array,offset){if(offset===void 0){offset=0}var view=new DataView(array.buffer,array.byteOffset,array.byteLength);return view.getFloat32(offset)}exports.readFloat32BE=readFloat32BE;function readFloat32LE(array,offset){if(offset===void 0){offset=0}var view=new DataView(array.buffer,array.byteOffset,array.byteLength);return view.getFloat32(offset,true)}exports.readFloat32LE=readFloat32LE;function readFloat64BE(array,offset){if(offset===void 0){offset=0}var view=new DataView(array.buffer,array.byteOffset,array.byteLength);return view.getFloat64(offset)}exports.readFloat64BE=readFloat64BE;function readFloat64LE(array,offset){if(offset===void 0){offset=0}var view=new DataView(array.buffer,array.byteOffset,array.byteLength);return view.getFloat64(offset,true)}exports.readFloat64LE=readFloat64LE;function writeFloat32BE(value,out,offset){if(out===void 0){out=new Uint8Array(4)}if(offset===void 0){offset=0}var view=new DataView(out.buffer,out.byteOffset,out.byteLength);view.setFloat32(offset,value);return out}exports.writeFloat32BE=writeFloat32BE;function writeFloat32LE(value,out,offset){if(out===void 0){out=new Uint8Array(4)}if(offset===void 0){offset=0}var view=new DataView(out.buffer,out.byteOffset,out.byteLength);view.setFloat32(offset,value,true);return out}exports.writeFloat32LE=writeFloat32LE;function writeFloat64BE(value,out,offset){if(out===void 0){out=new Uint8Array(8)}if(offset===void 0){offset=0}var view=new DataView(out.buffer,out.byteOffset,out.byteLength);view.setFloat64(offset,value);return out}exports.writeFloat64BE=writeFloat64BE;function writeFloat64LE(value,out,offset){if(out===void 0){out=new Uint8Array(8)}if(offset===void 0){offset=0}var view=new DataView(out.buffer,out.byteOffset,out.byteLength);view.setFloat64(offset,value,true);return out}exports.writeFloat64LE=writeFloat64LE},{"@stablelib/int":6}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var binary_1=require("@stablelib/binary");var wipe_1=require("@stablelib/wipe");exports.BLOCK_SIZE=128;exports.DIGEST_LENGTH=64;exports.KEY_LENGTH=64;exports.PERSONALIZATION_LENGTH=16;exports.SALT_LENGTH=16;exports.MAX_LEAF_SIZE=Math.pow(2,32)-1;exports.MAX_FANOUT=255;exports.MAX_MAX_DEPTH=255;var IV=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]);var SIGMA=[[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30],[28,20,8,16,18,30,26,12,2,24,0,4,22,14,10,6],[22,16,24,0,10,4,30,26,20,28,6,12,14,2,18,8],[14,18,6,2,26,24,22,28,4,12,10,20,8,0,30,16],[18,0,10,14,4,8,20,30,28,2,22,24,12,16,6,26],[4,24,12,20,0,22,16,6,8,26,14,10,30,28,2,18],[24,10,2,30,28,26,8,20,0,14,12,6,18,4,16,22],[26,22,14,28,24,2,6,18,10,0,30,8,16,12,4,20],[12,30,28,18,22,6,0,16,24,4,26,14,2,8,20,10],[20,4,16,8,14,12,2,10,30,22,18,28,6,24,26,0],[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30],[28,20,8,16,18,30,26,12,2,24,0,4,22,14,10,6]];var BLAKE2b=function(){function BLAKE2b(digestLength,config){if(digestLength===void 0){digestLength=64}this.digestLength=digestLength;this.blockSize=exports.BLOCK_SIZE;this._state=new Int32Array(IV);this._buffer=new Uint8Array(exports.BLOCK_SIZE);this._bufferLength=0;this._ctr=new Uint32Array(4);this._flag=new Uint32Array(4);this._lastNode=false;this._finished=false;this._vtmp=new Uint32Array(32);this._mtmp=new Uint32Array(32);if(digestLength<1||digestLength>exports.DIGEST_LENGTH){throw new Error("blake2b: wrong digest length")}if(config){this.validateConfig(config)}var keyLength=0;if(config&&config.key){keyLength=config.key.length}var fanout=1;var maxDepth=1;if(config&&config.tree){fanout=config.tree.fanout;maxDepth=config.tree.maxDepth}this._state[0]^=digestLength|keyLength<<8|fanout<<16|maxDepth<<24;if(config&&config.tree){this._state[1]^=config.tree.leafSize;this._state[2]^=config.tree.nodeOffsetLowBits;this._state[3]^=config.tree.nodeOffsetHighBits;this._state[4]^=config.tree.nodeDepth|config.tree.innerDigestLength<<8;this._lastNode=config.tree.lastNode}if(config&&config.salt){this._state[8]^=binary_1.readUint32LE(config.salt,0);this._state[9]^=binary_1.readUint32LE(config.salt,4);this._state[10]^=binary_1.readUint32LE(config.salt,8);this._state[11]^=binary_1.readUint32LE(config.salt,12)}if(config&&config.personalization){this._state[12]^=binary_1.readUint32LE(config.personalization,0);this._state[13]^=binary_1.readUint32LE(config.personalization,4);this._state[14]^=binary_1.readUint32LE(config.personalization,8);this._state[15]^=binary_1.readUint32LE(config.personalization,12)}this._initialState=new Uint32Array(this._state);if(config&&config.key&&keyLength>0){this._paddedKey=new Uint8Array(exports.BLOCK_SIZE);this._paddedKey.set(config.key);this._buffer.set(this._paddedKey);this._bufferLength=exports.BLOCK_SIZE}}BLAKE2b.prototype.reset=function(){this._state.set(this._initialState);if(this._paddedKey){this._buffer.set(this._paddedKey);this._bufferLength=exports.BLOCK_SIZE}else{this._bufferLength=0}wipe_1.wipe(this._ctr);wipe_1.wipe(this._flag);this._finished=false;return this};BLAKE2b.prototype.validateConfig=function(config){if(config.key&&config.key.length>exports.KEY_LENGTH){throw new Error("blake2b: wrong key length")}if(config.salt&&config.salt.length!==exports.SALT_LENGTH){throw new Error("blake2b: wrong salt length")}if(config.personalization&&config.personalization.length!==exports.PERSONALIZATION_LENGTH){throw new Error("blake2b: wrong personalization length")}if(config.tree){if(config.tree.fanout<0||config.tree.fanout>exports.MAX_FANOUT){throw new Error("blake2b: wrong tree fanout")}if(config.tree.maxDepth<0||config.tree.maxDepth>exports.MAX_MAX_DEPTH){throw new Error("blake2b: wrong tree depth")}if(config.tree.leafSize<0||config.tree.leafSize>exports.MAX_LEAF_SIZE){throw new Error("blake2b: wrong leaf size")}if(config.tree.innerDigestLength<0||config.tree.innerDigestLength>exports.DIGEST_LENGTH){throw new Error("blake2b: wrong tree inner digest length")}}};BLAKE2b.prototype.update=function(data,dataLength){if(dataLength===void 0){dataLength=data.length}if(this._finished){throw new Error("blake2b: can't update because hash was finished.")}var left=exports.BLOCK_SIZE-this._bufferLength;var dataPos=0;if(dataLength===0){return this}if(dataLength>left){for(var i=0;i<left;i++){this._buffer[this._bufferLength+i]=data[dataPos+i]}this._processBlock(exports.BLOCK_SIZE);dataPos+=left;dataLength-=left;this._bufferLength=0}while(dataLength>exports.BLOCK_SIZE){for(var i=0;i<exports.BLOCK_SIZE;i++){this._buffer[i]=data[dataPos+i]}this._processBlock(exports.BLOCK_SIZE);dataPos+=exports.BLOCK_SIZE;dataLength-=exports.BLOCK_SIZE;this._bufferLength=0}for(var i=0;i<dataLength;i++){this._buffer[this._bufferLength+i]=data[dataPos+i]}this._bufferLength+=dataLength;return this};BLAKE2b.prototype.finish=function(out){if(!this._finished){for(var i=this._bufferLength;i<exports.BLOCK_SIZE;i++){this._buffer[i]=0}this._flag[0]=4294967295;this._flag[1]=4294967295;if(this._lastNode){this._flag[2]=4294967295;this._flag[3]=4294967295}this._processBlock(this._bufferLength);this._finished=true}var tmp=this._buffer.subarray(0,64);for(var i=0;i<16;i++){binary_1.writeUint32LE(this._state[i],tmp,i*4)}out.set(tmp.subarray(0,out.length));return this};BLAKE2b.prototype.digest=function(){var out=new Uint8Array(this.digestLength);this.finish(out);return out};BLAKE2b.prototype.clean=function(){wipe_1.wipe(this._vtmp);wipe_1.wipe(this._mtmp);wipe_1.wipe(this._state);wipe_1.wipe(this._buffer);wipe_1.wipe(this._initialState);if(this._paddedKey){wipe_1.wipe(this._paddedKey)}this._bufferLength=0;wipe_1.wipe(this._ctr);wipe_1.wipe(this._flag);this._lastNode=false;this._finished=false};BLAKE2b.prototype.saveState=function(){if(this._finished){throw new Error("blake2b: cannot save finished state")}return{state:new Uint32Array(this._state),buffer:new Uint8Array(this._buffer),bufferLength:this._bufferLength,ctr:new Uint32Array(this._ctr),flag:new Uint32Array(this._flag),lastNode:this._lastNode,paddedKey:this._paddedKey?new Uint8Array(this._paddedKey):undefined,initialState:new Uint32Array(this._initialState)}};BLAKE2b.prototype.restoreState=function(savedState){this._state.set(savedState.state);this._buffer.set(savedState.buffer);this._bufferLength=savedState.bufferLength;this._ctr.set(savedState.ctr);this._flag.set(savedState.flag);this._lastNode=savedState.lastNode;if(this._paddedKey){wipe_1.wipe(this._paddedKey)}this._paddedKey=savedState.paddedKey?new Uint8Array(savedState.paddedKey):undefined;this._initialState.set(savedState.initialState);return this};BLAKE2b.prototype.cleanSavedState=function(savedState){wipe_1.wipe(savedState.state);wipe_1.wipe(savedState.buffer);wipe_1.wipe(savedState.initialState);if(savedState.paddedKey){wipe_1.wipe(savedState.paddedKey)}savedState.bufferLength=0;wipe_1.wipe(savedState.ctr);wipe_1.wipe(savedState.flag);savedState.lastNode=false};BLAKE2b.prototype._G=function(v,al,bl,cl,dl,ah,bh,ch,dh,ml0,mh0,ml1,mh1){var vla=v[al],vha=v[ah],vlb=v[bl],vhb=v[bh],vlc=v[cl],vhc=v[ch],vld=v[dl],vhd=v[dh];var w=vla&65535,x=vla>>>16,y=vha&65535,z=vha>>>16;w+=vlb&65535;x+=vlb>>>16;y+=vhb&65535;z+=vhb>>>16;x+=w>>>16;y+=x>>>16;z+=y>>>16;vha=y&65535|z<<16;vla=w&65535|x<<16;w=vla&65535;x=vla>>>16;y=vha&65535;z=vha>>>16;w+=ml0&65535;x+=ml0>>>16;y+=mh0&65535;z+=mh0>>>16;x+=w>>>16;y+=x>>>16;z+=y>>>16;vha=y&65535|z<<16;vla=w&65535|x<<16;vld^=vla;vhd^=vha;w=vhd;vhd=vld;vld=w;w=vlc&65535;x=vlc>>>16;y=vhc&65535;z=vhc>>>16;w+=vld&65535;x+=vld>>>16;y+=vhd&65535;z+=vhd>>>16;x+=w>>>16;y+=x>>>16;z+=y>>>16;vhc=y&65535|z<<16;vlc=w&65535|x<<16;vlb^=vlc;vhb^=vhc;w=vlb<<8|vhb>>>24;vlb=vhb<<8|vlb>>>24;vhb=w;w=vla&65535;x=vla>>>16;y=vha&65535;z=vha>>>16;w+=vlb&65535;x+=vlb>>>16;y+=vhb&65535;z+=vhb>>>16;x+=w>>>16;y+=x>>>16;z+=y>>>16;vha=y&65535|z<<16;vla=w&65535|x<<16;w=vla&65535;x=vla>>>16;y=vha&65535;z=vha>>>16;w+=ml1&65535;x+=ml1>>>16;y+=mh1&65535;z+=mh1>>>16;x+=w>>>16;y+=x>>>16;z+=y>>>16;vha=y&65535|z<<16;vla=w&65535|x<<16;vld^=vla;vhd^=vha;w=vld<<16|vhd>>>16;vld=vhd<<16|vld>>>16;vhd=w;w=vlc&65535;x=vlc>>>16;y=vhc&65535;z=vhc>>>16;w+=vld&65535;x+=vld>>>16;y+=vhd&65535;z+=vhd>>>16;x+=w>>>16;y+=x>>>16;z+=y>>>16;vhc=y&65535|z<<16;vlc=w&65535|x<<16;vlb^=vlc;vhb^=vhc;w=vhb<<1|vlb>>>31;vlb=vlb<<1|vhb>>>31;vhb=w;v[al]=vla;v[ah]=vha;v[bl]=vlb;v[bh]=vhb;v[cl]=vlc;v[ch]=vhc;v[dl]=vld;v[dh]=vhd};BLAKE2b.prototype._incrementCounter=function(n){for(var i=0;i<3;i++){var a=this._ctr[i]+n;this._ctr[i]=a>>>0;if(this._ctr[i]===a){return}n=1}};BLAKE2b.prototype._processBlock=function(length){this._incrementCounter(length);var v=this._vtmp;v.set(this._state);v.set(IV,16);v[12*2+0]^=this._ctr[0];v[12*2+1]^=this._ctr[1];v[13*2+0]^=this._ctr[2];v[13*2+1]^=this._ctr[3];v[14*2+0]^=this._flag[0];v[14*2+1]^=this._flag[1];v[15*2+0]^=this._flag[2];v[15*2+1]^=this._flag[3];var m=this._mtmp;for(var i=0;i<32;i++){m[i]=binary_1.readUint32LE(this._buffer,i*4)}for(var r=0;r<12;r++){this._G(v,0,8,16,24,1,9,17,25,m[SIGMA[r][0]],m[SIGMA[r][0]+1],m[SIGMA[r][1]],m[SIGMA[r][1]+1]);this._G(v,2,10,18,26,3,11,19,27,m[SIGMA[r][2]],m[SIGMA[r][2]+1],m[SIGMA[r][3]],m[SIGMA[r][3]+1]);this._G(v,4,12,20,28,5,13,21,29,m[SIGMA[r][4]],m[SIGMA[r][4]+1],m[SIGMA[r][5]],m[SIGMA[r][5]+1]);this._G(v,6,14,22,30,7,15,23,31,m[SIGMA[r][6]],m[SIGMA[r][6]+1],m[SIGMA[r][7]],m[SIGMA[r][7]+1]);this._G(v,0,10,20,30,1,11,21,31,m[SIGMA[r][8]],m[SIGMA[r][8]+1],m[SIGMA[r][9]],m[SIGMA[r][9]+1]);this._G(v,2,12,22,24,3,13,23,25,m[SIGMA[r][10]],m[SIGMA[r][10]+1],m[SIGMA[r][11]],m[SIGMA[r][11]+1]);this._G(v,4,14,16,26,5,15,17,27,m[SIGMA[r][12]],m[SIGMA[r][12]+1],m[SIGMA[r][13]],m[SIGMA[r][13]+1]);this._G(v,6,8,18,28,7,9,19,29,m[SIGMA[r][14]],m[SIGMA[r][14]+1],m[SIGMA[r][15]],m[SIGMA[r][15]+1])}for(var i=0;i<16;i++){this._state[i]^=v[i]^v[i+16]}};return BLAKE2b}();exports.BLAKE2b=BLAKE2b;function hash(data,digestLength,config){if(digestLength===void 0){digestLength=exports.DIGEST_LENGTH}var h=new BLAKE2b(digestLength,config);h.update(data);var digest=h.digest();h.clean();return digest}exports.hash=hash},{"@stablelib/binary":1,"@stablelib/wipe":18}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function concat(){var totalLength=0;for(var i=0;i<arguments.length;i++){totalLength+=arguments[i].length}var result=new Uint8Array(totalLength);var offset=0;for(var i=0;i<arguments.length;i++){var arg=arguments[i];result.set(arg,offset);offset+=arg.length}return result}exports.concat=concat},{}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function select(subject,resultIfOne,resultIfZero){return~(subject-1)&resultIfOne|subject-1&resultIfZero}exports.select=select;function lessOrEqual(a,b){return(a|0)-(b|0)-1>>>31&1}exports.lessOrEqual=lessOrEqual;function compare(a,b){if(a.length!==b.length){return 0}var result=0;for(var i=0;i<a.length;i++){result|=a[i]^b[i]}return 1&result-1>>>8}exports.compare=compare;function equal(a,b){if(a.length===0||b.length===0){return false}return compare(a,b)!==0}exports.equal=equal},{}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.convertSecretKeyToX25519=exports.convertPublicKeyToX25519=exports.verify=exports.sign=exports.extractPublicKeyFromSecretKey=exports.generateKeyPair=exports.generateKeyPairFromSeed=exports.SEED_LENGTH=exports.SECRET_KEY_LENGTH=exports.PUBLIC_KEY_LENGTH=exports.SIGNATURE_LENGTH=void 0;const random_1=require("@stablelib/random");const sha512_1=require("@stablelib/sha512");const wipe_1=require("@stablelib/wipe");exports.SIGNATURE_LENGTH=64;exports.PUBLIC_KEY_LENGTH=32;exports.SECRET_KEY_LENGTH=64;exports.SEED_LENGTH=32;function gf(init){const r=new Float64Array(16);if(init){for(let i=0;i<init.length;i++){r[i]=init[i]}}return r}const _9=new Uint8Array(32);_9[0]=9;const gf0=gf();const gf1=gf([1]);const D=gf([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]);const D2=gf([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]);const X=gf([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]);const Y=gf([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]);const I=gf([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function set25519(r,a){for(let i=0;i<16;i++){r[i]=a[i]|0}}function car25519(o){let c=1;for(let i=0;i<16;i++){let v=o[i]+c+65535;c=Math.floor(v/65536);o[i]=v-c*65536}o[0]+=c-1+37*(c-1)}function sel25519(p,q,b){const c=~(b-1);for(let i=0;i<16;i++){const t=c&(p[i]^q[i]);p[i]^=t;q[i]^=t}}function pack25519(o,n){const m=gf();const t=gf();for(let i=0;i<16;i++){t[i]=n[i]}car25519(t);car25519(t);car25519(t);for(let j=0;j<2;j++){m[0]=t[0]-65517;for(let i=1;i<15;i++){m[i]=t[i]-65535-(m[i-1]>>16&1);m[i-1]&=65535}m[15]=t[15]-32767-(m[14]>>16&1);const b=m[15]>>16&1;m[14]&=65535;sel25519(t,m,1-b)}for(let i=0;i<16;i++){o[2*i]=t[i]&255;o[2*i+1]=t[i]>>8}}function verify32(x,y){let d=0;for(let i=0;i<32;i++){d|=x[i]^y[i]}return(1&d-1>>>8)-1}function neq25519(a,b){const c=new Uint8Array(32);const d=new Uint8Array(32);pack25519(c,a);pack25519(d,b);return verify32(c,d)}function par25519(a){const d=new Uint8Array(32);pack25519(d,a);return d[0]&1}function unpack25519(o,n){for(let i=0;i<16;i++){o[i]=n[2*i]+(n[2*i+1]<<8)}o[15]&=32767}function add(o,a,b){for(let i=0;i<16;i++){o[i]=a[i]+b[i]}}function sub(o,a,b){for(let i=0;i<16;i++){o[i]=a[i]-b[i]}}function mul(o,a,b){let v,c,t0=0,t1=0,t2=0,t3=0,t4=0,t5=0,t6=0,t7=0,t8=0,t9=0,t10=0,t11=0,t12=0,t13=0,t14=0,t15=0,t16=0,t17=0,t18=0,t19=0,t20=0,t21=0,t22=0,t23=0,t24=0,t25=0,t26=0,t27=0,t28=0,t29=0,t30=0,b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];v=a[0];t0+=v*b0;t1+=v*b1;t2+=v*b2;t3+=v*b3;t4+=v*b4;t5+=v*b5;t6+=v*b6;t7+=v*b7;t8+=v*b8;t9+=v*b9;t10+=v*b10;t11+=v*b11;t12+=v*b12;t13+=v*b13;t14+=v*b14;t15+=v*b15;v=a[1];t1+=v*b0;t2+=v*b1;t3+=v*b2;t4+=v*b3;t5+=v*b4;t6+=v*b5;t7+=v*b6;t8+=v*b7;t9+=v*b8;t10+=v*b9;t11+=v*b10;t12+=v*b11;t13+=v*b12;t14+=v*b13;t15+=v*b14;t16+=v*b15;v=a[2];t2+=v*b0;t3+=v*b1;t4+=v*b2;t5+=v*b3;t6+=v*b4;t7+=v*b5;t8+=v*b6;t9+=v*b7;t10+=v*b8;t11+=v*b9;t12+=v*b10;t13+=v*b11;t14+=v*b12;t15+=v*b13;t16+=v*b14;t17+=v*b15;v=a[3];t3+=v*b0;t4+=v*b1;t5+=v*b2;t6+=v*b3;t7+=v*b4;t8+=v*b5;t9+=v*b6;t10+=v*b7;t11+=v*b8;t12+=v*b9;t13+=v*b10;t14+=v*b11;t15+=v*b12;t16+=v*b13;t17+=v*b14;t18+=v*b15;v=a[4];t4+=v*b0;t5+=v*b1;t6+=v*b2;t7+=v*b3;t8+=v*b4;t9+=v*b5;t10+=v*b6;t11+=v*b7;t12+=v*b8;t13+=v*b9;t14+=v*b10;t15+=v*b11;t16+=v*b12;t17+=v*b13;t18+=v*b14;t19+=v*b15;v=a[5];t5+=v*b0;t6+=v*b1;t7+=v*b2;t8+=v*b3;t9+=v*b4;t10+=v*b5;t11+=v*b6;t12+=v*b7;t13+=v*b8;t14+=v*b9;t15+=v*b10;t16+=v*b11;t17+=v*b12;t18+=v*b13;t19+=v*b14;t20+=v*b15;v=a[6];t6+=v*b0;t7+=v*b1;t8+=v*b2;t9+=v*b3;t10+=v*b4;t11+=v*b5;t12+=v*b6;t13+=v*b7;t14+=v*b8;t15+=v*b9;t16+=v*b10;t17+=v*b11;t18+=v*b12;t19+=v*b13;t20+=v*b14;t21+=v*b15;v=a[7];t7+=v*b0;t8+=v*b1;t9+=v*b2;t10+=v*b3;t11+=v*b4;t12+=v*b5;t13+=v*b6;t14+=v*b7;t15+=v*b8;t16+=v*b9;t17+=v*b10;t18+=v*b11;t19+=v*b12;t20+=v*b13;t21+=v*b14;t22+=v*b15;v=a[8];t8+=v*b0;t9+=v*b1;t10+=v*b2;t11+=v*b3;t12+=v*b4;t13+=v*b5;t14+=v*b6;t15+=v*b7;t16+=v*b8;t17+=v*b9;t18+=v*b10;t19+=v*b11;t20+=v*b12;t21+=v*b13;t22+=v*b14;t23+=v*b15;v=a[9];t9+=v*b0;t10+=v*b1;t11+=v*b2;t12+=v*b3;t13+=v*b4;t14+=v*b5;t15+=v*b6;t16+=v*b7;t17+=v*b8;t18+=v*b9;t19+=v*b10;t20+=v*b11;t21+=v*b12;t22+=v*b13;t23+=v*b14;t24+=v*b15;v=a[10];t10+=v*b0;t11+=v*b1;t12+=v*b2;t13+=v*b3;t14+=v*b4;t15+=v*b5;t16+=v*b6;t17+=v*b7;t18+=v*b8;t19+=v*b9;t20+=v*b10;t21+=v*b11;t22+=v*b12;t23+=v*b13;t24+=v*b14;t25+=v*b15;v=a[11];t11+=v*b0;t12+=v*b1;t13+=v*b2;t14+=v*b3;t15+=v*b4;t16+=v*b5;t17+=v*b6;t18+=v*b7;t19+=v*b8;t20+=v*b9;t21+=v*b10;t22+=v*b11;t23+=v*b12;t24+=v*b13;t25+=v*b14;t26+=v*b15;v=a[12];t12+=v*b0;t13+=v*b1;t14+=v*b2;t15+=v*b3;t16+=v*b4;t17+=v*b5;t18+=v*b6;t19+=v*b7;t20+=v*b8;t21+=v*b9;t22+=v*b10;t23+=v*b11;t24+=v*b12;t25+=v*b13;t26+=v*b14;t27+=v*b15;v=a[13];t13+=v*b0;t14+=v*b1;t15+=v*b2;t16+=v*b3;t17+=v*b4;t18+=v*b5;t19+=v*b6;t20+=v*b7;t21+=v*b8;t22+=v*b9;t23+=v*b10;t24+=v*b11;t25+=v*b12;t26+=v*b13;t27+=v*b14;t28+=v*b15;v=a[14];t14+=v*b0;t15+=v*b1;t16+=v*b2;t17+=v*b3;t18+=v*b4;t19+=v*b5;t20+=v*b6;t21+=v*b7;t22+=v*b8;t23+=v*b9;t24+=v*b10;t25+=v*b11;t26+=v*b12;t27+=v*b13;t28+=v*b14;t29+=v*b15;v=a[15];t15+=v*b0;t16+=v*b1;t17+=v*b2;t18+=v*b3;t19+=v*b4;t20+=v*b5;t21+=v*b6;t22+=v*b7;t23+=v*b8;t24+=v*b9;t25+=v*b10;t26+=v*b11;t27+=v*b12;t28+=v*b13;t29+=v*b14;t30+=v*b15;t0+=38*t16;t1+=38*t17;t2+=38*t18;t3+=38*t19;t4+=38*t20;t5+=38*t21;t6+=38*t22;t7+=38*t23;t8+=38*t24;t9+=38*t25;t10+=38*t26;t11+=38*t27;t12+=38*t28;t13+=38*t29;t14+=38*t30;c=1;v=t0+c+65535;c=Math.floor(v/65536);t0=v-c*65536;v=t1+c+65535;c=Math.floor(v/65536);t1=v-c*65536;v=t2+c+65535;c=Math.floor(v/65536);t2=v-c*65536;v=t3+c+65535;c=Math.floor(v/65536);t3=v-c*65536;v=t4+c+65535;c=Math.floor(v/65536);t4=v-c*65536;v=t5+c+65535;c=Math.floor(v/65536);t5=v-c*65536;v=t6+c+65535;c=Math.floor(v/65536);t6=v-c*65536;v=t7+c+65535;c=Math.floor(v/65536);t7=v-c*65536;v=t8+c+65535;c=Math.floor(v/65536);t8=v-c*65536;v=t9+c+65535;c=Math.floor(v/65536);t9=v-c*65536;v=t10+c+65535;c=Math.floor(v/65536);t10=v-c*65536;v=t11+c+65535;c=Math.floor(v/65536);t11=v-c*65536;v=t12+c+65535;c=Math.floor(v/65536);t12=v-c*65536;v=t13+c+65535;c=Math.floor(v/65536);t13=v-c*65536;v=t14+c+65535;c=Math.floor(v/65536);t14=v-c*65536;v=t15+c+65535;c=Math.floor(v/65536);t15=v-c*65536;t0+=c-1+37*(c-1);c=1;v=t0+c+65535;c=Math.floor(v/65536);t0=v-c*65536;v=t1+c+65535;c=Math.floor(v/65536);t1=v-c*65536;v=t2+c+65535;c=Math.floor(v/65536);t2=v-c*65536;v=t3+c+65535;c=Math.floor(v/65536);t3=v-c*65536;v=t4+c+65535;c=Math.floor(v/65536);t4=v-c*65536;v=t5+c+65535;c=Math.floor(v/65536);t5=v-c*65536;v=t6+c+65535;c=Math.floor(v/65536);t6=v-c*65536;v=t7+c+65535;c=Math.floor(v/65536);t7=v-c*65536;v=t8+c+65535;c=Math.floor(v/65536);t8=v-c*65536;v=t9+c+65535;c=Math.floor(v/65536);t9=v-c*65536;v=t10+c+65535;c=Math.floor(v/65536);t10=v-c*65536;v=t11+c+65535;c=Math.floor(v/65536);t11=v-c*65536;v=t12+c+65535;c=Math.floor(v/65536);t12=v-c*65536;v=t13+c+65535;c=Math.floor(v/65536);t13=v-c*65536;v=t14+c+65535;c=Math.floor(v/65536);t14=v-c*65536;v=t15+c+65535;c=Math.floor(v/65536);t15=v-c*65536;t0+=c-1+37*(c-1);o[0]=t0;o[1]=t1;o[2]=t2;o[3]=t3;o[4]=t4;o[5]=t5;o[6]=t6;o[7]=t7;o[8]=t8;o[9]=t9;o[10]=t10;o[11]=t11;o[12]=t12;o[13]=t13;o[14]=t14;o[15]=t15}function square(o,a){mul(o,a,a)}function inv25519(o,i){const c=gf();let a;for(a=0;a<16;a++){c[a]=i[a]}for(a=253;a>=0;a--){square(c,c);if(a!==2&&a!==4){mul(c,c,i)}}for(a=0;a<16;a++){o[a]=c[a]}}function pow2523(o,i){const c=gf();let a;for(a=0;a<16;a++){c[a]=i[a]}for(a=250;a>=0;a--){square(c,c);if(a!==1){mul(c,c,i)}}for(a=0;a<16;a++){o[a]=c[a]}}function edadd(p,q){const a=gf(),b=gf(),c=gf(),d=gf(),e=gf(),f=gf(),g=gf(),h=gf(),t=gf();sub(a,p[1],p[0]);sub(t,q[1],q[0]);mul(a,a,t);add(b,p[0],p[1]);add(t,q[0],q[1]);mul(b,b,t);mul(c,p[3],q[3]);mul(c,c,D2);mul(d,p[2],q[2]);add(d,d,d);sub(e,b,a);sub(f,d,c);add(g,d,c);add(h,b,a);mul(p[0],e,f);mul(p[1],h,g);mul(p[2],g,f);mul(p[3],e,h)}function cswap(p,q,b){for(let i=0;i<4;i++){sel25519(p[i],q[i],b)}}function pack(r,p){const tx=gf(),ty=gf(),zi=gf();inv25519(zi,p[2]);mul(tx,p[0],zi);mul(ty,p[1],zi);pack25519(r,ty);r[31]^=par25519(tx)<<7}function scalarmult(p,q,s){set25519(p[0],gf0);set25519(p[1],gf1);set25519(p[2],gf1);set25519(p[3],gf0);for(let i=255;i>=0;--i){const b=s[i/8|0]>>(i&7)&1;cswap(p,q,b);edadd(q,p);edadd(p,p);cswap(p,q,b)}}function scalarbase(p,s){const q=[gf(),gf(),gf(),gf()];set25519(q[0],X);set25519(q[1],Y);set25519(q[2],gf1);mul(q[3],X,Y);scalarmult(p,q,s)}function generateKeyPairFromSeed(seed){if(seed.length!==exports.SEED_LENGTH){throw new Error(`ed25519: seed must be ${exports.SEED_LENGTH} bytes`)}const d=(0,sha512_1.hash)(seed);d[0]&=248;d[31]&=127;d[31]|=64;const publicKey=new Uint8Array(32);const p=[gf(),gf(),gf(),gf()];scalarbase(p,d);pack(publicKey,p);const secretKey=new Uint8Array(64);secretKey.set(seed);secretKey.set(publicKey,32);return{publicKey:publicKey,secretKey:secretKey}}exports.generateKeyPairFromSeed=generateKeyPairFromSeed;function generateKeyPair(prng){const seed=(0,random_1.randomBytes)(32,prng);const result=generateKeyPairFromSeed(seed);(0,wipe_1.wipe)(seed);return result}exports.generateKeyPair=generateKeyPair;function extractPublicKeyFromSecretKey(secretKey){if(secretKey.length!==exports.SECRET_KEY_LENGTH){throw new Error(`ed25519: secret key must be ${exports.SECRET_KEY_LENGTH} bytes`)}return new Uint8Array(secretKey.subarray(32))}exports.extractPublicKeyFromSecretKey=extractPublicKeyFromSecretKey;const L=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function modL(r,x){let carry;let i;let j;let k;for(i=63;i>=32;--i){carry=0;for(j=i-32,k=i-12;j<k;++j){x[j]+=carry-16*x[i]*L[j-(i-32)];carry=Math.floor((x[j]+128)/256);x[j]-=carry*256}x[j]+=carry;x[i]=0}carry=0;for(j=0;j<32;j++){x[j]+=carry-(x[31]>>4)*L[j];carry=x[j]>>8;x[j]&=255}for(j=0;j<32;j++){x[j]-=carry*L[j]}for(i=0;i<32;i++){x[i+1]+=x[i]>>8;r[i]=x[i]&255}}function reduce(r){const x=new Float64Array(64);for(let i=0;i<64;i++){x[i]=r[i]}for(let i=0;i<64;i++){r[i]=0}modL(r,x)}function sign(secretKey,message){const x=new Float64Array(64);const p=[gf(),gf(),gf(),gf()];const d=(0,sha512_1.hash)(secretKey.subarray(0,32));d[0]&=248;d[31]&=127;d[31]|=64;const signature=new Uint8Array(64);signature.set(d.subarray(32),32);const hs=new sha512_1.SHA512;hs.update(signature.subarray(32));hs.update(message);const r=hs.digest();hs.clean();reduce(r);scalarbase(p,r);pack(signature,p);hs.reset();hs.update(signature.subarray(0,32));hs.update(secretKey.subarray(32));hs.update(message);const h=hs.digest();reduce(h);for(let i=0;i<32;i++){x[i]=r[i]}for(let i=0;i<32;i++){for(let j=0;j<32;j++){x[i+j]+=h[i]*d[j]}}modL(signature.subarray(32),x);return signature}exports.sign=sign;function unpackneg(r,p){const t=gf(),chk=gf(),num=gf(),den=gf(),den2=gf(),den4=gf(),den6=gf();set25519(r[2],gf1);unpack25519(r[1],p);square(num,r[1]);mul(den,num,D);sub(num,num,r[2]);add(den,r[2],den);square(den2,den);square(den4,den2);mul(den6,den4,den2);mul(t,den6,num);mul(t,t,den);pow2523(t,t);mul(t,t,num);mul(t,t,den);mul(t,t,den);mul(r[0],t,den);square(chk,r[0]);mul(chk,chk,den);if(neq25519(chk,num)){mul(r[0],r[0],I)}square(chk,r[0]);mul(chk,chk,den);if(neq25519(chk,num)){return-1}if(par25519(r[0])===p[31]>>7){sub(r[0],gf0,r[0])}mul(r[3],r[0],r[1]);return 0}function verify(publicKey,message,signature){const t=new Uint8Array(32);const p=[gf(),gf(),gf(),gf()];const q=[gf(),gf(),gf(),gf()];if(signature.length!==exports.SIGNATURE_LENGTH){throw new Error(`ed25519: signature must be ${exports.SIGNATURE_LENGTH} bytes`)}if(unpackneg(q,publicKey)){return false}const hs=new sha512_1.SHA512;hs.update(signature.subarray(0,32));hs.update(publicKey);hs.update(message);const h=hs.digest();reduce(h);scalarmult(p,q,h);scalarbase(q,signature.subarray(32));edadd(p,q);pack(t,p);if(verify32(signature,t)){return false}return true}exports.verify=verify;function convertPublicKeyToX25519(publicKey){let q=[gf(),gf(),gf(),gf()];if(unpackneg(q,publicKey)){throw new Error("Ed25519: invalid public key")}let a=gf();let b=gf();let y=q[1];add(a,gf1,y);sub(b,gf1,y);inv25519(b,b);mul(a,a,b);let z=new Uint8Array(32);pack25519(z,a);return z}exports.convertPublicKeyToX25519=convertPublicKeyToX25519;function convertSecretKeyToX25519(secretKey){const d=(0,sha512_1.hash)(secretKey.subarray(0,32));d[0]&=248;d[31]&=127;d[31]|=64;const o=new Uint8Array(d.subarray(0,32));(0,wipe_1.wipe)(d);return o}exports.convertSecretKeyToX25519=convertSecretKeyToX25519},{"@stablelib/random":11,"@stablelib/sha512":16,"@stablelib/wipe":18}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function imulShim(a,b){var ah=a>>>16&65535,al=a&65535;var bh=b>>>16&65535,bl=b&65535;return al*bl+(ah*bl+al*bh<<16>>>0)|0}exports.mul=Math.imul||imulShim;function add(a,b){return a+b|0}exports.add=add;function sub(a,b){return a-b|0}exports.sub=sub;function rotl(x,n){return x<<n|x>>>32-n}exports.rotl=rotl;function rotr(x,n){return x<<32-n|x>>>n}exports.rotr=rotr;function isIntegerShim(n){return typeof n==="number"&&isFinite(n)&&Math.floor(n)===n}exports.isInteger=Number.isInteger||isIntegerShim;exports.MAX_SAFE_INTEGER=9007199254740991;exports.isSafeInteger=function(n){return exports.isInteger(n)&&(n>=-exports.MAX_SAFE_INTEGER&&n<=exports.MAX_SAFE_INTEGER)}},{}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.openBox=exports.box=exports.precomputeSharedKey=exports.generateKeyPair=void 0;const x25519_1=require("@stablelib/x25519");const xsalsa20_1=require("@stablelib/xsalsa20");const secretbox_1=require("./secretbox");const wipe_1=require("@stablelib/wipe");var x25519_2=require("@stablelib/x25519");Object.defineProperty(exports,"generateKeyPair",{enumerable:true,get:function(){return x25519_2.generateKeyPair}});const zeros16=new Uint8Array(16);function precomputeSharedKey(theirPublicKey,mySecretKey){const key=(0,x25519_1.scalarMult)(mySecretKey,theirPublicKey);(0,xsalsa20_1.hsalsa)(key,zeros16,key);return key}exports.precomputeSharedKey=precomputeSharedKey;function box(theirPublicKey,mySecretKey,nonce,data){const sharedKey=precomputeSharedKey(theirPublicKey,mySecretKey);const result=(0,secretbox_1.secretBox)(sharedKey,nonce,data);(0,wipe_1.wipe)(sharedKey);return result}exports.box=box;function openBox(theirPublicKey,mySecretKey,nonce,data){const sharedKey=precomputeSharedKey(theirPublicKey,mySecretKey);const result=(0,secretbox_1.openSecretBox)(sharedKey,nonce,data);(0,wipe_1.wipe)(sharedKey);return result}exports.openBox=openBox},{"./secretbox":9,"@stablelib/wipe":18,"@stablelib/x25519":21,"@stablelib/xsalsa20":22}],8:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});__exportStar(require("./box"),exports);__exportStar(require("./secretbox"),exports)},{"./box":7,"./secretbox":9}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.generateKey=exports.openSecretBox=exports.secretBox=void 0;const xsalsa20_1=require("@stablelib/xsalsa20");const poly1305_1=require("@stablelib/poly1305");const wipe_1=require("@stablelib/wipe");const random_1=require("@stablelib/random");function secretBox(key,nonce,data){if(nonce.length!==24){throw new Error("secretBox nonce must be 24 bytes")}const firstBlock=new Uint8Array(64);const nonceCounter=new Uint8Array(24+8);nonceCounter.set(nonce);(0,xsalsa20_1.stream)(key,nonceCounter,firstBlock,8);const result=new Uint8Array(16+data.length);for(let i=0;i<32&&i<data.length;i++){result[16+i]=data[i]^firstBlock[32+i]}if(data.length>32){(0,xsalsa20_1.streamXOR)(key,nonceCounter,data.subarray(32),result.subarray(16+32),8)}const auth=(0,poly1305_1.oneTimeAuth)(firstBlock.subarray(0,32),result.subarray(16));for(let i=0;i<auth.length;i++){result[i]=auth[i]}(0,wipe_1.wipe)(auth);(0,wipe_1.wipe)(firstBlock);(0,wipe_1.wipe)(nonceCounter);return result}exports.secretBox=secretBox;function openSecretBox(key,nonce,box){if(nonce.length!==24){throw new Error("secretBox nonce must be 24 bytes")}if(box.length<16){throw new Error("secretBox data must be at least 16 bytes")}const firstBlock=new Uint8Array(64);const nonceCounter=new Uint8Array(24+8);nonceCounter.set(nonce);(0,xsalsa20_1.stream)(key,nonceCounter,firstBlock,8);const auth=(0,poly1305_1.oneTimeAuth)(firstBlock.subarray(0,32),box.subarray(16));if(!(0,poly1305_1.equal)(auth,box.subarray(0,16))){return null}const ciphertext=box.subarray(16);const result=new Uint8Array(ciphertext.length);for(let i=0;i<32&&i<ciphertext.length;i++){result[i]=ciphertext[i]^firstBlock[32+i]}if(ciphertext.length>32){(0,xsalsa20_1.streamXOR)(key,nonceCounter,ciphertext.subarray(32),result.subarray(32),8)}(0,wipe_1.wipe)(auth);(0,wipe_1.wipe)(firstBlock);(0,wipe_1.wipe)(nonceCounter);return result}exports.openSecretBox=openSecretBox;function generateKey(prng){return(0,random_1.randomBytes)(32,prng)}exports.generateKey=generateKey},{"@stablelib/poly1305":10,"@stablelib/random":11,"@stablelib/wipe":18,"@stablelib/xsalsa20":22}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constant_time_1=require("@stablelib/constant-time");var wipe_1=require("@stablelib/wipe");exports.DIGEST_LENGTH=16;var Poly1305=function(){function Poly1305(key){this.digestLength=exports.DIGEST_LENGTH;this._buffer=new Uint8Array(16);this._r=new Uint16Array(10);this._h=new Uint16Array(10);this._pad=new Uint16Array(8);this._leftover=0;this._fin=0;this._finished=false;var t0=key[0]|key[1]<<8;this._r[0]=t0&8191;var t1=key[2]|key[3]<<8;this._r[1]=(t0>>>13|t1<<3)&8191;var t2=key[4]|key[5]<<8;this._r[2]=(t1>>>10|t2<<6)&7939;var t3=key[6]|key[7]<<8;this._r[3]=(t2>>>7|t3<<9)&8191;var t4=key[8]|key[9]<<8;this._r[4]=(t3>>>4|t4<<12)&255;this._r[5]=t4>>>1&8190;var t5=key[10]|key[11]<<8;this._r[6]=(t4>>>14|t5<<2)&8191;var t6=key[12]|key[13]<<8;this._r[7]=(t5>>>11|t6<<5)&8065;var t7=key[14]|key[15]<<8;this._r[8]=(t6>>>8|t7<<8)&8191;this._r[9]=t7>>>5&127;this._pad[0]=key[16]|key[17]<<8;this._pad[1]=key[18]|key[19]<<8;this._pad[2]=key[20]|key[21]<<8;this._pad[3]=key[22]|key[23]<<8;this._pad[4]=key[24]|key[25]<<8;this._pad[5]=key[26]|key[27]<<8;this._pad[6]=key[28]|key[29]<<8;this._pad[7]=key[30]|key[31]<<8}Poly1305.prototype._blocks=function(m,mpos,bytes){var hibit=this._fin?0:1<<11;var h0=this._h[0],h1=this._h[1],h2=this._h[2],h3=this._h[3],h4=this._h[4],h5=this._h[5],h6=this._h[6],h7=this._h[7],h8=this._h[8],h9=this._h[9];var r0=this._r[0],r1=this._r[1],r2=this._r[2],r3=this._r[3],r4=this._r[4],r5=this._r[5],r6=this._r[6],r7=this._r[7],r8=this._r[8],r9=this._r[9];while(bytes>=16){var t0=m[mpos+0]|m[mpos+1]<<8;h0+=t0&8191;var t1=m[mpos+2]|m[mpos+3]<<8;h1+=(t0>>>13|t1<<3)&8191;var t2=m[mpos+4]|m[mpos+5]<<8;h2+=(t1>>>10|t2<<6)&8191;var t3=m[mpos+6]|m[mpos+7]<<8;h3+=(t2>>>7|t3<<9)&8191;var t4=m[mpos+8]|m[mpos+9]<<8;h4+=(t3>>>4|t4<<12)&8191;h5+=t4>>>1&8191;var t5=m[mpos+10]|m[mpos+11]<<8;h6+=(t4>>>14|t5<<2)&8191;var t6=m[mpos+12]|m[mpos+13]<<8;h7+=(t5>>>11|t6<<5)&8191;var t7=m[mpos+14]|m[mpos+15]<<8;h8+=(t6>>>8|t7<<8)&8191;h9+=t7>>>5|hibit;var c=0;var d0=c;d0+=h0*r0;d0+=h1*(5*r9);d0+=h2*(5*r8);d0+=h3*(5*r7);d0+=h4*(5*r6);c=d0>>>13;d0&=8191;d0+=h5*(5*r5);d0+=h6*(5*r4);d0+=h7*(5*r3);d0+=h8*(5*r2);d0+=h9*(5*r1);c+=d0>>>13;d0&=8191;var d1=c;d1+=h0*r1;d1+=h1*r0;d1+=h2*(5*r9);d1+=h3*(5*r8);d1+=h4*(5*r7);c=d1>>>13;d1&=8191;d1+=h5*(5*r6);d1+=h6*(5*r5);d1+=h7*(5*r4);d1+=h8*(5*r3);d1+=h9*(5*r2);c+=d1>>>13;d1&=8191;var d2=c;d2+=h0*r2;d2+=h1*r1;d2+=h2*r0;d2+=h3*(5*r9);d2+=h4*(5*r8);c=d2>>>13;d2&=8191;d2+=h5*(5*r7);d2+=h6*(5*r6);d2+=h7*(5*r5);d2+=h8*(5*r4);d2+=h9*(5*r3);c+=d2>>>13;d2&=8191;var d3=c;d3+=h0*r3;d3+=h1*r2;d3+=h2*r1;d3+=h3*r0;d3+=h4*(5*r9);c=d3>>>13;d3&=8191;d3+=h5*(5*r8);d3+=h6*(5*r7);d3+=h7*(5*r6);d3+=h8*(5*r5);d3+=h9*(5*r4);c+=d3>>>13;d3&=8191;var d4=c;d4+=h0*r4;d4+=h1*r3;d4+=h2*r2;d4+=h3*r1;d4+=h4*r0;c=d4>>>13;d4&=8191;d4+=h5*(5*r9);d4+=h6*(5*r8);d4+=h7*(5*r7);d4+=h8*(5*r6);d4+=h9*(5*r5);c+=d4>>>13;d4&=8191;var d5=c;d5+=h0*r5;d5+=h1*r4;d5+=h2*r3;d5+=h3*r2;d5+=h4*r1;c=d5>>>13;d5&=8191;d5+=h5*r0;d5+=h6*(5*r9);d5+=h7*(5*r8);d5+=h8*(5*r7);d5+=h9*(5*r6);c+=d5>>>13;d5&=8191;var d6=c;d6+=h0*r6;d6+=h1*r5;d6+=h2*r4;d6+=h3*r3;d6+=h4*r2;c=d6>>>13;d6&=8191;d6+=h5*r1;d6+=h6*r0;d6+=h7*(5*r9);d6+=h8*(5*r8);d6+=h9*(5*r7);c+=d6>>>13;d6&=8191;var d7=c;d7+=h0*r7;d7+=h1*r6;d7+=h2*r5;d7+=h3*r4;d7+=h4*r3;c=d7>>>13;d7&=8191;d7+=h5*r2;d7+=h6*r1;d7+=h7*r0;d7+=h8*(5*r9);d7+=h9*(5*r8);c+=d7>>>13;d7&=8191;var d8=c;d8+=h0*r8;d8+=h1*r7;d8+=h2*r6;d8+=h3*r5;d8+=h4*r4;c=d8>>>13;d8&=8191;d8+=h5*r3;d8+=h6*r2;d8+=h7*r1;d8+=h8*r0;d8+=h9*(5*r9);c+=d8>>>13;d8&=8191;var d9=c;d9+=h0*r9;d9+=h1*r8;d9+=h2*r7;d9+=h3*r6;d9+=h4*r5;c=d9>>>13;d9&=8191;d9+=h5*r4;d9+=h6*r3;d9+=h7*r2;d9+=h8*r1;d9+=h9*r0;c+=d9>>>13;d9&=8191;c=(c<<2)+c|0;c=c+d0|0;d0=c&8191;c=c>>>13;d1+=c;h0=d0;h1=d1;h2=d2;h3=d3;h4=d4;h5=d5;h6=d6;h7=d7;h8=d8;h9=d9;mpos+=16;bytes-=16}this._h[0]=h0;this._h[1]=h1;this._h[2]=h2;this._h[3]=h3;this._h[4]=h4;this._h[5]=h5;this._h[6]=h6;this._h[7]=h7;this._h[8]=h8;this._h[9]=h9};Poly1305.prototype.finish=function(mac,macpos){if(macpos===void 0){macpos=0}var g=new Uint16Array(10);var c;var mask;var f;var i;if(this._leftover){i=this._leftover;this._buffer[i++]=1;for(;i<16;i++){this._buffer[i]=0}this._fin=1;this._blocks(this._buffer,0,16)}c=this._h[1]>>>13;this._h[1]&=8191;for(i=2;i<10;i++){this._h[i]+=c;c=this._h[i]>>>13;this._h[i]&=8191}this._h[0]+=c*5;c=this._h[0]>>>13;this._h[0]&=8191;this._h[1]+=c;c=this._h[1]>>>13;this._h[1]&=8191;this._h[2]+=c;g[0]=this._h[0]+5;c=g[0]>>>13;g[0]&=8191;for(i=1;i<10;i++){g[i]=this._h[i]+c;c=g[i]>>>13;g[i]&=8191}g[9]-=1<<13;mask=(c^1)-1;for(i=0;i<10;i++){g[i]&=mask}mask=~mask;for(i=0;i<10;i++){this._h[i]=this._h[i]&mask|g[i]}this._h[0]=(this._h[0]|this._h[1]<<13)&65535;this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535;this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535;this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535;this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535;this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535;this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535;this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535;f=this._h[0]+this._pad[0];this._h[0]=f&65535;for(i=1;i<8;i++){f=(this._h[i]+this._pad[i]|0)+(f>>>16)|0;this._h[i]=f&65535}mac[macpos+0]=this._h[0]>>>0;mac[macpos+1]=this._h[0]>>>8;mac[macpos+2]=this._h[1]>>>0;mac[macpos+3]=this._h[1]>>>8;mac[macpos+4]=this._h[2]>>>0;mac[macpos+5]=this._h[2]>>>8;mac[macpos+6]=this._h[3]>>>0;mac[macpos+7]=this._h[3]>>>8;mac[macpos+8]=this._h[4]>>>0;mac[macpos+9]=this._h[4]>>>8;mac[macpos+10]=this._h[5]>>>0;mac[macpos+11]=this._h[5]>>>8;mac[macpos+12]=this._h[6]>>>0;mac[macpos+13]=this._h[6]>>>8;mac[macpos+14]=this._h[7]>>>0;mac[macpos+15]=this._h[7]>>>8;this._finished=true;return this};Poly1305.prototype.update=function(m){var mpos=0;var bytes=m.length;var want;if(this._leftover){want=16-this._leftover;if(want>bytes){want=bytes}for(var i=0;i<want;i++){this._buffer[this._leftover+i]=m[mpos+i]}bytes-=want;mpos+=want;this._leftover+=want;if(this._leftover<16){return this}this._blocks(this._buffer,0,16);this._leftover=0}if(bytes>=16){want=bytes-bytes%16;this._blocks(m,mpos,want);mpos+=want;bytes-=want}if(bytes){for(var i=0;i<bytes;i++){this._buffer[this._leftover+i]=m[mpos+i]}this._leftover+=bytes}return this};Poly1305.prototype.digest=function(){if(this._finished){throw new Error("Poly1305 was finished")}var mac=new Uint8Array(16);this.finish(mac);return mac};Poly1305.prototype.clean=function(){wipe_1.wipe(this._buffer);wipe_1.wipe(this._r);wipe_1.wipe(this._h);wipe_1.wipe(this._pad);this._leftover=0;this._fin=0;this._finished=true;return this};return Poly1305}();exports.Poly1305=Poly1305;function oneTimeAuth(key,data){var h=new Poly1305(key);h.update(data);var digest=h.digest();h.clean();return digest}exports.oneTimeAuth=oneTimeAuth;function equal(a,b){if(a.length!==exports.DIGEST_LENGTH||b.length!==exports.DIGEST_LENGTH){return false}return constant_time_1.equal(a,b)}exports.equal=equal},{"@stablelib/constant-time":4,"@stablelib/wipe":18}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.randomStringForEntropy=exports.randomString=exports.randomUint32=exports.randomBytes=exports.defaultRandomSource=void 0;const system_1=require("./source/system");const binary_1=require("@stablelib/binary");const wipe_1=require("@stablelib/wipe");exports.defaultRandomSource=new system_1.SystemRandomSource;function randomBytes(length,prng=exports.defaultRandomSource){return prng.randomBytes(length)}exports.randomBytes=randomBytes;function randomUint32(prng=exports.defaultRandomSource){const buf=randomBytes(4,prng);const result=(0,binary_1.readUint32LE)(buf);(0,wipe_1.wipe)(buf);return result}exports.randomUint32=randomUint32;const ALPHANUMERIC="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function randomString(length,charset=ALPHANUMERIC,prng=exports.defaultRandomSource){if(charset.length<2){throw new Error("randomString charset is too short")}if(charset.length>256){throw new Error("randomString charset is too long")}let out="";const charsLen=charset.length;const maxByte=256-256%charsLen;while(length>0){const buf=randomBytes(Math.ceil(length*256/maxByte),prng);for(let i=0;i<buf.length&&length>0;i++){const randomByte=buf[i];if(randomByte<maxByte){out+=charset.charAt(randomByte%charsLen);length--}}(0,wipe_1.wipe)(buf)}return out}exports.randomString=randomString;function randomStringForEntropy(bits,charset=ALPHANUMERIC,prng=exports.defaultRandomSource){const length=Math.ceil(bits/(Math.log(charset.length)/Math.LN2));return randomString(length,charset,prng)}exports.randomStringForEntropy=randomStringForEntropy},{"./source/system":14,"@stablelib/binary":1,"@stablelib/wipe":18}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BrowserRandomSource=void 0;const QUOTA=65536;class BrowserRandomSource{constructor(){this.isAvailable=false;this.isInstantiated=false;const browserCrypto=typeof self!=="undefined"?self.crypto||self.msCrypto:null;if(browserCrypto&&browserCrypto.getRandomValues!==undefined){this._crypto=browserCrypto;this.isAvailable=true;this.isInstantiated=true}}randomBytes(length){if(!this.isAvailable||!this._crypto){throw new Error("Browser random byte generator is not available.")}const out=new Uint8Array(length);for(let i=0;i<out.length;i+=QUOTA){this._crypto.getRandomValues(out.subarray(i,i+Math.min(out.length-i,QUOTA)))}return out}}exports.BrowserRandomSource=BrowserRandomSource},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NodeRandomSource=void 0;const wipe_1=require("@stablelib/wipe");class NodeRandomSource{constructor(){this.isAvailable=false;this.isInstantiated=false;if(typeof require!=="undefined"){const nodeCrypto=require("crypto");if(nodeCrypto&&nodeCrypto.randomBytes){this._crypto=nodeCrypto;this.isAvailable=true;this.isInstantiated=true}}}randomBytes(length){if(!this.isAvailable||!this._crypto){throw new Error("Node.js random byte generator is not available.")}let buffer=this._crypto.randomBytes(length);if(buffer.length!==length){throw new Error("NodeRandomSource: got fewer bytes than requested")}const out=new Uint8Array(length);for(let i=0;i<out.length;i++){out[i]=buffer[i]}(0,wipe_1.wipe)(buffer);return out}}exports.NodeRandomSource=NodeRandomSource},{"@stablelib/wipe":18,crypto:54}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SystemRandomSource=void 0;const browser_1=require("./browser");const node_1=require("./node");class SystemRandomSource{constructor(){this.isAvailable=false;this.name="";this._source=new browser_1.BrowserRandomSource;if(this._source.isAvailable){this.isAvailable=true;this.name="Browser";return}this._source=new node_1.NodeRandomSource;if(this._source.isAvailable){this.isAvailable=true;this.name="Node";return}}randomBytes(length){if(!this.isAvailable){throw new Error("System random byte generator is not available.")}return this._source.randomBytes(length)}}exports.SystemRandomSource=SystemRandomSource},{"./browser":12,"./node":13}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var binary_1=require("@stablelib/binary");var wipe_1=require("@stablelib/wipe");var ROUNDS=20;function core(out,input,key){var j0=1634760805;var j1=key[3]<<24|key[2]<<16|key[1]<<8|key[0];var j2=key[7]<<24|key[6]<<16|key[5]<<8|key[4];var j3=key[11]<<24|key[10]<<16|key[9]<<8|key[8];var j4=key[15]<<24|key[14]<<16|key[13]<<8|key[12];var j5=857760878;var j6=input[3]<<24|input[2]<<16|input[1]<<8|input[0];var j7=input[7]<<24|input[6]<<16|input[5]<<8|input[4];var j8=input[11]<<24|input[10]<<16|input[9]<<8|input[8];var j9=input[15]<<24|input[14]<<16|input[13]<<8|input[12];var j10=2036477234;var j11=key[19]<<24|key[18]<<16|key[17]<<8|key[16];var j12=key[23]<<24|key[22]<<16|key[21]<<8|key[20];var j13=key[27]<<24|key[26]<<16|key[25]<<8|key[24];var j14=key[31]<<24|key[30]<<16|key[29]<<8|key[28];var j15=1797285236;var x0=j0;var x1=j1;var x2=j2;var x3=j3;var x4=j4;var x5=j5;var x6=j6;var x7=j7;var x8=j8;var x9=j9;var x10=j10;var x11=j11;var x12=j12;var x13=j13;var x14=j14;var x15=j15;var u;for(var i=0;i<ROUNDS;i+=2){u=x0+x12|0;x4^=u<<7|u>>>32-7;u=x4+x0|0;x8^=u<<9|u>>>32-9;u=x8+x4|0;x12^=u<<13|u>>>32-13;u=x12+x8|0;x0^=u<<18|u>>>32-18;u=x5+x1|0;x9^=u<<7|u>>>32-7;u=x9+x5|0;x13^=u<<9|u>>>32-9;u=x13+x9|0;x1^=u<<13|u>>>32-13;u=x1+x13|0;x5^=u<<18|u>>>32-18;u=x10+x6|0;x14^=u<<7|u>>>32-7;u=x14+x10|0;x2^=u<<9|u>>>32-9;u=x2+x14|0;x6^=u<<13|u>>>32-13;u=x6+x2|0;x10^=u<<18|u>>>32-18;u=x15+x11|0;x3^=u<<7|u>>>32-7;u=x3+x15|0;x7^=u<<9|u>>>32-9;u=x7+x3|0;x11^=u<<13|u>>>32-13;u=x11+x7|0;x15^=u<<18|u>>>32-18;u=x0+x3|0;x1^=u<<7|u>>>32-7;u=x1+x0|0;x2^=u<<9|u>>>32-9;u=x2+x1|0;x3^=u<<13|u>>>32-13;u=x3+x2|0;x0^=u<<18|u>>>32-18;u=x5+x4|0;x6^=u<<7|u>>>32-7;u=x6+x5|0;x7^=u<<9|u>>>32-9;u=x7+x6|0;x4^=u<<13|u>>>32-13;u=x4+x7|0;x5^=u<<18|u>>>32-18;u=x10+x9|0;x11^=u<<7|u>>>32-7;u=x11+x10|0;x8^=u<<9|u>>>32-9;u=x8+x11|0;x9^=u<<13|u>>>32-13;u=x9+x8|0;x10^=u<<18|u>>>32-18;u=x15+x14|0;x12^=u<<7|u>>>32-7;u=x12+x15|0;x13^=u<<9|u>>>32-9;u=x13+x12|0;x14^=u<<13|u>>>32-13;u=x14+x13|0;x15^=u<<18|u>>>32-18}binary_1.writeUint32LE(x0+j0|0,out,0);binary_1.writeUint32LE(x1+j1|0,out,4);binary_1.writeUint32LE(x2+j2|0,out,8);binary_1.writeUint32LE(x3+j3|0,out,12);binary_1.writeUint32LE(x4+j4|0,out,16);binary_1.writeUint32LE(x5+j5|0,out,20);binary_1.writeUint32LE(x6+j6|0,out,24);binary_1.writeUint32LE(x7+j7|0,out,28);binary_1.writeUint32LE(x8+j8|0,out,32);binary_1.writeUint32LE(x9+j9|0,out,36);binary_1.writeUint32LE(x10+j10|0,out,40);binary_1.writeUint32LE(x11+j11|0,out,44);binary_1.writeUint32LE(x12+j12|0,out,48);binary_1.writeUint32LE(x13+j13|0,out,52);binary_1.writeUint32LE(x14+j14|0,out,56);binary_1.writeUint32LE(x15+j15|0,out,60)}function streamXOR(key,nonce,src,dst,nonceInplaceCounterLength){if(nonceInplaceCounterLength===void 0){nonceInplaceCounterLength=0}if(key.length!==32){throw new Error("Salsa20: key size must be 32 bytes")}if(dst.length<src.length){throw new Error("Salsa20: destination is shorter than source")}var nc;var counterStart;if(nonceInplaceCounterLength===0){if(nonce.length!==8){throw new Error("Salsa20 nonce must be 8 bytes")}nc=new Uint8Array(16);nc.set(nonce);counterStart=nonce.length}else{if(nonce.length!==16){throw new Error("Salsa20 nonce with counter must be 16 bytes")}nc=nonce;counterStart=16-nonceInplaceCounterLength}var block=new Uint8Array(64);for(var i=0;i<src.length;i+=64){core(block,nc,key);for(var j=i;j<i+64&&j<src.length;j++){dst[j]=src[j]^block[j-i]}incrementCounter(nc,counterStart,nc.length-counterStart)}wipe_1.wipe(block);if(nonceInplaceCounterLength===0){wipe_1.wipe(nc)}return dst}exports.streamXOR=streamXOR;function stream(key,nonce,dst,nonceInplaceCounterLength){if(nonceInplaceCounterLength===void 0){nonceInplaceCounterLength=0}wipe_1.wipe(dst);return streamXOR(key,nonce,dst,dst,nonceInplaceCounterLength)}exports.stream=stream;function incrementCounter(counter,pos,len){var carry=1;while(len--){carry=carry+(counter[pos]&255)|0;counter[pos]=carry&255;carry>>>=8;pos++}if(carry>0){throw new Error("Salsa20: counter overflow")}}},{"@stablelib/binary":1,"@stablelib/wipe":18}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var binary_1=require("@stablelib/binary");var wipe_1=require("@stablelib/wipe");exports.DIGEST_LENGTH=64;exports.BLOCK_SIZE=128;var SHA512=function(){function SHA512(){this.digestLength=exports.DIGEST_LENGTH;this.blockSize=exports.BLOCK_SIZE;this._stateHi=new Int32Array(8);this._stateLo=new Int32Array(8);this._tempHi=new Int32Array(16);this._tempLo=new Int32Array(16);this._buffer=new Uint8Array(256);this._bufferLength=0;this._bytesHashed=0;this._finished=false;this.reset()}SHA512.prototype._initState=function(){this._stateHi[0]=1779033703;this._stateHi[1]=3144134277;this._stateHi[2]=1013904242;this._stateHi[3]=2773480762;this._stateHi[4]=1359893119;this._stateHi[5]=2600822924;this._stateHi[6]=528734635;this._stateHi[7]=1541459225;this._stateLo[0]=4089235720;this._stateLo[1]=2227873595;this._stateLo[2]=4271175723;this._stateLo[3]=1595750129;this._stateLo[4]=2917565137;this._stateLo[5]=725511199;this._stateLo[6]=4215389547;this._stateLo[7]=327033209};SHA512.prototype.reset=function(){this._initState();this._bufferLength=0;this._bytesHashed=0;this._finished=false;return this};SHA512.prototype.clean=function(){wipe_1.wipe(this._buffer);wipe_1.wipe(this._tempHi);wipe_1.wipe(this._tempLo);this.reset()};SHA512.prototype.update=function(data,dataLength){if(dataLength===void 0){dataLength=data.length}if(this._finished){throw new Error("SHA512: can't update because hash was finished.")}var dataPos=0;this._bytesHashed+=dataLength;if(this._bufferLength>0){while(this._bufferLength<exports.BLOCK_SIZE&&dataLength>0){this._buffer[this._bufferLength++]=data[dataPos++];dataLength--}if(this._bufferLength===this.blockSize){hashBlocks(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize);this._bufferLength=0}}if(dataLength>=this.blockSize){dataPos=hashBlocks(this._tempHi,this._tempLo,this._stateHi,this._stateLo,data,dataPos,dataLength);dataLength%=this.blockSize}while(dataLength>0){this._buffer[this._bufferLength++]=data[dataPos++];dataLength--}return this};SHA512.prototype.finish=function(out){if(!this._finished){var bytesHashed=this._bytesHashed;var left=this._bufferLength;var bitLenHi=bytesHashed/536870912|0;var bitLenLo=bytesHashed<<3;var padLength=bytesHashed%128<112?128:256;this._buffer[left]=128;for(var i=left+1;i<padLength-8;i++){this._buffer[i]=0}binary_1.writeUint32BE(bitLenHi,this._buffer,padLength-8);binary_1.writeUint32BE(bitLenLo,this._buffer,padLength-4);hashBlocks(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,padLength);this._finished=true}for(var i=0;i<this.digestLength/8;i++){binary_1.writeUint32BE(this._stateHi[i],out,i*8);binary_1.writeUint32BE(this._stateLo[i],out,i*8+4)}return this};SHA512.prototype.digest=function(){var out=new Uint8Array(this.digestLength);this.finish(out);return out};SHA512.prototype.saveState=function(){if(this._finished){throw new Error("SHA256: cannot save finished state")}return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):undefined,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}};SHA512.prototype.restoreState=function(savedState){this._stateHi.set(savedState.stateHi);this._stateLo.set(savedState.stateLo);this._bufferLength=savedState.bufferLength;if(savedState.buffer){this._buffer.set(savedState.buffer)}this._bytesHashed=savedState.bytesHashed;this._finished=false;return this};SHA512.prototype.cleanSavedState=function(savedState){wipe_1.wipe(savedState.stateHi);wipe_1.wipe(savedState.stateLo);if(savedState.buffer){wipe_1.wipe(savedState.buffer)}savedState.bufferLength=0;savedState.bytesHashed=0};return SHA512}();exports.SHA512=SHA512;var K=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function hashBlocks(wh,wl,hh,hl,m,pos,len){var ah0=hh[0],ah1=hh[1],ah2=hh[2],ah3=hh[3],ah4=hh[4],ah5=hh[5],ah6=hh[6],ah7=hh[7],al0=hl[0],al1=hl[1],al2=hl[2],al3=hl[3],al4=hl[4],al5=hl[5],al6=hl[6],al7=hl[7];var h,l;var th,tl;var a,b,c,d;while(len>=128){for(var i=0;i<16;i++){var j=8*i+pos;wh[i]=binary_1.readUint32BE(m,j);wl[i]=binary_1.readUint32BE(m,j+4)}for(var i=0;i<80;i++){var bh0=ah0;var bh1=ah1;var bh2=ah2;var bh3=ah3;var bh4=ah4;var bh5=ah5;var bh6=ah6;var bh7=ah7;var bl0=al0;var bl1=al1;var bl2=al2;var bl3=al3;var bl4=al4;var bl5=al5;var bl6=al6;var bl7=al7;h=ah7;l=al7;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=(ah4>>>14|al4<<32-14)^(ah4>>>18|al4<<32-18)^(al4>>>41-32|ah4<<32-(41-32));l=(al4>>>14|ah4<<32-14)^(al4>>>18|ah4<<32-18)^(ah4>>>41-32|al4<<32-(41-32));a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;h=ah4&ah5^~ah4&ah6;l=al4&al5^~al4&al6;a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;h=K[i*2];l=K[i*2+1];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;h=wh[i%16];l=wl[i%16];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;th=c&65535|d<<16;tl=a&65535|b<<16;h=th;l=tl;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=(ah0>>>28|al0<<32-28)^(al0>>>34-32|ah0<<32-(34-32))^(al0>>>39-32|ah0<<32-(39-32));l=(al0>>>28|ah0<<32-28)^(ah0>>>34-32|al0<<32-(34-32))^(ah0>>>39-32|al0<<32-(39-32));a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;h=ah0&ah1^ah0&ah2^ah1&ah2;l=al0&al1^al0&al2^al1&al2;a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;bh7=c&65535|d<<16;bl7=a&65535|b<<16;h=bh3;l=bl3;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=th;l=tl;a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;bh3=c&65535|d<<16;bl3=a&65535|b<<16;ah1=bh0;ah2=bh1;ah3=bh2;ah4=bh3;ah5=bh4;ah6=bh5;ah7=bh6;ah0=bh7;al1=bl0;al2=bl1;al3=bl2;al4=bl3;al5=bl4;al6=bl5;al7=bl6;al0=bl7;if(i%16===15){for(var j=0;j<16;j++){h=wh[j];l=wl[j];a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=wh[(j+9)%16];l=wl[(j+9)%16];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;th=wh[(j+1)%16];tl=wl[(j+1)%16];h=(th>>>1|tl<<32-1)^(th>>>8|tl<<32-8)^th>>>7;l=(tl>>>1|th<<32-1)^(tl>>>8|th<<32-8)^(tl>>>7|th<<32-7);a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;th=wh[(j+14)%16];tl=wl[(j+14)%16];h=(th>>>19|tl<<32-19)^(tl>>>61-32|th<<32-(61-32))^th>>>6;l=(tl>>>19|th<<32-19)^(th>>>61-32|tl<<32-(61-32))^(tl>>>6|th<<32-6);a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;wh[j]=c&65535|d<<16;wl[j]=a&65535|b<<16}}}h=ah0;l=al0;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[0];l=hl[0];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[0]=ah0=c&65535|d<<16;hl[0]=al0=a&65535|b<<16;h=ah1;l=al1;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[1];l=hl[1];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[1]=ah1=c&65535|d<<16;hl[1]=al1=a&65535|b<<16;h=ah2;l=al2;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[2];l=hl[2];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[2]=ah2=c&65535|d<<16;hl[2]=al2=a&65535|b<<16;h=ah3;l=al3;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[3];l=hl[3];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[3]=ah3=c&65535|d<<16;hl[3]=al3=a&65535|b<<16;h=ah4;l=al4;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[4];l=hl[4];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[4]=ah4=c&65535|d<<16;hl[4]=al4=a&65535|b<<16;h=ah5;l=al5;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[5];l=hl[5];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[5]=ah5=c&65535|d<<16;hl[5]=al5=a&65535|b<<16;h=ah6;l=al6;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[6];l=hl[6];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[6]=ah6=c&65535|d<<16;hl[6]=al6=a&65535|b<<16;h=ah7;l=al7;a=l&65535;b=l>>>16;c=h&65535;d=h>>>16;h=hh[7];l=hl[7];a+=l&65535;b+=l>>>16;c+=h&65535;d+=h>>>16;b+=a>>>16;c+=b>>>16;d+=c>>>16;hh[7]=ah7=c&65535|d<<16;hl[7]=al7=a&65535|b<<16;pos+=128;len-=128}return pos}function hash(data){var h=new SHA512;h.update(data);var digest=h.digest();h.clean();return digest}exports.hash=hash},{"@stablelib/binary":1,"@stablelib/wipe":18}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var INVALID_UTF16="utf8: invalid string";var INVALID_UTF8="utf8: invalid source encoding";function encode(s){var arr=new Uint8Array(encodedLength(s));var pos=0;for(var i=0;i<s.length;i++){var c=s.charCodeAt(i);if(c<128){arr[pos++]=c}else if(c<2048){arr[pos++]=192|c>>6;arr[pos++]=128|c&63}else if(c<55296){arr[pos++]=224|c>>12;arr[pos++]=128|c>>6&63;arr[pos++]=128|c&63}else{i++;c=(c&1023)<<10;c|=s.charCodeAt(i)&1023;c+=65536;arr[pos++]=240|c>>18;arr[pos++]=128|c>>12&63;arr[pos++]=128|c>>6&63;arr[pos++]=128|c&63}}return arr}exports.encode=encode;function encodedLength(s){var result=0;for(var i=0;i<s.length;i++){var c=s.charCodeAt(i);if(c<128){result+=1}else if(c<2048){result+=2}else if(c<55296){result+=3}else if(c<=57343){if(i>=s.length-1){throw new Error(INVALID_UTF16)}i++;result+=4}else{throw new Error(INVALID_UTF16)}}return result}exports.encodedLength=encodedLength;function decode(arr){var chars=[];for(var i=0;i<arr.length;i++){var b=arr[i];if(b&128){var min=void 0;if(b<224){if(i>=arr.length){throw new Error(INVALID_UTF8)}var n1=arr[++i];if((n1&192)!==128){throw new Error(INVALID_UTF8)}b=(b&31)<<6|n1&63;min=128}else if(b<240){if(i>=arr.length-1){throw new Error(INVALID_UTF8)}var n1=arr[++i];var n2=arr[++i];if((n1&192)!==128||(n2&192)!==128){throw new Error(INVALID_UTF8)}b=(b&15)<<12|(n1&63)<<6|n2&63;min=2048}else if(b<248){if(i>=arr.length-2){throw new Error(INVALID_UTF8)}var n1=arr[++i];var n2=arr[++i];var n3=arr[++i];if((n1&192)!==128||(n2&192)!==128||(n3&192)!==128){throw new Error(INVALID_UTF8)}b=(b&15)<<18|(n1&63)<<12|(n2&63)<<6|n3&63;min=65536}else{throw new Error(INVALID_UTF8)}if(b<min||b>=55296&&b<=57343){throw new Error(INVALID_UTF8)}if(b>=65536){if(b>1114111){throw new Error(INVALID_UTF8)}b-=65536;chars.push(String.fromCharCode(55296|b>>10));b=56320|b&1023}}chars.push(String.fromCharCode(b))}return chars.join("")}exports.decode=decode},{}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function wipe(array){for(var i=0;i<array.length;i++){array[i]=0}return array}exports.wipe=wipe},{}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.X25519Session=exports.SECRET_SEED_LENGTH=exports.SAVED_STATE_LENGTH=exports.ACCEPT_MESSAGE_LENGTH=exports.OFFER_MESSAGE_LENGTH=void 0;const random_1=require("@stablelib/random");const wipe_1=require("@stablelib/wipe");const x25519_1=require("@stablelib/x25519");const x25519_session_1=require("./x25519-session");exports.OFFER_MESSAGE_LENGTH=x25519_1.PUBLIC_KEY_LENGTH;exports.ACCEPT_MESSAGE_LENGTH=x25519_1.PUBLIC_KEY_LENGTH;exports.SAVED_STATE_LENGTH=x25519_1.SECRET_KEY_LENGTH;exports.SECRET_SEED_LENGTH=x25519_1.SECRET_KEY_LENGTH;class X25519Session{constructor(secretSeed,prng){this.offerMessageLength=exports.OFFER_MESSAGE_LENGTH;this.acceptMessageLength=exports.ACCEPT_MESSAGE_LENGTH;this.sharedKeyLength=x25519_1.SHARED_KEY_LENGTH;this.savedStateLength=exports.SAVED_STATE_LENGTH;this._seed=secretSeed||(0,random_1.randomBytes)(x25519_1.SECRET_KEY_LENGTH,prng)}saveState(){return new Uint8Array(this._seed)}restoreState(savedState){this._seed=new Uint8Array(savedState);return this}clean(){if(this._seed){(0,wipe_1.wipe)(this._seed)}if(this._keyPair){(0,wipe_1.wipe)(this._keyPair.secretKey);(0,wipe_1.wipe)(this._keyPair.publicKey)}if(this._sharedKey){(0,wipe_1.wipe)(this._sharedKey)}if(this._sessionKeys){(0,wipe_1.wipe)(this._sessionKeys.receive);(0,wipe_1.wipe)(this._sessionKeys.send)}}offer(){this._keyPair=(0,x25519_1.generateKeyPairFromSeed)(this._seed);return new Uint8Array(this._keyPair.publicKey)}accept(offerMsg){if(this._keyPair){throw new Error("X25519Session: accept shouldn't be called by offering party")}if(offerMsg.length!==this.offerMessageLength){throw new Error("X25519Session: incorrect offer message length")}if(this._sharedKey){throw new Error("X25519Session: accept was already called")}const keyPair=(0,x25519_1.generateKeyPairFromSeed)(this._seed);this._sharedKey=(0,x25519_1.sharedKey)(keyPair.secretKey,offerMsg);this._sessionKeys=(0,x25519_session_1.clientSessionKeysFromSharedKey)(this._sharedKey,keyPair.publicKey,offerMsg);(0,wipe_1.wipe)(keyPair.secretKey);return keyPair.publicKey}finish(acceptMsg){if(acceptMsg.length!==this.acceptMessageLength){throw new Error("X25519Session: incorrect accept message length")}if(!this._keyPair){throw new Error("X25519Session: no offer state")}if(this._sharedKey){throw new Error("X25519Session: finish was already called")}this._sharedKey=(0,x25519_1.sharedKey)(this._keyPair.secretKey,acceptMsg);this._sessionKeys=(0,x25519_session_1.serverSessionKeysFromSharedKey)(this._sharedKey,this._keyPair.publicKey,acceptMsg);return this}getSharedKey(){if(!this._sharedKey){throw new Error("X25519Session: no shared key established")}return new Uint8Array(this._sharedKey)}getSessionKeys(){if(!this._sessionKeys){throw new Error("X25519Session: no shared key established")}return{receive:new Uint8Array(this._sessionKeys.receive),send:new Uint8Array(this._sessionKeys.send)}}}exports.X25519Session=X25519Session},{"./x25519-session":20,"@stablelib/random":11,"@stablelib/wipe":18,"@stablelib/x25519":21}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.clientSessionKeys=exports.serverSessionKeys=exports.clientSessionKeysFromSharedKey=exports.serverSessionKeysFromSharedKey=exports.X25519Session=void 0;const blake2b_1=require("@stablelib/blake2b");const x25519_1=require("@stablelib/x25519");var keyagreement_1=require("./keyagreement");Object.defineProperty(exports,"X25519Session",{enumerable:true,get:function(){return keyagreement_1.X25519Session}});const SESSION_KEY_LENGTH=32;function serverSessionKeysFromSharedKey(sharedKey,myPublicKey,theirPublicKey,hash=blake2b_1.BLAKE2b){const state=new hash;if(state.digestLength!==SESSION_KEY_LENGTH*2){throw new Error("X25519: incorrect digest length")}const h=state.update(sharedKey).update(theirPublicKey).update(myPublicKey).digest();return{send:h.subarray(0,SESSION_KEY_LENGTH),receive:h.subarray(SESSION_KEY_LENGTH)}}exports.serverSessionKeysFromSharedKey=serverSessionKeysFromSharedKey;function clientSessionKeysFromSharedKey(sharedKey,myPublicKey,theirPublicKey,hash=blake2b_1.BLAKE2b){const state=new hash;if(state.digestLength!==SESSION_KEY_LENGTH*2){throw new Error("X25519: incorrect digest length")}const h=state.update(sharedKey).update(myPublicKey).update(theirPublicKey).digest();return{receive:h.subarray(0,SESSION_KEY_LENGTH),send:h.subarray(SESSION_KEY_LENGTH)}}exports.clientSessionKeysFromSharedKey=clientSessionKeysFromSharedKey;function serverSessionKeys(myKeyPair,theirPublicKey,hash=blake2b_1.BLAKE2b){const sk=(0,x25519_1.sharedKey)(myKeyPair.secretKey,theirPublicKey);return serverSessionKeysFromSharedKey(sk,myKeyPair.publicKey,theirPublicKey,hash)}exports.serverSessionKeys=serverSessionKeys;function clientSessionKeys(myKeyPair,theirPublicKey,hash=blake2b_1.BLAKE2b){const sk=(0,x25519_1.sharedKey)(myKeyPair.secretKey,theirPublicKey);return clientSessionKeysFromSharedKey(sk,myKeyPair.publicKey,theirPublicKey,hash)}exports.clientSessionKeys=clientSessionKeys},{"./keyagreement":19,"@stablelib/blake2b":2,"@stablelib/x25519":21}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.sharedKey=exports.generateKeyPair=exports.generateKeyPairFromSeed=exports.scalarMultBase=exports.scalarMult=exports.SHARED_KEY_LENGTH=exports.SECRET_KEY_LENGTH=exports.PUBLIC_KEY_LENGTH=void 0;const random_1=require("@stablelib/random");const wipe_1=require("@stablelib/wipe");exports.PUBLIC_KEY_LENGTH=32;exports.SECRET_KEY_LENGTH=32;exports.SHARED_KEY_LENGTH=32;function gf(init){const r=new Float64Array(16);if(init){for(let i=0;i<init.length;i++){r[i]=init[i]}}return r}const _9=new Uint8Array(32);_9[0]=9;const _121665=gf([56129,1]);function car25519(o){let c=1;for(let i=0;i<16;i++){let v=o[i]+c+65535;c=Math.floor(v/65536);o[i]=v-c*65536}o[0]+=c-1+37*(c-1)}function sel25519(p,q,b){const c=~(b-1);for(let i=0;i<16;i++){const t=c&(p[i]^q[i]);p[i]^=t;q[i]^=t}}function pack25519(o,n){const m=gf();const t=gf();for(let i=0;i<16;i++){t[i]=n[i]}car25519(t);car25519(t);car25519(t);for(let j=0;j<2;j++){m[0]=t[0]-65517;for(let i=1;i<15;i++){m[i]=t[i]-65535-(m[i-1]>>16&1);m[i-1]&=65535}m[15]=t[15]-32767-(m[14]>>16&1);const b=m[15]>>16&1;m[14]&=65535;sel25519(t,m,1-b)}for(let i=0;i<16;i++){o[2*i]=t[i]&255;o[2*i+1]=t[i]>>8}}function unpack25519(o,n){for(let i=0;i<16;i++){o[i]=n[2*i]+(n[2*i+1]<<8)}o[15]&=32767}function add(o,a,b){for(let i=0;i<16;i++){o[i]=a[i]+b[i]}}function sub(o,a,b){for(let i=0;i<16;i++){o[i]=a[i]-b[i]}}function mul(o,a,b){let v,c,t0=0,t1=0,t2=0,t3=0,t4=0,t5=0,t6=0,t7=0,t8=0,t9=0,t10=0,t11=0,t12=0,t13=0,t14=0,t15=0,t16=0,t17=0,t18=0,t19=0,t20=0,t21=0,t22=0,t23=0,t24=0,t25=0,t26=0,t27=0,t28=0,t29=0,t30=0,b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];v=a[0];t0+=v*b0;t1+=v*b1;t2+=v*b2;t3+=v*b3;t4+=v*b4;t5+=v*b5;t6+=v*b6;t7+=v*b7;t8+=v*b8;t9+=v*b9;t10+=v*b10;t11+=v*b11;t12+=v*b12;t13+=v*b13;t14+=v*b14;t15+=v*b15;v=a[1];t1+=v*b0;t2+=v*b1;t3+=v*b2;t4+=v*b3;t5+=v*b4;t6+=v*b5;t7+=v*b6;t8+=v*b7;t9+=v*b8;t10+=v*b9;t11+=v*b10;t12+=v*b11;t13+=v*b12;t14+=v*b13;t15+=v*b14;t16+=v*b15;v=a[2];t2+=v*b0;t3+=v*b1;t4+=v*b2;t5+=v*b3;t6+=v*b4;t7+=v*b5;t8+=v*b6;t9+=v*b7;t10+=v*b8;t11+=v*b9;t12+=v*b10;t13+=v*b11;t14+=v*b12;t15+=v*b13;t16+=v*b14;t17+=v*b15;v=a[3];t3+=v*b0;t4+=v*b1;t5+=v*b2;t6+=v*b3;t7+=v*b4;t8+=v*b5;t9+=v*b6;t10+=v*b7;t11+=v*b8;t12+=v*b9;t13+=v*b10;t14+=v*b11;t15+=v*b12;t16+=v*b13;t17+=v*b14;t18+=v*b15;v=a[4];t4+=v*b0;t5+=v*b1;t6+=v*b2;t7+=v*b3;t8+=v*b4;t9+=v*b5;t10+=v*b6;t11+=v*b7;t12+=v*b8;t13+=v*b9;t14+=v*b10;t15+=v*b11;t16+=v*b12;t17+=v*b13;t18+=v*b14;t19+=v*b15;v=a[5];t5+=v*b0;t6+=v*b1;t7+=v*b2;t8+=v*b3;t9+=v*b4;t10+=v*b5;t11+=v*b6;t12+=v*b7;t13+=v*b8;t14+=v*b9;t15+=v*b10;t16+=v*b11;t17+=v*b12;t18+=v*b13;t19+=v*b14;t20+=v*b15;v=a[6];t6+=v*b0;t7+=v*b1;t8+=v*b2;t9+=v*b3;t10+=v*b4;t11+=v*b5;t12+=v*b6;t13+=v*b7;t14+=v*b8;t15+=v*b9;t16+=v*b10;t17+=v*b11;t18+=v*b12;t19+=v*b13;t20+=v*b14;t21+=v*b15;v=a[7];t7+=v*b0;t8+=v*b1;t9+=v*b2;t10+=v*b3;t11+=v*b4;t12+=v*b5;t13+=v*b6;t14+=v*b7;t15+=v*b8;t16+=v*b9;t17+=v*b10;t18+=v*b11;t19+=v*b12;t20+=v*b13;t21+=v*b14;t22+=v*b15;v=a[8];t8+=v*b0;t9+=v*b1;t10+=v*b2;t11+=v*b3;t12+=v*b4;t13+=v*b5;t14+=v*b6;t15+=v*b7;t16+=v*b8;t17+=v*b9;t18+=v*b10;t19+=v*b11;t20+=v*b12;t21+=v*b13;t22+=v*b14;t23+=v*b15;v=a[9];t9+=v*b0;t10+=v*b1;t11+=v*b2;t12+=v*b3;t13+=v*b4;t14+=v*b5;t15+=v*b6;t16+=v*b7;t17+=v*b8;t18+=v*b9;t19+=v*b10;t20+=v*b11;t21+=v*b12;t22+=v*b13;t23+=v*b14;t24+=v*b15;v=a[10];t10+=v*b0;t11+=v*b1;t12+=v*b2;t13+=v*b3;t14+=v*b4;t15+=v*b5;t16+=v*b6;t17+=v*b7;t18+=v*b8;t19+=v*b9;t20+=v*b10;t21+=v*b11;t22+=v*b12;t23+=v*b13;t24+=v*b14;t25+=v*b15;v=a[11];t11+=v*b0;t12+=v*b1;t13+=v*b2;t14+=v*b3;t15+=v*b4;t16+=v*b5;t17+=v*b6;t18+=v*b7;t19+=v*b8;t20+=v*b9;t21+=v*b10;t22+=v*b11;t23+=v*b12;t24+=v*b13;t25+=v*b14;t26+=v*b15;v=a[12];t12+=v*b0;t13+=v*b1;t14+=v*b2;t15+=v*b3;t16+=v*b4;t17+=v*b5;t18+=v*b6;t19+=v*b7;t20+=v*b8;t21+=v*b9;t22+=v*b10;t23+=v*b11;t24+=v*b12;t25+=v*b13;t26+=v*b14;t27+=v*b15;v=a[13];t13+=v*b0;t14+=v*b1;t15+=v*b2;t16+=v*b3;t17+=v*b4;t18+=v*b5;t19+=v*b6;t20+=v*b7;t21+=v*b8;t22+=v*b9;t23+=v*b10;t24+=v*b11;t25+=v*b12;t26+=v*b13;t27+=v*b14;t28+=v*b15;v=a[14];t14+=v*b0;t15+=v*b1;t16+=v*b2;t17+=v*b3;t18+=v*b4;t19+=v*b5;t20+=v*b6;t21+=v*b7;t22+=v*b8;t23+=v*b9;t24+=v*b10;t25+=v*b11;t26+=v*b12;t27+=v*b13;t28+=v*b14;t29+=v*b15;v=a[15];t15+=v*b0;t16+=v*b1;t17+=v*b2;t18+=v*b3;t19+=v*b4;t20+=v*b5;t21+=v*b6;t22+=v*b7;t23+=v*b8;t24+=v*b9;t25+=v*b10;t26+=v*b11;t27+=v*b12;t28+=v*b13;t29+=v*b14;t30+=v*b15;t0+=38*t16;t1+=38*t17;t2+=38*t18;t3+=38*t19;t4+=38*t20;t5+=38*t21;t6+=38*t22;t7+=38*t23;t8+=38*t24;t9+=38*t25;t10+=38*t26;t11+=38*t27;t12+=38*t28;t13+=38*t29;t14+=38*t30;c=1;v=t0+c+65535;c=Math.floor(v/65536);t0=v-c*65536;v=t1+c+65535;c=Math.floor(v/65536);t1=v-c*65536;v=t2+c+65535;c=Math.floor(v/65536);t2=v-c*65536;v=t3+c+65535;c=Math.floor(v/65536);t3=v-c*65536;v=t4+c+65535;c=Math.floor(v/65536);t4=v-c*65536;v=t5+c+65535;c=Math.floor(v/65536);t5=v-c*65536;v=t6+c+65535;c=Math.floor(v/65536);t6=v-c*65536;v=t7+c+65535;c=Math.floor(v/65536);t7=v-c*65536;v=t8+c+65535;c=Math.floor(v/65536);t8=v-c*65536;v=t9+c+65535;c=Math.floor(v/65536);t9=v-c*65536;v=t10+c+65535;c=Math.floor(v/65536);t10=v-c*65536;v=t11+c+65535;c=Math.floor(v/65536);t11=v-c*65536;v=t12+c+65535;c=Math.floor(v/65536);t12=v-c*65536;v=t13+c+65535;c=Math.floor(v/65536);t13=v-c*65536;v=t14+c+65535;c=Math.floor(v/65536);t14=v-c*65536;v=t15+c+65535;c=Math.floor(v/65536);t15=v-c*65536;t0+=c-1+37*(c-1);c=1;v=t0+c+65535;c=Math.floor(v/65536);t0=v-c*65536;v=t1+c+65535;c=Math.floor(v/65536);t1=v-c*65536;v=t2+c+65535;c=Math.floor(v/65536);t2=v-c*65536;v=t3+c+65535;c=Math.floor(v/65536);t3=v-c*65536;v=t4+c+65535;c=Math.floor(v/65536);t4=v-c*65536;v=t5+c+65535;c=Math.floor(v/65536);t5=v-c*65536;v=t6+c+65535;c=Math.floor(v/65536);t6=v-c*65536;v=t7+c+65535;c=Math.floor(v/65536);t7=v-c*65536;v=t8+c+65535;c=Math.floor(v/65536);t8=v-c*65536;v=t9+c+65535;c=Math.floor(v/65536);t9=v-c*65536;v=t10+c+65535;c=Math.floor(v/65536);t10=v-c*65536;v=t11+c+65535;c=Math.floor(v/65536);t11=v-c*65536;v=t12+c+65535;c=Math.floor(v/65536);t12=v-c*65536;v=t13+c+65535;c=Math.floor(v/65536);t13=v-c*65536;v=t14+c+65535;c=Math.floor(v/65536);t14=v-c*65536;v=t15+c+65535;c=Math.floor(v/65536);t15=v-c*65536;t0+=c-1+37*(c-1);o[0]=t0;o[1]=t1;o[2]=t2;o[3]=t3;o[4]=t4;o[5]=t5;o[6]=t6;o[7]=t7;o[8]=t8;o[9]=t9;o[10]=t10;o[11]=t11;o[12]=t12;o[13]=t13;o[14]=t14;o[15]=t15}function square(o,a){mul(o,a,a)}function inv25519(o,inp){const c=gf();for(let i=0;i<16;i++){c[i]=inp[i]}for(let i=253;i>=0;i--){square(c,c);if(i!==2&&i!==4){mul(c,c,inp)}}for(let i=0;i<16;i++){o[i]=c[i]}}function scalarMult(n,p){const z=new Uint8Array(32);const x=new Float64Array(80);const a=gf(),b=gf(),c=gf(),d=gf(),e=gf(),f=gf();for(let i=0;i<31;i++){z[i]=n[i]}z[31]=n[31]&127|64;z[0]&=248;unpack25519(x,p);for(let i=0;i<16;i++){b[i]=x[i]}a[0]=d[0]=1;for(let i=254;i>=0;--i){const r=z[i>>>3]>>>(i&7)&1;sel25519(a,b,r);sel25519(c,d,r);add(e,a,c);sub(a,a,c);add(c,b,d);sub(b,b,d);square(d,e);square(f,a);mul(a,c,a);mul(c,b,e);add(e,a,c);sub(a,a,c);square(b,a);sub(c,d,f);mul(a,c,_121665);add(a,a,d);mul(c,c,a);mul(a,d,f);mul(d,b,x);square(b,e);sel25519(a,b,r);sel25519(c,d,r)}for(let i=0;i<16;i++){x[i+16]=a[i];x[i+32]=c[i];x[i+48]=b[i];x[i+64]=d[i]}const x32=x.subarray(32);const x16=x.subarray(16);inv25519(x32,x32);mul(x16,x16,x32);const q=new Uint8Array(32);pack25519(q,x16);return q}exports.scalarMult=scalarMult;function scalarMultBase(n){return scalarMult(n,_9)}exports.scalarMultBase=scalarMultBase;function generateKeyPairFromSeed(seed){if(seed.length!==exports.SECRET_KEY_LENGTH){throw new Error(`x25519: seed must be ${exports.SECRET_KEY_LENGTH} bytes`)}const secretKey=new Uint8Array(seed);const publicKey=scalarMultBase(secretKey);return{publicKey:publicKey,secretKey:secretKey}}exports.generateKeyPairFromSeed=generateKeyPairFromSeed;function generateKeyPair(prng){const seed=(0,random_1.randomBytes)(32,prng);const result=generateKeyPairFromSeed(seed);(0,wipe_1.wipe)(seed);return result}exports.generateKeyPair=generateKeyPair;function sharedKey(mySecretKey,theirPublicKey,rejectZero=false){if(mySecretKey.length!==exports.PUBLIC_KEY_LENGTH){throw new Error("X25519: incorrect secret key length")}if(theirPublicKey.length!==exports.PUBLIC_KEY_LENGTH){throw new Error("X25519: incorrect public key length")}const result=scalarMult(mySecretKey,theirPublicKey);if(rejectZero){let zeros=0;for(let i=0;i<result.length;i++){zeros|=result[i]}if(zeros===0){throw new Error("X25519: invalid shared key")}}return result}exports.sharedKey=sharedKey},{"@stablelib/random":11,"@stablelib/wipe":18}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var binary_1=require("@stablelib/binary");var salsa20_1=require("@stablelib/salsa20");var wipe_1=require("@stablelib/wipe");function streamXOR(key,nonce,src,dst,nonceInplaceCounterLength){if(nonceInplaceCounterLength===void 0){nonceInplaceCounterLength=0}if(nonceInplaceCounterLength===0){if(nonce.length!==24){throw new Error("XSalsa20 nonce must be 24 bytes")}}else{if(nonce.length!==32){throw new Error("XSalsa20 nonce with counter must be 32 bytes")}}var subkey=hsalsa(key,nonce.subarray(0,16),new Uint8Array(32));var result=salsa20_1.streamXOR(subkey,nonce.subarray(16),src,dst,nonceInplaceCounterLength);wipe_1.wipe(subkey);return result}exports.streamXOR=streamXOR;function stream(key,nonce,dst,nonceInplaceCounterLength){if(nonceInplaceCounterLength===void 0){nonceInplaceCounterLength=0}wipe_1.wipe(dst);return streamXOR(key,nonce,dst,dst,nonceInplaceCounterLength)}exports.stream=stream;var ROUNDS=20;function hsalsa(key,src,dst){var x0=1634760805;var x1=key[3]<<24|key[2]<<16|key[1]<<8|key[0];var x2=key[7]<<24|key[6]<<16|key[5]<<8|key[4];var x3=key[11]<<24|key[10]<<16|key[9]<<8|key[8];var x4=key[15]<<24|key[14]<<16|key[13]<<8|key[12];var x5=857760878;var x6=src[3]<<24|src[2]<<16|src[1]<<8|src[0];var x7=src[7]<<24|src[6]<<16|src[5]<<8|src[4];var x8=src[11]<<24|src[10]<<16|src[9]<<8|src[8];var x9=src[15]<<24|src[14]<<16|src[13]<<8|src[12];var x10=2036477234;var x11=key[19]<<24|key[18]<<16|key[17]<<8|key[16];var x12=key[23]<<24|key[22]<<16|key[21]<<8|key[20];var x13=key[27]<<24|key[26]<<16|key[25]<<8|key[24];var x14=key[31]<<24|key[30]<<16|key[29]<<8|key[28];var x15=1797285236;var u;for(var i=0;i<ROUNDS;i+=2){u=x0+x12|0;x4^=u<<7|u>>>32-7;u=x4+x0|0;x8^=u<<9|u>>>32-9;u=x8+x4|0;x12^=u<<13|u>>>32-13;u=x12+x8|0;x0^=u<<18|u>>>32-18;u=x5+x1|0;x9^=u<<7|u>>>32-7;u=x9+x5|0;x13^=u<<9|u>>>32-9;u=x13+x9|0;x1^=u<<13|u>>>32-13;u=x1+x13|0;x5^=u<<18|u>>>32-18;u=x10+x6|0;x14^=u<<7|u>>>32-7;u=x14+x10|0;x2^=u<<9|u>>>32-9;u=x2+x14|0;x6^=u<<13|u>>>32-13;u=x6+x2|0;x10^=u<<18|u>>>32-18;u=x15+x11|0;x3^=u<<7|u>>>32-7;u=x3+x15|0;x7^=u<<9|u>>>32-9;u=x7+x3|0;x11^=u<<13|u>>>32-13;u=x11+x7|0;x15^=u<<18|u>>>32-18;u=x0+x3|0;x1^=u<<7|u>>>32-7;u=x1+x0|0;x2^=u<<9|u>>>32-9;u=x2+x1|0;x3^=u<<13|u>>>32-13;u=x3+x2|0;x0^=u<<18|u>>>32-18;u=x5+x4|0;x6^=u<<7|u>>>32-7;u=x6+x5|0;x7^=u<<9|u>>>32-9;u=x7+x6|0;x4^=u<<13|u>>>32-13;u=x4+x7|0;x5^=u<<18|u>>>32-18;u=x10+x9|0;x11^=u<<7|u>>>32-7;u=x11+x10|0;x8^=u<<9|u>>>32-9;u=x8+x11|0;x9^=u<<13|u>>>32-13;u=x9+x8|0;x10^=u<<18|u>>>32-18;u=x15+x14|0;x12^=u<<7|u>>>32-7;u=x12+x15|0;x13^=u<<9|u>>>32-9;u=x13+x12|0;x14^=u<<13|u>>>32-13;u=x14+x13|0;x15^=u<<18|u>>>32-18}binary_1.writeUint32LE(x0,dst,0);binary_1.writeUint32LE(x5,dst,4);binary_1.writeUint32LE(x10,dst,8);binary_1.writeUint32LE(x15,dst,12);binary_1.writeUint32LE(x6,dst,16);binary_1.writeUint32LE(x7,dst,20);binary_1.writeUint32LE(x8,dst,24);binary_1.writeUint32LE(x9,dst,28);return dst}exports.hsalsa=hsalsa},{"@stablelib/binary":1,"@stablelib/salsa20":15,"@stablelib/wipe":18}],23:[function(require,module,exports){module.exports=require("./lib/axios")},{"./lib/axios":25}],24:[function(require,module,exports){"use strict";var utils=require("./../utils");var settle=require("./../core/settle");var cookies=require("./../helpers/cookies");var buildURL=require("./../helpers/buildURL");var buildFullPath=require("../core/buildFullPath");var parseHeaders=require("./../helpers/parseHeaders");var isURLSameOrigin=require("./../helpers/isURLSameOrigin");var createError=require("../core/createError");var defaults=require("../defaults");var Cancel=require("../cancel/Cancel");module.exports=function xhrAdapter(config){return new Promise(function dispatchXhrRequest(resolve,reject){var requestData=config.data;var requestHeaders=config.headers;var responseType=config.responseType;var onCanceled;function done(){if(config.cancelToken){config.cancelToken.unsubscribe(onCanceled)}if(config.signal){config.signal.removeEventListener("abort",onCanceled)}}if(utils.isFormData(requestData)){delete requestHeaders["Content-Type"]}var request=new XMLHttpRequest;if(config.auth){var username=config.auth.username||"";var password=config.auth.password?unescape(encodeURIComponent(config.auth.password)):"";requestHeaders.Authorization="Basic "+btoa(username+":"+password)}var fullPath=buildFullPath(config.baseURL,config.url);request.open(config.method.toUpperCase(),buildURL(fullPath,config.params,config.paramsSerializer),true);request.timeout=config.timeout;function onloadend(){if(!request){return}var responseHeaders="getAllResponseHeaders"in request?parseHeaders(request.getAllResponseHeaders()):null;var responseData=!responseType||responseType==="text"||responseType==="json"?request.responseText:request.response;var response={data:responseData,status:request.status,statusText:request.statusText,headers:responseHeaders,config:config,request:request};settle(function _resolve(value){resolve(value);done()},function _reject(err){reject(err);done()},response);request=null}if("onloadend"in request){request.onloadend=onloadend}else{request.onreadystatechange=function handleLoad(){if(!request||request.readyState!==4){return}if(request.status===0&&!(request.responseURL&&request.responseURL.indexOf("file:")===0)){return}setTimeout(onloadend)}}request.onabort=function handleAbort(){if(!request){return}reject(createError("Request aborted",config,"ECONNABORTED",request));request=null};request.onerror=function handleError(){reject(createError("Network Error",config,null,request));request=null};request.ontimeout=function handleTimeout(){var timeoutErrorMessage=config.timeout?"timeout of "+config.timeout+"ms exceeded":"timeout exceeded";var transitional=config.transitional||defaults.transitional;if(config.timeoutErrorMessage){timeoutErrorMessage=config.timeoutErrorMessage}reject(createError(timeoutErrorMessage,config,transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",request));request=null};if(utils.isStandardBrowserEnv()){var xsrfValue=(config.withCredentials||isURLSameOrigin(fullPath))&&config.xsrfCookieName?cookies.read(config.xsrfCookieName):undefined;if(xsrfValue){requestHeaders[config.xsrfHeaderName]=xsrfValue}}if("setRequestHeader"in request){utils.forEach(requestHeaders,function setRequestHeader(val,key){if(typeof requestData==="undefined"&&key.toLowerCase()==="content-type"){delete requestHeaders[key]}else{request.setRequestHeader(key,val)}})}if(!utils.isUndefined(config.withCredentials)){request.withCredentials=!!config.withCredentials}if(responseType&&responseType!=="json"){request.responseType=config.responseType}if(typeof config.onDownloadProgress==="function"){request.addEventListener("progress",config.onDownloadProgress)}if(typeof config.onUploadProgress==="function"&&request.upload){request.upload.addEventListener("progress",config.onUploadProgress)}if(config.cancelToken||config.signal){onCanceled=function(cancel){if(!request){return}reject(!cancel||cancel&&cancel.type?new Cancel("canceled"):cancel);request.abort();request=null};config.cancelToken&&config.cancelToken.subscribe(onCanceled);if(config.signal){config.signal.aborted?onCanceled():config.signal.addEventListener("abort",onCanceled)}}if(!requestData){requestData=null}request.send(requestData)})}},{"../cancel/Cancel":26,"../core/buildFullPath":31,"../core/createError":32,"../defaults":38,"./../core/settle":36,"./../helpers/buildURL":41,"./../helpers/cookies":43,"./../helpers/isURLSameOrigin":46,"./../helpers/parseHeaders":48,"./../utils":51}],25:[function(require,module,exports){"use strict";var utils=require("./utils");var bind=require("./helpers/bind");var Axios=require("./core/Axios");var mergeConfig=require("./core/mergeConfig");var defaults=require("./defaults");function createInstance(defaultConfig){var context=new Axios(defaultConfig);var instance=bind(Axios.prototype.request,context);utils.extend(instance,Axios.prototype,context);utils.extend(instance,context);instance.create=function create(instanceConfig){return createInstance(mergeConfig(defaultConfig,instanceConfig))};return instance}var axios=createInstance(defaults);axios.Axios=Axios;axios.Cancel=require("./cancel/Cancel");axios.CancelToken=require("./cancel/CancelToken");axios.isCancel=require("./cancel/isCancel");axios.VERSION=require("./env/data").version;axios.all=function all(promises){return Promise.all(promises)};axios.spread=require("./helpers/spread");axios.isAxiosError=require("./helpers/isAxiosError");module.exports=axios;module.exports.default=axios},{"./cancel/Cancel":26,"./cancel/CancelToken":27,"./cancel/isCancel":28,"./core/Axios":29,"./core/mergeConfig":35,"./defaults":38,"./env/data":39,"./helpers/bind":40,"./helpers/isAxiosError":45,"./helpers/spread":49,"./utils":51}],26:[function(require,module,exports){"use strict";function Cancel(message){this.message=message}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")};Cancel.prototype.__CANCEL__=true;module.exports=Cancel},{}],27:[function(require,module,exports){"use strict";var Cancel=require("./Cancel");function CancelToken(executor){if(typeof executor!=="function"){throw new TypeError("executor must be a function.")}var resolvePromise;this.promise=new Promise(function promiseExecutor(resolve){resolvePromise=resolve});var token=this;this.promise.then(function(cancel){if(!token._listeners)return;var i;var l=token._listeners.length;for(i=0;i<l;i++){token._listeners[i](cancel)}token._listeners=null});this.promise.then=function(onfulfilled){var _resolve;var promise=new Promise(function(resolve){token.subscribe(resolve);_resolve=resolve}).then(onfulfilled);promise.cancel=function reject(){token.unsubscribe(_resolve)};return promise};executor(function cancel(message){if(token.reason){return}token.reason=new Cancel(message);resolvePromise(token.reason)})}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason){throw this.reason}};CancelToken.prototype.subscribe=function subscribe(listener){if(this.reason){listener(this.reason);return}if(this._listeners){this._listeners.push(listener)}else{this._listeners=[listener]}};CancelToken.prototype.unsubscribe=function unsubscribe(listener){if(!this._listeners){return}var index=this._listeners.indexOf(listener);if(index!==-1){this._listeners.splice(index,1)}};CancelToken.source=function source(){var cancel;var token=new CancelToken(function executor(c){cancel=c});return{token:token,cancel:cancel}};module.exports=CancelToken},{"./Cancel":26}],28:[function(require,module,exports){"use strict";module.exports=function isCancel(value){return!!(value&&value.__CANCEL__)}},{}],29:[function(require,module,exports){"use strict";var utils=require("./../utils");var buildURL=require("../helpers/buildURL");var InterceptorManager=require("./InterceptorManager");var dispatchRequest=require("./dispatchRequest");var mergeConfig=require("./mergeConfig");var validator=require("../helpers/validator");var validators=validator.validators;function Axios(instanceConfig){this.defaults=instanceConfig;this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios.prototype.request=function request(config){if(typeof config==="string"){config=arguments[1]||{};config.url=arguments[0]}else{config=config||{}}config=mergeConfig(this.defaults,config);if(config.method){config.method=config.method.toLowerCase()}else if(this.defaults.method){config.method=this.defaults.method.toLowerCase()}else{config.method="get"}var transitional=config.transitional;if(transitional!==undefined){validator.assertOptions(transitional,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},false)}var requestInterceptorChain=[];var synchronousRequestInterceptors=true;this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor){if(typeof interceptor.runWhen==="function"&&interceptor.runWhen(config)===false){return}synchronousRequestInterceptors=synchronousRequestInterceptors&&interceptor.synchronous;requestInterceptorChain.unshift(interceptor.fulfilled,interceptor.rejected)});var responseInterceptorChain=[];this.interceptors.response.forEach(function pushResponseInterceptors(interceptor){responseInterceptorChain.push(interceptor.fulfilled,interceptor.rejected)});var promise;if(!synchronousRequestInterceptors){var chain=[dispatchRequest,undefined];Array.prototype.unshift.apply(chain,requestInterceptorChain);chain=chain.concat(responseInterceptorChain);promise=Promise.resolve(config);while(chain.length){promise=promise.then(chain.shift(),chain.shift())}return promise}var newConfig=config;while(requestInterceptorChain.length){var onFulfilled=requestInterceptorChain.shift();var onRejected=requestInterceptorChain.shift();try{newConfig=onFulfilled(newConfig)}catch(error){onRejected(error);break}}try{promise=dispatchRequest(newConfig)}catch(error){return Promise.reject(error)}while(responseInterceptorChain.length){promise=promise.then(responseInterceptorChain.shift(),responseInterceptorChain.shift())}return promise};Axios.prototype.getUri=function getUri(config){config=mergeConfig(this.defaults,config);return buildURL(config.url,config.params,config.paramsSerializer).replace(/^\?/,"")};utils.forEach(["delete","get","head","options"],function forEachMethodNoData(method){Axios.prototype[method]=function(url,config){return this.request(mergeConfig(config||{},{method:method,url:url,data:(config||{}).data}))}});utils.forEach(["post","put","patch"],function forEachMethodWithData(method){Axios.prototype[method]=function(url,data,config){return this.request(mergeConfig(config||{},{method:method,url:url,data:data}))}});module.exports=Axios},{"../helpers/buildURL":41,"../helpers/validator":50,"./../utils":51,"./InterceptorManager":30,"./dispatchRequest":33,"./mergeConfig":35}],30:[function(require,module,exports){"use strict";var utils=require("./../utils");function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(fulfilled,rejected,options){this.handlers.push({fulfilled:fulfilled,rejected:rejected,synchronous:options?options.synchronous:false,runWhen:options?options.runWhen:null});return this.handlers.length-1};InterceptorManager.prototype.eject=function eject(id){if(this.handlers[id]){this.handlers[id]=null}};InterceptorManager.prototype.forEach=function forEach(fn){utils.forEach(this.handlers,function forEachHandler(h){if(h!==null){fn(h)}})};module.exports=InterceptorManager},{"./../utils":51}],31:[function(require,module,exports){"use strict";var isAbsoluteURL=require("../helpers/isAbsoluteURL");var combineURLs=require("../helpers/combineURLs");module.exports=function buildFullPath(baseURL,requestedURL){if(baseURL&&!isAbsoluteURL(requestedURL)){return combineURLs(baseURL,requestedURL)}return requestedURL}},{"../helpers/combineURLs":42,"../helpers/isAbsoluteURL":44}],32:[function(require,module,exports){"use strict";var enhanceError=require("./enhanceError");module.exports=function createError(message,config,code,request,response){var error=new Error(message);return enhanceError(error,config,code,request,response)}},{"./enhanceError":34}],33:[function(require,module,exports){"use strict";var utils=require("./../utils");var transformData=require("./transformData");var isCancel=require("../cancel/isCancel");var defaults=require("../defaults");var Cancel=require("../cancel/Cancel");function throwIfCancellationRequested(config){if(config.cancelToken){config.cancelToken.throwIfRequested()}if(config.signal&&config.signal.aborted){throw new Cancel("canceled")}}module.exports=function dispatchRequest(config){throwIfCancellationRequested(config);config.headers=config.headers||{};config.data=transformData.call(config,config.data,config.headers,config.transformRequest);config.headers=utils.merge(config.headers.common||{},config.headers[config.method]||{},config.headers);utils.forEach(["delete","get","head","post","put","patch","common"],function cleanHeaderConfig(method){delete config.headers[method]});var adapter=config.adapter||defaults.adapter;return adapter(config).then(function onAdapterResolution(response){throwIfCancellationRequested(config);response.data=transformData.call(config,response.data,response.headers,config.transformResponse);return response},function onAdapterRejection(reason){if(!isCancel(reason)){throwIfCancellationRequested(config);if(reason&&reason.response){reason.response.data=transformData.call(config,reason.response.data,reason.response.headers,config.transformResponse)}}return Promise.reject(reason)})}},{"../cancel/Cancel":26,"../cancel/isCancel":28,"../defaults":38,"./../utils":51,"./transformData":37}],34:[function(require,module,exports){"use strict";module.exports=function enhanceError(error,config,code,request,response){error.config=config;if(code){error.code=code}error.request=request;error.response=response;error.isAxiosError=true;error.toJSON=function toJSON(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}};return error}},{}],35:[function(require,module,exports){"use strict";var utils=require("../utils");module.exports=function mergeConfig(config1,config2){config2=config2||{};var config={};function getMergedValue(target,source){if(utils.isPlainObject(target)&&utils.isPlainObject(source)){return utils.merge(target,source)}else if(utils.isPlainObject(source)){return utils.merge({},source)}else if(utils.isArray(source)){return source.slice()}return source}function mergeDeepProperties(prop){if(!utils.isUndefined(config2[prop])){return getMergedValue(config1[prop],config2[prop])}else if(!utils.isUndefined(config1[prop])){return getMergedValue(undefined,config1[prop])}}function valueFromConfig2(prop){if(!utils.isUndefined(config2[prop])){return getMergedValue(undefined,config2[prop])}}function defaultToConfig2(prop){if(!utils.isUndefined(config2[prop])){return getMergedValue(undefined,config2[prop])}else if(!utils.isUndefined(config1[prop])){return getMergedValue(undefined,config1[prop])}}function mergeDirectKeys(prop){if(prop in config2){return getMergedValue(config1[prop],config2[prop])}else if(prop in config1){return getMergedValue(undefined,config1[prop])}}var mergeMap={url:valueFromConfig2,method:valueFromConfig2,data:valueFromConfig2,baseURL:defaultToConfig2,transformRequest:defaultToConfig2,transformResponse:defaultToConfig2,paramsSerializer:defaultToConfig2,timeout:defaultToConfig2,timeoutMessage:defaultToConfig2,withCredentials:defaultToConfig2,adapter:defaultToConfig2,responseType:defaultToConfig2,xsrfCookieName:defaultToConfig2,xsrfHeaderName:defaultToConfig2,onUploadProgress:defaultToConfig2,onDownloadProgress:defaultToConfig2,decompress:defaultToConfig2,maxContentLength:defaultToConfig2,maxBodyLength:defaultToConfig2,transport:defaultToConfig2,httpAgent:defaultToConfig2,httpsAgent:defaultToConfig2,cancelToken:defaultToConfig2,socketPath:defaultToConfig2,responseEncoding:defaultToConfig2,validateStatus:mergeDirectKeys};utils.forEach(Object.keys(config1).concat(Object.keys(config2)),function computeConfigValue(prop){var merge=mergeMap[prop]||mergeDeepProperties;var configValue=merge(prop);utils.isUndefined(configValue)&&merge!==mergeDirectKeys||(config[prop]=configValue)});return config}},{"../utils":51}],36:[function(require,module,exports){"use strict";var createError=require("./createError");module.exports=function settle(resolve,reject,response){var validateStatus=response.config.validateStatus;if(!response.status||!validateStatus||validateStatus(response.status)){resolve(response)}else{reject(createError("Request failed with status code "+response.status,response.config,null,response.request,response))}}},{"./createError":32}],37:[function(require,module,exports){"use strict";var utils=require("./../utils");var defaults=require("./../defaults");module.exports=function transformData(data,headers,fns){var context=this||defaults;utils.forEach(fns,function transform(fn){data=fn.call(context,data,headers)});return data}},{"./../defaults":38,"./../utils":51}],38:[function(require,module,exports){(function(process){(function(){"use strict";var utils=require("./utils");var normalizeHeaderName=require("./helpers/normalizeHeaderName");var enhanceError=require("./core/enhanceError");var DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(headers,value){if(!utils.isUndefined(headers)&&utils.isUndefined(headers["Content-Type"])){headers["Content-Type"]=value}}function getDefaultAdapter(){var adapter;if(typeof XMLHttpRequest!=="undefined"){adapter=require("./adapters/xhr")}else if(typeof process!=="undefined"&&Object.prototype.toString.call(process)==="[object process]"){adapter=require("./adapters/http")}return adapter}function stringifySafely(rawValue,parser,encoder){if(utils.isString(rawValue)){try{(parser||JSON.parse)(rawValue);return utils.trim(rawValue)}catch(e){if(e.name!=="SyntaxError"){throw e}}}return(encoder||JSON.stringify)(rawValue)}var defaults={transitional:{silentJSONParsing:true,forcedJSONParsing:true,clarifyTimeoutError:false},adapter:getDefaultAdapter(),transformRequest:[function transformRequest(data,headers){normalizeHeaderName(headers,"Accept");normalizeHeaderName(headers,"Content-Type");if(utils.isFormData(data)||utils.isArrayBuffer(data)||utils.isBuffer(data)||utils.isStream(data)||utils.isFile(data)||utils.isBlob(data)){return data}if(utils.isArrayBufferView(data)){return data.buffer}if(utils.isURLSearchParams(data)){setContentTypeIfUnset(headers,"application/x-www-form-urlencoded;charset=utf-8");return data.toString()}if(utils.isObject(data)||headers&&headers["Content-Type"]==="application/json"){setContentTypeIfUnset(headers,"application/json");return stringifySafely(data)}return data}],transformResponse:[function transformResponse(data){var transitional=this.transitional||defaults.transitional;var silentJSONParsing=transitional&&transitional.silentJSONParsing;var forcedJSONParsing=transitional&&transitional.forcedJSONParsing;var strictJSONParsing=!silentJSONParsing&&this.responseType==="json";if(strictJSONParsing||forcedJSONParsing&&utils.isString(data)&&data.length){try{return JSON.parse(data)}catch(e){if(strictJSONParsing){if(e.name==="SyntaxError"){throw enhanceError(e,this,"E_JSON_PARSE")}throw e}}}return data}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function validateStatus(status){return status>=200&&status<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};utils.forEach(["delete","get","head"],function forEachMethodNoData(method){defaults.headers[method]={}});utils.forEach(["post","put","patch"],function forEachMethodWithData(method){defaults.headers[method]=utils.merge(DEFAULT_CONTENT_TYPE)});module.exports=defaults}).call(this)}).call(this,require("_process"))},{"./adapters/http":24,"./adapters/xhr":24,"./core/enhanceError":34,"./helpers/normalizeHeaderName":47,"./utils":51,_process:66}],39:[function(require,module,exports){module.exports={version:"0.24.0"}},{}],40:[function(require,module,exports){"use strict";module.exports=function bind(fn,thisArg){return function wrap(){var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}return fn.apply(thisArg,args)}}},{}],41:[function(require,module,exports){"use strict";var utils=require("./../utils");function encode(val){return encodeURIComponent(val).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}module.exports=function buildURL(url,params,paramsSerializer){if(!params){return url}var serializedParams;if(paramsSerializer){serializedParams=paramsSerializer(params)}else if(utils.isURLSearchParams(params)){serializedParams=params.toString()}else{var parts=[];utils.forEach(params,function serialize(val,key){if(val===null||typeof val==="undefined"){return}if(utils.isArray(val)){key=key+"[]"}else{val=[val]}utils.forEach(val,function parseValue(v){if(utils.isDate(v)){v=v.toISOString()}else if(utils.isObject(v)){v=JSON.stringify(v)}parts.push(encode(key)+"="+encode(v))})});serializedParams=parts.join("&")}if(serializedParams){var hashmarkIndex=url.indexOf("#");if(hashmarkIndex!==-1){url=url.slice(0,hashmarkIndex)}url+=(url.indexOf("?")===-1?"?":"&")+serializedParams}return url}},{"./../utils":51}],42:[function(require,module,exports){"use strict";module.exports=function combineURLs(baseURL,relativeURL){return relativeURL?baseURL.replace(/\/+$/,"")+"/"+relativeURL.replace(/^\/+/,""):baseURL}},{}],43:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(name,value,expires,path,domain,secure){var cookie=[];cookie.push(name+"="+encodeURIComponent(value));if(utils.isNumber(expires)){cookie.push("expires="+new Date(expires).toGMTString())}if(utils.isString(path)){cookie.push("path="+path)}if(utils.isString(domain)){cookie.push("domain="+domain)}if(secure===true){cookie.push("secure")}document.cookie=cookie.join("; ")},read:function read(name){var match=document.cookie.match(new RegExp("(^|;\\s*)("+name+")=([^;]*)"));return match?decodeURIComponent(match[3]):null},remove:function remove(name){this.write(name,"",Date.now()-864e5)}}}():function nonStandardBrowserEnv(){return{write:function write(){},read:function read(){return null},remove:function remove(){}}}()},{"./../utils":51}],44:[function(require,module,exports){"use strict";module.exports=function isAbsoluteURL(url){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url)}},{}],45:[function(require,module,exports){"use strict";module.exports=function isAxiosError(payload){return typeof payload==="object"&&payload.isAxiosError===true}},{}],46:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){var msie=/(msie|trident)/i.test(navigator.userAgent);var urlParsingNode=document.createElement("a");var originURL;function resolveURL(url){var href=url;if(msie){urlParsingNode.setAttribute("href",href);href=urlParsingNode.href}urlParsingNode.setAttribute("href",href);return{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:urlParsingNode.pathname.charAt(0)==="/"?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}originURL=resolveURL(window.location.href);return function isURLSameOrigin(requestURL){var parsed=utils.isString(requestURL)?resolveURL(requestURL):requestURL;return parsed.protocol===originURL.protocol&&parsed.host===originURL.host}}():function nonStandardBrowserEnv(){return function isURLSameOrigin(){return true}}()},{"./../utils":51}],47:[function(require,module,exports){"use strict";var utils=require("../utils");module.exports=function normalizeHeaderName(headers,normalizedName){utils.forEach(headers,function processHeader(value,name){if(name!==normalizedName&&name.toUpperCase()===normalizedName.toUpperCase()){headers[normalizedName]=value;delete headers[name]}})}},{"../utils":51}],48:[function(require,module,exports){"use strict";var utils=require("./../utils");var ignoreDuplicateOf=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];module.exports=function parseHeaders(headers){var parsed={};var key;var val;var i;if(!headers){return parsed}utils.forEach(headers.split("\n"),function parser(line){i=line.indexOf(":");key=utils.trim(line.substr(0,i)).toLowerCase();val=utils.trim(line.substr(i+1));if(key){if(parsed[key]&&ignoreDuplicateOf.indexOf(key)>=0){return}if(key==="set-cookie"){parsed[key]=(parsed[key]?parsed[key]:[]).concat([val])}else{parsed[key]=parsed[key]?parsed[key]+", "+val:val}}});return parsed}},{"./../utils":51}],49:[function(require,module,exports){"use strict";module.exports=function spread(callback){return function wrap(arr){return callback.apply(null,arr)}}},{}],50:[function(require,module,exports){"use strict";var VERSION=require("../env/data").version;var validators={};["object","boolean","number","function","string","symbol"].forEach(function(type,i){validators[type]=function validator(thing){return typeof thing===type||"a"+(i<1?"n ":" ")+type}});var deprecatedWarnings={};validators.transitional=function transitional(validator,version,message){function formatMessage(opt,desc){return"[Axios v"+VERSION+"] Transitional option '"+opt+"'"+desc+(message?". "+message:"")}return function(value,opt,opts){if(validator===false){throw new Error(formatMessage(opt," has been removed"+(version?" in "+version:"")))}if(version&&!deprecatedWarnings[opt]){deprecatedWarnings[opt]=true;console.warn(formatMessage(opt," has been deprecated since v"+version+" and will be removed in the near future"))}return validator?validator(value,opt,opts):true}};function assertOptions(options,schema,allowUnknown){if(typeof options!=="object"){throw new TypeError("options must be an object")}var keys=Object.keys(options);var i=keys.length;while(i-- >0){var opt=keys[i];var validator=schema[opt];if(validator){var value=options[opt];var result=value===undefined||validator(value,opt,options);if(result!==true){throw new TypeError("option "+opt+" must be "+result)}continue}if(allowUnknown!==true){throw Error("Unknown option "+opt)}}}module.exports={assertOptions:assertOptions,validators:validators}},{"../env/data":39}],51:[function(require,module,exports){"use strict";var bind=require("./helpers/bind");var toString=Object.prototype.toString;function isArray(val){return toString.call(val)==="[object Array]"}function isUndefined(val){return typeof val==="undefined"}function isBuffer(val){return val!==null&&!isUndefined(val)&&val.constructor!==null&&!isUndefined(val.constructor)&&typeof val.constructor.isBuffer==="function"&&val.constructor.isBuffer(val)}function isArrayBuffer(val){return toString.call(val)==="[object ArrayBuffer]"}function isFormData(val){return typeof FormData!=="undefined"&&val instanceof FormData}function isArrayBufferView(val){var result;if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView){result=ArrayBuffer.isView(val)}else{result=val&&val.buffer&&val.buffer instanceof ArrayBuffer}return result}function isString(val){return typeof val==="string"}function isNumber(val){return typeof val==="number"}function isObject(val){return val!==null&&typeof val==="object"}function isPlainObject(val){if(toString.call(val)!=="[object Object]"){return false}var prototype=Object.getPrototypeOf(val);return prototype===null||prototype===Object.prototype}function isDate(val){return toString.call(val)==="[object Date]"}function isFile(val){return toString.call(val)==="[object File]"}function isBlob(val){return toString.call(val)==="[object Blob]"}function isFunction(val){return toString.call(val)==="[object Function]"}function isStream(val){return isObject(val)&&isFunction(val.pipe)}function isURLSearchParams(val){return typeof URLSearchParams!=="undefined"&&val instanceof URLSearchParams}function trim(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")}function isStandardBrowserEnv(){if(typeof navigator!=="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")){return false}return typeof window!=="undefined"&&typeof document!=="undefined"}function forEach(obj,fn){if(obj===null||typeof obj==="undefined"){return}if(typeof obj!=="object"){obj=[obj]}if(isArray(obj)){for(var i=0,l=obj.length;i<l;i++){fn.call(null,obj[i],i,obj)}}else{for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){fn.call(null,obj[key],key,obj)}}}}function merge(){var result={};function assignValue(val,key){if(isPlainObject(result[key])&&isPlainObject(val)){result[key]=merge(result[key],val)}else if(isPlainObject(val)){result[key]=merge({},val)}else if(isArray(val)){result[key]=val.slice()}else{result[key]=val}}for(var i=0,l=arguments.length;i<l;i++){forEach(arguments[i],assignValue)}return result}function extend(a,b,thisArg){forEach(b,function assignValue(val,key){if(thisArg&&typeof val==="function"){a[key]=bind(val,thisArg)}else{a[key]=val}});return a}function stripBOM(content){if(content.charCodeAt(0)===65279){content=content.slice(1)}return content}module.exports={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isPlainObject:isPlainObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim,stripBOM:stripBOM}},{"./helpers/bind":40}],52:[function(require,module,exports){"use strict";var _Buffer=require("safe-buffer").Buffer;function base(ALPHABET){if(ALPHABET.length>=255){throw new TypeError("Alphabet too long")}var BASE_MAP=new Uint8Array(256);for(var j=0;j<BASE_MAP.length;j++){BASE_MAP[j]=255}for(var i=0;i<ALPHABET.length;i++){var x=ALPHABET.charAt(i);var xc=x.charCodeAt(0);if(BASE_MAP[xc]!==255){throw new TypeError(x+" is ambiguous")}BASE_MAP[xc]=i}var BASE=ALPHABET.length;var LEADER=ALPHABET.charAt(0);var FACTOR=Math.log(BASE)/Math.log(256);var iFACTOR=Math.log(256)/Math.log(BASE);function encode(source){if(Array.isArray(source)||source instanceof Uint8Array){source=_Buffer.from(source)}if(!_Buffer.isBuffer(source)){throw new TypeError("Expected Buffer")}if(source.length===0){return""}var zeroes=0;var length=0;var pbegin=0;var pend=source.length;while(pbegin!==pend&&source[pbegin]===0){pbegin++;zeroes++}var size=(pend-pbegin)*iFACTOR+1>>>0;var b58=new Uint8Array(size);while(pbegin!==pend){var carry=source[pbegin];var i=0;for(var it1=size-1;(carry!==0||i<length)&&it1!==-1;it1--,i++){carry+=256*b58[it1]>>>0;b58[it1]=carry%BASE>>>0;carry=carry/BASE>>>0}if(carry!==0){throw new Error("Non-zero carry")}length=i;pbegin++}var it2=size-length;while(it2!==size&&b58[it2]===0){it2++}var str=LEADER.repeat(zeroes);for(;it2<size;++it2){str+=ALPHABET.charAt(b58[it2])}return str}function decodeUnsafe(source){if(typeof source!=="string"){throw new TypeError("Expected String")}if(source.length===0){return _Buffer.alloc(0)}var psz=0;var zeroes=0;var length=0;while(source[psz]===LEADER){zeroes++;psz++}var size=(source.length-psz)*FACTOR+1>>>0;var b256=new Uint8Array(size);while(source[psz]){var carry=BASE_MAP[source.charCodeAt(psz)];if(carry===255){return}var i=0;for(var it3=size-1;(carry!==0||i<length)&&it3!==-1;it3--,i++){carry+=BASE*b256[it3]>>>0;b256[it3]=carry%256>>>0;carry=carry/256>>>0}if(carry!==0){throw new Error("Non-zero carry")}length=i;psz++}var it4=size-length;while(it4!==size&&b256[it4]===0){it4++}var vch=_Buffer.allocUnsafe(zeroes+(size-it4));vch.fill(0,0,zeroes);var j=zeroes;while(it4!==size){vch[j++]=b256[it4++]}return vch}function decode(string){var buffer=decodeUnsafe(string);if(buffer){return buffer}throw new Error("Non-base"+BASE+" character")}return{encode:encode,decodeUnsafe:decodeUnsafe,decode:decode}}module.exports=base},{"safe-buffer":68}],53:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;var i;for(i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},{}],54:[function(require,module,exports){},{}],55:[function(require,module,exports){(function(Buffer){(function(){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}Object.defineProperty(Buffer.prototype,"parent",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.buffer}});Object.defineProperty(Buffer.prototype,"offset",{enumerable:true,get:function(){if(!Buffer.isBuffer(this))return undefined;return this.byteOffset}});function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError('The value "'+length+'" is invalid for option "size"')}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new TypeError('The "string" argument must be of type string. Received type number')}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species!=null&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="string"){return fromString(value,encodingOrOffset)}if(ArrayBuffer.isView(value)){return fromArrayLike(value)}if(value==null){throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError('The "value" argument must not be of type number. Received type number')}var valueOf=value.valueOf&&value.valueOf();if(valueOf!=null&&valueOf!==value){return Buffer.from(valueOf,encodingOrOffset,length)}var b=fromObject(value);if(b)return b;if(typeof Symbol!=="undefined"&&Symbol.toPrimitive!=null&&typeof value[Symbol.toPrimitive]==="function"){return Buffer.from(value[Symbol.toPrimitive]("string"),encodingOrOffset,length)}throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, "+"or Array-like Object. Received type "+typeof value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be of type number')}else if(size<0){throw new RangeError('The value "'+size+'" is invalid for option "size"')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError('"offset" is outside of buffer bounds')}if(array.byteLength<byteOffset+(length||0)){throw new RangeError('"length" is outside of buffer bounds')}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj.length!==undefined){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true&&b!==Buffer.prototype};Buffer.compare=function compare(a,b){if(isInstance(a,Uint8Array))a=Buffer.from(a,a.offset,a.byteLength);if(isInstance(b,Uint8Array))b=Buffer.from(b,b.offset,b.byteLength);if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array')}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)){buf=Buffer.from(buf)}if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. '+"Received type "+typeof string)}var len=string.length;var mustMatch=arguments.length>2&&arguments[2]===true;if(!mustMatch&&len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase){return mustMatch?-1:utf8ToBytes(string).length}encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.toLocaleString=Buffer.prototype.toString;Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;str=this.toString("hex",0,max).replace(/(.{2})/g,"$1 ").trim();if(this.length>max)str+=" ... ";return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)){target=Buffer.from(target,target.offset,target.byteLength)}if(!Buffer.isBuffer(target)){throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. '+"Received type "+typeof target)}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,34028234663852886e22,-34028234663852886e22)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,17976931348623157e292,-17976931348623157e292)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError("argument should be a Buffer");if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("Index out of range");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(this===target&&typeof Uint8Array.prototype.copyWithin==="function"){this.copyWithin(targetStart,start,end)}else if(this===target&&start<targetStart&&targetStart<end){for(var i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}if(val.length===1){var code=val.charCodeAt(0);if(encoding==="utf8"&&code<128||encoding==="latin1"){val=code}}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding);var len=bytes.length;if(len===0){throw new TypeError('The value "'+val+'" is invalid for argument "value"')}for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.split("=")[0];str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isInstance(obj,type){return obj instanceof type||obj!=null&&obj.constructor!=null&&obj.constructor.name!=null&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!==obj}}).call(this)}).call(this,require("buffer").Buffer)},{"base64-js":53,buffer:55,ieee754:63}],56:[function(require,module,exports){var basex=require("base-x");var ALPHABET="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";module.exports=basex(ALPHABET)},{"base-x":52}],57:[function(require,module,exports){"use strict";var base58=require("bs58");var Buffer=require("safe-buffer").Buffer;module.exports=function(checksumFn){function encode(payload){var checksum=checksumFn(payload);return base58.encode(Buffer.concat([payload,checksum],payload.length+4))}function decodeRaw(buffer){var payload=buffer.slice(0,-4);var checksum=buffer.slice(-4);var newChecksum=checksumFn(payload);if(checksum[0]^newChecksum[0]|checksum[1]^newChecksum[1]|checksum[2]^newChecksum[2]|checksum[3]^newChecksum[3])return;return payload}function decodeUnsafe(string){var buffer=base58.decodeUnsafe(string);if(!buffer)return;return decodeRaw(buffer)}function decode(string){var buffer=base58.decode(string);var payload=decodeRaw(buffer,checksumFn);if(!payload)throw new Error("Invalid checksum");return payload}return{encode:encode,decode:decode,decodeUnsafe:decodeUnsafe}}},{bs58:56,"safe-buffer":68}],58:[function(require,module,exports){"use strict";var createHash=require("create-hash");var bs58checkBase=require("./base");function sha256x2(buffer){var tmp=createHash("sha256").update(buffer).digest();return createHash("sha256").update(tmp).digest()}module.exports=bs58checkBase(sha256x2)},{"./base":57,"create-hash":60}],59:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer;var Transform=require("stream").Transform;var StringDecoder=require("string_decoder").StringDecoder;var inherits=require("inherits");function CipherBase(hashMode){Transform.call(this);this.hashMode=typeof hashMode==="string";if(this.hashMode){this[hashMode]=this._finalOrDigest}else{this.final=this._finalOrDigest}if(this._final){this.__final=this._final;this._final=null}this._decoder=null;this._encoding=null}inherits(CipherBase,Transform);CipherBase.prototype.update=function(data,inputEnc,outputEnc){if(typeof data==="string"){data=Buffer.from(data,inputEnc)}var outData=this._update(data);if(this.hashMode)return this;if(outputEnc){outData=this._toString(outData,outputEnc)}return outData};CipherBase.prototype.setAutoPadding=function(){};CipherBase.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")};CipherBase.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")};CipherBase.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")};CipherBase.prototype._transform=function(data,_,next){var err;try{if(this.hashMode){this._update(data)}else{this.push(this._update(data))}}catch(e){err=e}finally{next(err)}};CipherBase.prototype._flush=function(done){var err;try{this.push(this.__final())}catch(e){err=e}done(err)};CipherBase.prototype._finalOrDigest=function(outputEnc){var outData=this.__final()||Buffer.alloc(0);if(outputEnc){outData=this._toString(outData,outputEnc,true)}return outData};CipherBase.prototype._toString=function(value,enc,fin){if(!this._decoder){this._decoder=new StringDecoder(enc);this._encoding=enc}if(this._encoding!==enc)throw new Error("can't switch encodings");var out=this._decoder.write(value);if(fin){out+=this._decoder.end()}return out};module.exports=CipherBase},{inherits:64,"safe-buffer":68,stream:77,string_decoder:92}],60:[function(require,module,exports){"use strict";var inherits=require("inherits");var MD5=require("md5.js");var RIPEMD160=require("ripemd160");var sha=require("sha.js");var Base=require("cipher-base");function Hash(hash){Base.call(this,"digest");this._hash=hash}inherits(Hash,Base);Hash.prototype._update=function(data){this._hash.update(data)};Hash.prototype._final=function(){return this._hash.digest()};module.exports=function createHash(alg){alg=alg.toLowerCase();if(alg==="md5")return new MD5;if(alg==="rmd160"||alg==="ripemd160")return new RIPEMD160;return new Hash(sha(alg))}},{"cipher-base":59,inherits:64,"md5.js":65,ripemd160:67,"sha.js":70}],61:[function(require,module,exports){"use strict";var R=typeof Reflect==="object"?Reflect:null;var ReflectApply=R&&typeof R.apply==="function"?R.apply:function ReflectApply(target,receiver,args){return Function.prototype.apply.call(target,receiver,args)};var ReflectOwnKeys;if(R&&typeof R.ownKeys==="function"){ReflectOwnKeys=R.ownKeys}else if(Object.getOwnPropertySymbols){ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target).concat(Object.getOwnPropertySymbols(target))}}else{ReflectOwnKeys=function ReflectOwnKeys(target){return Object.getOwnPropertyNames(target)}}function ProcessEmitWarning(warning){if(console&&console.warn)console.warn(warning)}var NumberIsNaN=Number.isNaN||function NumberIsNaN(value){return value!==value};function EventEmitter(){EventEmitter.init.call(this)}module.exports=EventEmitter;module.exports.once=once;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=undefined;var defaultMaxListeners=10;function checkListener(listener){if(typeof listener!=="function"){throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof listener)}}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:true,get:function(){return defaultMaxListeners},set:function(arg){if(typeof arg!=="number"||arg<0||NumberIsNaN(arg)){throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+arg+".")}defaultMaxListeners=arg}});EventEmitter.init=function(){if(this._events===undefined||this._events===Object.getPrototypeOf(this)._events){this._events=Object.create(null);this._eventsCount=0}this._maxListeners=this._maxListeners||undefined};EventEmitter.prototype.setMaxListeners=function setMaxListeners(n){if(typeof n!=="number"||n<0||NumberIsNaN(n)){throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".")}this._maxListeners=n;return this};function _getMaxListeners(that){if(that._maxListeners===undefined)return EventEmitter.defaultMaxListeners;return that._maxListeners}EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function emit(type){var args=[];for(var i=1;i<arguments.length;i++)args.push(arguments[i]);var doError=type==="error";var events=this._events;if(events!==undefined)doError=doError&&events.error===undefined;else if(!doError)return false;if(doError){var er;if(args.length>0)er=args[0];if(er instanceof Error){throw er}var err=new Error("Unhandled error."+(er?" ("+er.message+")":""));err.context=er;throw err}var handler=events[type];if(handler===undefined)return false;if(typeof handler==="function"){ReflectApply(handler,this,args)}else{var len=handler.length;var listeners=arrayClone(handler,len);for(var i=0;i<len;++i)ReflectApply(listeners[i],this,args)}return true};function _addListener(target,type,listener,prepend){var m;var events;var existing;checkListener(listener);events=target._events;if(events===undefined){events=target._events=Object.create(null);target._eventsCount=0}else{if(events.newListener!==undefined){target.emit("newListener",type,listener.listener?listener.listener:listener);events=target._events}existing=events[type]}if(existing===undefined){existing=events[type]=listener;++target._eventsCount}else{if(typeof existing==="function"){existing=events[type]=prepend?[listener,existing]:[existing,listener]}else if(prepend){existing.unshift(listener)}else{existing.push(listener)}m=_getMaxListeners(target);if(m>0&&existing.length>m&&!existing.warned){existing.warned=true;var w=new Error("Possible EventEmitter memory leak detected. "+existing.length+" "+String(type)+" listeners "+"added. Use emitter.setMaxListeners() to "+"increase limit");w.name="MaxListenersExceededWarning";w.emitter=target;w.type=type;w.count=existing.length;ProcessEmitWarning(w)}}return target}EventEmitter.prototype.addListener=function addListener(type,listener){return _addListener(this,type,listener,false)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function prependListener(type,listener){return _addListener(this,type,listener,true)};function onceWrapper(){if(!this.fired){this.target.removeListener(this.type,this.wrapFn);this.fired=true;if(arguments.length===0)return this.listener.call(this.target);return this.listener.apply(this.target,arguments)}}function _onceWrap(target,type,listener){var state={fired:false,wrapFn:undefined,target:target,type:type,listener:listener};var wrapped=onceWrapper.bind(state);wrapped.listener=listener;state.wrapFn=wrapped;return wrapped}EventEmitter.prototype.once=function once(type,listener){checkListener(listener);this.on(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.prependOnceListener=function prependOnceListener(type,listener){checkListener(listener);this.prependListener(type,_onceWrap(this,type,listener));return this};EventEmitter.prototype.removeListener=function removeListener(type,listener){var list,events,position,i,originalListener;checkListener(listener);events=this._events;if(events===undefined)return this;list=events[type];if(list===undefined)return this;if(list===listener||list.listener===listener){if(--this._eventsCount===0)this._events=Object.create(null);else{delete events[type];if(events.removeListener)this.emit("removeListener",type,list.listener||listener)}}else if(typeof list!=="function"){position=-1;for(i=list.length-1;i>=0;i--){if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener;position=i;break}}if(position<0)return this;if(position===0)list.shift();else{spliceOne(list,position)}if(list.length===1)events[type]=list[0];if(events.removeListener!==undefined)this.emit("removeListener",type,originalListener||listener)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function removeAllListeners(type){var listeners,events,i;events=this._events;if(events===undefined)return this;if(events.removeListener===undefined){if(arguments.length===0){this._events=Object.create(null);this._eventsCount=0}else if(events[type]!==undefined){if(--this._eventsCount===0)this._events=Object.create(null);else delete events[type]}return this}if(arguments.length===0){var keys=Object.keys(events);var key;for(i=0;i<keys.length;++i){key=keys[i];if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events=Object.create(null);this._eventsCount=0;return this}listeners=events[type];if(typeof listeners==="function"){this.removeListener(type,listeners)}else if(listeners!==undefined){for(i=listeners.length-1;i>=0;i--){this.removeListener(type,listeners[i])}}return this};function _listeners(target,type,unwrap){var events=target._events;if(events===undefined)return[];var evlistener=events[type];if(evlistener===undefined)return[];if(typeof evlistener==="function")return unwrap?[evlistener.listener||evlistener]:[evlistener];return unwrap?unwrapListeners(evlistener):arrayClone(evlistener,evlistener.length)}EventEmitter.prototype.listeners=function listeners(type){return _listeners(this,type,true)};EventEmitter.prototype.rawListeners=function rawListeners(type){return _listeners(this,type,false)};EventEmitter.listenerCount=function(emitter,type){if(typeof emitter.listenerCount==="function"){return emitter.listenerCount(type)}else{return listenerCount.call(emitter,type)}};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(type){var events=this._events;if(events!==undefined){var evlistener=events[type];if(typeof evlistener==="function"){return 1}else if(evlistener!==undefined){return evlistener.length}}return 0}EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(arr,n){var copy=new Array(n);for(var i=0;i<n;++i)copy[i]=arr[i];return copy}function spliceOne(list,index){for(;index+1<list.length;index++)list[index]=list[index+1];list.pop()}function unwrapListeners(arr){var ret=new Array(arr.length);for(var i=0;i<ret.length;++i){ret[i]=arr[i].listener||arr[i]}return ret}function once(emitter,name){return new Promise(function(resolve,reject){function errorListener(err){emitter.removeListener(name,resolver);reject(err)}function resolver(){if(typeof emitter.removeListener==="function"){emitter.removeListener("error",errorListener)}resolve([].slice.call(arguments))}eventTargetAgnosticAddListener(emitter,name,resolver,{once:true});if(name!=="error"){addErrorHandlerIfEventEmitter(emitter,errorListener,{once:true})}})}function addErrorHandlerIfEventEmitter(emitter,handler,flags){if(typeof emitter.on==="function"){eventTargetAgnosticAddListener(emitter,"error",handler,flags)}}function eventTargetAgnosticAddListener(emitter,name,listener,flags){if(typeof emitter.on==="function"){if(flags.once){emitter.once(name,listener)}else{emitter.on(name,listener)}}else if(typeof emitter.addEventListener==="function"){emitter.addEventListener(name,function wrapListener(arg){if(flags.once){emitter.removeEventListener(name,wrapListener)}listener(arg)})}else{throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof emitter)}}},{}],62:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer;var Transform=require("stream").Transform;var inherits=require("inherits");function throwIfNotStringOrBuffer(val,prefix){if(!Buffer.isBuffer(val)&&typeof val!=="string"){throw new TypeError(prefix+" must be a string or a buffer")}}function HashBase(blockSize){Transform.call(this);this._block=Buffer.allocUnsafe(blockSize);this._blockSize=blockSize;this._blockOffset=0;this._length=[0,0,0,0];this._finalized=false}inherits(HashBase,Transform);HashBase.prototype._transform=function(chunk,encoding,callback){var error=null;try{this.update(chunk,encoding)}catch(err){error=err}callback(error)};HashBase.prototype._flush=function(callback){var error=null;try{this.push(this.digest())}catch(err){error=err}callback(error)};HashBase.prototype.update=function(data,encoding){throwIfNotStringOrBuffer(data,"Data");if(this._finalized)throw new Error("Digest already called");if(!Buffer.isBuffer(data))data=Buffer.from(data,encoding);var block=this._block;var offset=0;while(this._blockOffset+data.length-offset>=this._blockSize){for(var i=this._blockOffset;i<this._blockSize;)block[i++]=data[offset++];this._update();this._blockOffset=0}while(offset<data.length)block[this._blockOffset++]=data[offset++];for(var j=0,carry=data.length*8;carry>0;++j){this._length[j]+=carry;carry=this._length[j]/4294967296|0;if(carry>0)this._length[j]-=4294967296*carry}return this};HashBase.prototype._update=function(){throw new Error("_update is not implemented")};HashBase.prototype.digest=function(encoding){if(this._finalized)throw new Error("Digest already called");this._finalized=true;var digest=this._digest();if(encoding!==undefined)digest=digest.toString(encoding);this._block.fill(0);this._blockOffset=0;for(var i=0;i<4;++i)this._length[i]=0;return digest};HashBase.prototype._digest=function(){throw new Error("_digest is not implemented")};module.exports=HashBase},{inherits:64,"safe-buffer":68,stream:77}],63:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],64:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}}else{module.exports=function inherits(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}}},{}],65:[function(require,module,exports){"use strict";var inherits=require("inherits");var HashBase=require("hash-base");var Buffer=require("safe-buffer").Buffer;var ARRAY16=new Array(16);function MD5(){HashBase.call(this,64);this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878}inherits(MD5,HashBase);MD5.prototype._update=function(){var M=ARRAY16;for(var i=0;i<16;++i)M[i]=this._block.readInt32LE(i*4);var a=this._a;var b=this._b;var c=this._c;var d=this._d;a=fnF(a,b,c,d,M[0],3614090360,7);d=fnF(d,a,b,c,M[1],3905402710,12);c=fnF(c,d,a,b,M[2],606105819,17);b=fnF(b,c,d,a,M[3],3250441966,22);a=fnF(a,b,c,d,M[4],4118548399,7);d=fnF(d,a,b,c,M[5],1200080426,12);c=fnF(c,d,a,b,M[6],2821735955,17);b=fnF(b,c,d,a,M[7],4249261313,22);a=fnF(a,b,c,d,M[8],1770035416,7);d=fnF(d,a,b,c,M[9],2336552879,12);c=fnF(c,d,a,b,M[10],4294925233,17);b=fnF(b,c,d,a,M[11],2304563134,22);a=fnF(a,b,c,d,M[12],1804603682,7);d=fnF(d,a,b,c,M[13],4254626195,12);c=fnF(c,d,a,b,M[14],2792965006,17);b=fnF(b,c,d,a,M[15],1236535329,22);a=fnG(a,b,c,d,M[1],4129170786,5);d=fnG(d,a,b,c,M[6],3225465664,9);c=fnG(c,d,a,b,M[11],643717713,14);b=fnG(b,c,d,a,M[0],3921069994,20);a=fnG(a,b,c,d,M[5],3593408605,5);d=fnG(d,a,b,c,M[10],38016083,9);c=fnG(c,d,a,b,M[15],3634488961,14);b=fnG(b,c,d,a,M[4],3889429448,20);a=fnG(a,b,c,d,M[9],568446438,5);d=fnG(d,a,b,c,M[14],3275163606,9);c=fnG(c,d,a,b,M[3],4107603335,14);b=fnG(b,c,d,a,M[8],1163531501,20);a=fnG(a,b,c,d,M[13],2850285829,5);d=fnG(d,a,b,c,M[2],4243563512,9);c=fnG(c,d,a,b,M[7],1735328473,14);b=fnG(b,c,d,a,M[12],2368359562,20);a=fnH(a,b,c,d,M[5],4294588738,4);d=fnH(d,a,b,c,M[8],2272392833,11);c=fnH(c,d,a,b,M[11],1839030562,16);b=fnH(b,c,d,a,M[14],4259657740,23);a=fnH(a,b,c,d,M[1],2763975236,4);d=fnH(d,a,b,c,M[4],1272893353,11);c=fnH(c,d,a,b,M[7],4139469664,16);b=fnH(b,c,d,a,M[10],3200236656,23);a=fnH(a,b,c,d,M[13],681279174,4);d=fnH(d,a,b,c,M[0],3936430074,11);c=fnH(c,d,a,b,M[3],3572445317,16);b=fnH(b,c,d,a,M[6],76029189,23);a=fnH(a,b,c,d,M[9],3654602809,4);d=fnH(d,a,b,c,M[12],3873151461,11);c=fnH(c,d,a,b,M[15],530742520,16);b=fnH(b,c,d,a,M[2],3299628645,23);a=fnI(a,b,c,d,M[0],4096336452,6);d=fnI(d,a,b,c,M[7],1126891415,10);c=fnI(c,d,a,b,M[14],2878612391,15);b=fnI(b,c,d,a,M[5],4237533241,21);a=fnI(a,b,c,d,M[12],1700485571,6);d=fnI(d,a,b,c,M[3],2399980690,10);c=fnI(c,d,a,b,M[10],4293915773,15);b=fnI(b,c,d,a,M[1],2240044497,21);a=fnI(a,b,c,d,M[8],1873313359,6);d=fnI(d,a,b,c,M[15],4264355552,10);c=fnI(c,d,a,b,M[6],2734768916,15);b=fnI(b,c,d,a,M[13],1309151649,21);a=fnI(a,b,c,d,M[4],4149444226,6);d=fnI(d,a,b,c,M[11],3174756917,10);c=fnI(c,d,a,b,M[2],718787259,15);b=fnI(b,c,d,a,M[9],3951481745,21);this._a=this._a+a|0;this._b=this._b+b|0;this._c=this._c+c|0;this._d=this._d+d|0};MD5.prototype._digest=function(){this._block[this._blockOffset++]=128;if(this._blockOffset>56){this._block.fill(0,this._blockOffset,64);this._update();this._blockOffset=0}this._block.fill(0,this._blockOffset,56);this._block.writeUInt32LE(this._length[0],56);this._block.writeUInt32LE(this._length[1],60);this._update();var buffer=Buffer.allocUnsafe(16);buffer.writeInt32LE(this._a,0);buffer.writeInt32LE(this._b,4);buffer.writeInt32LE(this._c,8);buffer.writeInt32LE(this._d,12);return buffer};function rotl(x,n){return x<<n|x>>>32-n}function fnF(a,b,c,d,m,k,s){return rotl(a+(b&c|~b&d)+m+k|0,s)+b|0}function fnG(a,b,c,d,m,k,s){return rotl(a+(b&d|c&~d)+m+k|0,s)+b|0}function fnH(a,b,c,d,m,k,s){return rotl(a+(b^c^d)+m+k|0,s)+b|0}function fnI(a,b,c,d,m,k,s){return rotl(a+(c^(b|~d))+m+k|0,s)+b|0}module.exports=MD5},{"hash-base":62,inherits:64,"safe-buffer":68}],66:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],67:[function(require,module,exports){"use strict";var Buffer=require("buffer").Buffer;var inherits=require("inherits");var HashBase=require("hash-base");var ARRAY16=new Array(16);var zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];var hl=[0,1518500249,1859775393,2400959708,2840853838];var hr=[1352829926,1548603684,1836072691,2053994217,0];function RIPEMD160(){HashBase.call(this,64);this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520}inherits(RIPEMD160,HashBase);RIPEMD160.prototype._update=function(){var words=ARRAY16;for(var j=0;j<16;++j)words[j]=this._block.readInt32LE(j*4);var al=this._a|0;var bl=this._b|0;var cl=this._c|0;var dl=this._d|0;var el=this._e|0;var ar=this._a|0;var br=this._b|0;var cr=this._c|0;var dr=this._d|0;var er=this._e|0;for(var i=0;i<80;i+=1){var tl;var tr;if(i<16){tl=fn1(al,bl,cl,dl,el,words[zl[i]],hl[0],sl[i]);tr=fn5(ar,br,cr,dr,er,words[zr[i]],hr[0],sr[i])}else if(i<32){tl=fn2(al,bl,cl,dl,el,words[zl[i]],hl[1],sl[i]);tr=fn4(ar,br,cr,dr,er,words[zr[i]],hr[1],sr[i])}else if(i<48){tl=fn3(al,bl,cl,dl,el,words[zl[i]],hl[2],sl[i]);tr=fn3(ar,br,cr,dr,er,words[zr[i]],hr[2],sr[i])}else if(i<64){tl=fn4(al,bl,cl,dl,el,words[zl[i]],hl[3],sl[i]);tr=fn2(ar,br,cr,dr,er,words[zr[i]],hr[3],sr[i])}else{tl=fn5(al,bl,cl,dl,el,words[zl[i]],hl[4],sl[i]);tr=fn1(ar,br,cr,dr,er,words[zr[i]],hr[4],sr[i])}al=el;el=dl;dl=rotl(cl,10);cl=bl;bl=tl;ar=er;er=dr;dr=rotl(cr,10);cr=br;br=tr}var t=this._b+cl+dr|0;this._b=this._c+dl+er|0;this._c=this._d+el+ar|0;this._d=this._e+al+br|0;this._e=this._a+bl+cr|0;this._a=t};RIPEMD160.prototype._digest=function(){this._block[this._blockOffset++]=128;if(this._blockOffset>56){this._block.fill(0,this._blockOffset,64);this._update();this._blockOffset=0}this._block.fill(0,this._blockOffset,56);this._block.writeUInt32LE(this._length[0],56);this._block.writeUInt32LE(this._length[1],60);this._update();var buffer=Buffer.alloc?Buffer.alloc(20):new Buffer(20);buffer.writeInt32LE(this._a,0);buffer.writeInt32LE(this._b,4);buffer.writeInt32LE(this._c,8);buffer.writeInt32LE(this._d,12);buffer.writeInt32LE(this._e,16);return buffer};function rotl(x,n){return x<<n|x>>>32-n}function fn1(a,b,c,d,e,m,k,s){return rotl(a+(b^c^d)+m+k|0,s)+e|0}function fn2(a,b,c,d,e,m,k,s){return rotl(a+(b&c|~b&d)+m+k|0,s)+e|0}function fn3(a,b,c,d,e,m,k,s){return rotl(a+((b|~c)^d)+m+k|0,s)+e|0}function fn4(a,b,c,d,e,m,k,s){return rotl(a+(b&d|c&~d)+m+k|0,s)+e|0}function fn5(a,b,c,d,e,m,k,s){return rotl(a+(b^(c|~d))+m+k|0,s)+e|0}module.exports=RIPEMD160},{buffer:55,"hash-base":62,inherits:64}],68:[function(require,module,exports){var buffer=require("buffer");var Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports);exports.Buffer=SafeBuffer}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}SafeBuffer.prototype=Object.create(Buffer.prototype);copyProps(Buffer,SafeBuffer);SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==="number"){throw new TypeError("Argument must not be a number")}return Buffer(arg,encodingOrOffset,length)};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==="string"){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}return buf};SafeBuffer.allocUnsafe=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return Buffer(size)};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return buffer.SlowBuffer(size)}},{buffer:55}],69:[function(require,module,exports){var Buffer=require("safe-buffer").Buffer;function Hash(blockSize,finalSize){this._block=Buffer.alloc(blockSize);this._finalSize=finalSize;this._blockSize=blockSize;this._len=0}Hash.prototype.update=function(data,enc){if(typeof data==="string"){enc=enc||"utf8";data=Buffer.from(data,enc)}var block=this._block;var blockSize=this._blockSize;var length=data.length;var accum=this._len;for(var offset=0;offset<length;){var assigned=accum%blockSize;var remainder=Math.min(length-offset,blockSize-assigned);for(var i=0;i<remainder;i++){block[assigned+i]=data[offset+i]}accum+=remainder;offset+=remainder;if(accum%blockSize===0){this._update(block)}}this._len+=length;return this};Hash.prototype.digest=function(enc){var rem=this._len%this._blockSize;this._block[rem]=128;this._block.fill(0,rem+1);if(rem>=this._finalSize){this._update(this._block);this._block.fill(0)}var bits=this._len*8;if(bits<=4294967295){this._block.writeUInt32BE(bits,this._blockSize-4)}else{var lowBits=(bits&4294967295)>>>0;var highBits=(bits-lowBits)/4294967296;this._block.writeUInt32BE(highBits,this._blockSize-8);this._block.writeUInt32BE(lowBits,this._blockSize-4)}this._update(this._block);var hash=this._hash();return enc?hash.toString(enc):hash};Hash.prototype._update=function(){throw new Error("_update must be implemented by subclass")};module.exports=Hash},{"safe-buffer":68}],70:[function(require,module,exports){var exports=module.exports=function SHA(algorithm){algorithm=algorithm.toLowerCase();var Algorithm=exports[algorithm];if(!Algorithm)throw new Error(algorithm+" is not supported (we accept pull requests)");return new Algorithm};exports.sha=require("./sha");exports.sha1=require("./sha1");exports.sha224=require("./sha224");exports.sha256=require("./sha256");exports.sha384=require("./sha384");exports.sha512=require("./sha512")},{"./sha":71,"./sha1":72,"./sha224":73,"./sha256":74,"./sha384":75,"./sha512":76}],71:[function(require,module,exports){var inherits=require("inherits");var Hash=require("./hash");var Buffer=require("safe-buffer").Buffer;var K=[1518500249,1859775393,2400959708|0,3395469782|0];var W=new Array(80);function Sha(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha,Hash);Sha.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;return this};function rotl5(num){return num<<5|num>>>27}function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){if(s===0)return b&c|~b&d;if(s===2)return b&c|b&d|c&d;return b^c^d}Sha.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<80;++i)W[i]=W[i-3]^W[i-8]^W[i-14]^W[i-16];for(var j=0;j<80;++j){var s=~~(j/20);var t=rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s]|0;e=d;d=c;c=rotl30(b);b=a;a=t}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha.prototype._hash=function(){var H=Buffer.allocUnsafe(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha},{"./hash":69,inherits:64,"safe-buffer":68}],72:[function(require,module,exports){var inherits=require("inherits");var Hash=require("./hash");var Buffer=require("safe-buffer").Buffer;var K=[1518500249,1859775393,2400959708|0,3395469782|0];var W=new Array(80);function Sha1(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha1,Hash);Sha1.prototype.init=function(){this._a=1732584193;this._b=4023233417;this._c=2562383102;this._d=271733878;this._e=3285377520;return this};function rotl1(num){return num<<1|num>>>31}function rotl5(num){return num<<5|num>>>27}function rotl30(num){return num<<30|num>>>2}function ft(s,b,c,d){if(s===0)return b&c|~b&d;if(s===2)return b&c|b&d|c&d;return b^c^d}Sha1.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<80;++i)W[i]=rotl1(W[i-3]^W[i-8]^W[i-14]^W[i-16]);for(var j=0;j<80;++j){var s=~~(j/20);var t=rotl5(a)+ft(s,b,c,d)+e+W[j]+K[s]|0;e=d;d=c;c=rotl30(b);b=a;a=t}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha1.prototype._hash=function(){var H=Buffer.allocUnsafe(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha1},{"./hash":69,inherits:64,"safe-buffer":68}],73:[function(require,module,exports){var inherits=require("inherits");var Sha256=require("./sha256");var Hash=require("./hash");var Buffer=require("safe-buffer").Buffer;var W=new Array(64);function Sha224(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha224,Sha256);Sha224.prototype.init=function(){this._a=3238371032;this._b=914150663;this._c=812702999;this._d=4144912697;this._e=4290775857;this._f=1750603025;this._g=1694076839;this._h=3204075428;return this};Sha224.prototype._hash=function(){var H=Buffer.allocUnsafe(28);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);return H};module.exports=Sha224},{"./hash":69,"./sha256":74,inherits:64,"safe-buffer":68}],74:[function(require,module,exports){var inherits=require("inherits");var Hash=require("./hash");var Buffer=require("safe-buffer").Buffer;var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var W=new Array(64);function Sha256(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha256,Hash);Sha256.prototype.init=function(){this._a=1779033703;this._b=3144134277;this._c=1013904242;this._d=2773480762;this._e=1359893119;this._f=2600822924;this._g=528734635;this._h=1541459225;return this};function ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x){return(x>>>2|x<<30)^(x>>>13|x<<19)^(x>>>22|x<<10)}function sigma1(x){return(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7)}function gamma0(x){return(x>>>7|x<<25)^(x>>>18|x<<14)^x>>>3}function gamma1(x){return(x>>>17|x<<15)^(x>>>19|x<<13)^x>>>10}Sha256.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;var f=this._f|0;var g=this._g|0;var h=this._h|0;for(var i=0;i<16;++i)W[i]=M.readInt32BE(i*4);for(;i<64;++i)W[i]=gamma1(W[i-2])+W[i-7]+gamma0(W[i-15])+W[i-16]|0;for(var j=0;j<64;++j){var T1=h+sigma1(e)+ch(e,f,g)+K[j]+W[j]|0;var T2=sigma0(a)+maj(a,b,c)|0;h=g;g=f;f=e;e=d+T1|0;d=c;c=b;b=a;a=T1+T2|0}this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0;this._f=f+this._f|0;this._g=g+this._g|0;this._h=h+this._h|0};Sha256.prototype._hash=function(){var H=Buffer.allocUnsafe(32);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);H.writeInt32BE(this._h,28);return H};module.exports=Sha256},{"./hash":69,inherits:64,"safe-buffer":68}],75:[function(require,module,exports){var inherits=require("inherits");var SHA512=require("./sha512");var Hash=require("./hash");var Buffer=require("safe-buffer").Buffer;var W=new Array(160);function Sha384(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha384,SHA512);Sha384.prototype.init=function(){this._ah=3418070365;this._bh=1654270250;this._ch=2438529370;this._dh=355462360;this._eh=1731405415;this._fh=2394180231;this._gh=3675008525;this._hh=1203062813;this._al=3238371032;this._bl=914150663;this._cl=812702999;this._dl=4144912697;this._el=4290775857;this._fl=1750603025;this._gl=1694076839;this._hl=3204075428;return this};Sha384.prototype._hash=function(){var H=Buffer.allocUnsafe(48);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._ah,this._al,0);writeInt64BE(this._bh,this._bl,8);writeInt64BE(this._ch,this._cl,16);writeInt64BE(this._dh,this._dl,24);writeInt64BE(this._eh,this._el,32);writeInt64BE(this._fh,this._fl,40);return H};module.exports=Sha384},{"./hash":69,"./sha512":76,inherits:64,"safe-buffer":68}],76:[function(require,module,exports){var inherits=require("inherits");var Hash=require("./hash");var Buffer=require("safe-buffer").Buffer;var K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];var W=new Array(160);function Sha512(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha512,Hash);Sha512.prototype.init=function(){this._ah=1779033703;this._bh=3144134277;this._ch=1013904242;this._dh=2773480762;this._eh=1359893119;this._fh=2600822924;this._gh=528734635;this._hh=1541459225;this._al=4089235720;this._bl=2227873595;this._cl=4271175723;this._dl=1595750129;this._el=2917565137;this._fl=725511199;this._gl=4215389547;this._hl=327033209;return this};function Ch(x,y,z){return z^x&(y^z)}function maj(x,y,z){return x&y|z&(x|y)}function sigma0(x,xl){return(x>>>28|xl<<4)^(xl>>>2|x<<30)^(xl>>>7|x<<25)}function sigma1(x,xl){return(x>>>14|xl<<18)^(x>>>18|xl<<14)^(xl>>>9|x<<23)}function Gamma0(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^x>>>7}function Gamma0l(x,xl){return(x>>>1|xl<<31)^(x>>>8|xl<<24)^(x>>>7|xl<<25)}function Gamma1(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^x>>>6}function Gamma1l(x,xl){return(x>>>19|xl<<13)^(xl>>>29|x<<3)^(x>>>6|xl<<26)}function getCarry(a,b){return a>>>0<b>>>0?1:0}Sha512.prototype._update=function(M){var W=this._w;var ah=this._ah|0;var bh=this._bh|0;var ch=this._ch|0;var dh=this._dh|0;var eh=this._eh|0;var fh=this._fh|0;var gh=this._gh|0;var hh=this._hh|0;var al=this._al|0;var bl=this._bl|0;var cl=this._cl|0;var dl=this._dl|0;var el=this._el|0;var fl=this._fl|0;var gl=this._gl|0;var hl=this._hl|0;for(var i=0;i<32;i+=2){W[i]=M.readInt32BE(i*4);W[i+1]=M.readInt32BE(i*4+4)}for(;i<160;i+=2){var xh=W[i-15*2];var xl=W[i-15*2+1];var gamma0=Gamma0(xh,xl);var gamma0l=Gamma0l(xl,xh);xh=W[i-2*2];xl=W[i-2*2+1];var gamma1=Gamma1(xh,xl);var gamma1l=Gamma1l(xl,xh);var Wi7h=W[i-7*2];var Wi7l=W[i-7*2+1];var Wi16h=W[i-16*2];var Wi16l=W[i-16*2+1];var Wil=gamma0l+Wi7l|0;var Wih=gamma0+Wi7h+getCarry(Wil,gamma0l)|0;Wil=Wil+gamma1l|0;Wih=Wih+gamma1+getCarry(Wil,gamma1l)|0;Wil=Wil+Wi16l|0;Wih=Wih+Wi16h+getCarry(Wil,Wi16l)|0;W[i]=Wih;W[i+1]=Wil}for(var j=0;j<160;j+=2){Wih=W[j];Wil=W[j+1];var majh=maj(ah,bh,ch);var majl=maj(al,bl,cl);var sigma0h=sigma0(ah,al);var sigma0l=sigma0(al,ah);var sigma1h=sigma1(eh,el);var sigma1l=sigma1(el,eh);var Kih=K[j];var Kil=K[j+1];var chh=Ch(eh,fh,gh);var chl=Ch(el,fl,gl);var t1l=hl+sigma1l|0;var t1h=hh+sigma1h+getCarry(t1l,hl)|0;t1l=t1l+chl|0;t1h=t1h+chh+getCarry(t1l,chl)|0;t1l=t1l+Kil|0;t1h=t1h+Kih+getCarry(t1l,Kil)|0;t1l=t1l+Wil|0;t1h=t1h+Wih+getCarry(t1l,Wil)|0;var t2l=sigma0l+majl|0;var t2h=sigma0h+majh+getCarry(t2l,sigma0l)|0;hh=gh;hl=gl;gh=fh;gl=fl;fh=eh;fl=el;el=dl+t1l|0;eh=dh+t1h+getCarry(el,dl)|0;dh=ch;dl=cl;ch=bh;cl=bl;bh=ah;bl=al;al=t1l+t2l|0;ah=t1h+t2h+getCarry(al,t1l)|0}this._al=this._al+al|0;this._bl=this._bl+bl|0;this._cl=this._cl+cl|0;this._dl=this._dl+dl|0;this._el=this._el+el|0;this._fl=this._fl+fl|0;this._gl=this._gl+gl|0;this._hl=this._hl+hl|0;this._ah=this._ah+ah+getCarry(this._al,al)|0;this._bh=this._bh+bh+getCarry(this._bl,bl)|0;this._ch=this._ch+ch+getCarry(this._cl,cl)|0;this._dh=this._dh+dh+getCarry(this._dl,dl)|0;this._eh=this._eh+eh+getCarry(this._el,el)|0;this._fh=this._fh+fh+getCarry(this._fl,fl)|0;this._gh=this._gh+gh+getCarry(this._gl,gl)|0;this._hh=this._hh+hh+getCarry(this._hl,hl)|0};Sha512.prototype._hash=function(){var H=Buffer.allocUnsafe(64);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._ah,this._al,0);writeInt64BE(this._bh,this._bl,8);writeInt64BE(this._ch,this._cl,16);writeInt64BE(this._dh,this._dl,24);writeInt64BE(this._eh,this._el,32);writeInt64BE(this._fh,this._fl,40);writeInt64BE(this._gh,this._gl,48);writeInt64BE(this._hh,this._hl,56);return H};module.exports=Sha512},{"./hash":69,inherits:64,"safe-buffer":68}],77:[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/lib/_stream_readable.js");Stream.Writable=require("readable-stream/lib/_stream_writable.js");Stream.Duplex=require("readable-stream/lib/_stream_duplex.js");Stream.Transform=require("readable-stream/lib/_stream_transform.js");Stream.PassThrough=require("readable-stream/lib/_stream_passthrough.js");Stream.finished=require("readable-stream/lib/internal/streams/end-of-stream.js");Stream.pipeline=require("readable-stream/lib/internal/streams/pipeline.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:61,inherits:64,"readable-stream/lib/_stream_duplex.js":79,"readable-stream/lib/_stream_passthrough.js":80,"readable-stream/lib/_stream_readable.js":81,"readable-stream/lib/_stream_transform.js":82,"readable-stream/lib/_stream_writable.js":83,"readable-stream/lib/internal/streams/end-of-stream.js":87,"readable-stream/lib/internal/streams/pipeline.js":89}],78:[function(require,module,exports){"use strict";function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass}var codes={};function createErrorType(code,message,Base){if(!Base){Base=Error}function getMessage(arg1,arg2,arg3){if(typeof message==="string"){return message}else{return message(arg1,arg2,arg3)}}var NodeError=function(_Base){_inheritsLoose(NodeError,_Base);function NodeError(arg1,arg2,arg3){return _Base.call(this,getMessage(arg1,arg2,arg3))||this}return NodeError}(Base);NodeError.prototype.name=Base.name;NodeError.prototype.code=code;codes[code]=NodeError}function oneOf(expected,thing){if(Array.isArray(expected)){var len=expected.length;expected=expected.map(function(i){return String(i)});if(len>2){return"one of ".concat(thing," ").concat(expected.slice(0,len-1).join(", "),", or ")+expected[len-1]}else if(len===2){return"one of ".concat(thing," ").concat(expected[0]," or ").concat(expected[1])}else{return"of ".concat(thing," ").concat(expected[0])}}else{return"of ".concat(thing," ").concat(String(expected))}}function startsWith(str,search,pos){return str.substr(!pos||pos<0?0:+pos,search.length)===search}function endsWith(str,search,this_len){if(this_len===undefined||this_len>str.length){this_len=str.length}return str.substring(this_len-search.length,this_len)===search}function includes(str,search,start){if(typeof start!=="number"){start=0}if(start+search.length>str.length){return false}else{return str.indexOf(search,start)!==-1}}createErrorType("ERR_INVALID_OPT_VALUE",function(name,value){return'The value "'+value+'" is invalid for option "'+name+'"'},TypeError);createErrorType("ERR_INVALID_ARG_TYPE",function(name,expected,actual){var determiner;if(typeof expected==="string"&&startsWith(expected,"not ")){determiner="must not be";expected=expected.replace(/^not /,"")}else{determiner="must be"}var msg;if(endsWith(name," argument")){msg="The ".concat(name," ").concat(determiner," ").concat(oneOf(expected,"type"))}else{var type=includes(name,".")?"property":"argument";msg='The "'.concat(name,'" ').concat(type," ").concat(determiner," ").concat(oneOf(expected,"type"))}msg+=". Received type ".concat(typeof actual);return msg},TypeError);createErrorType("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");createErrorType("ERR_METHOD_NOT_IMPLEMENTED",function(name){return"The "+name+" method is not implemented"});createErrorType("ERR_STREAM_PREMATURE_CLOSE","Premature close");createErrorType("ERR_STREAM_DESTROYED",function(name){return"Cannot call "+name+" after a stream was destroyed"});createErrorType("ERR_MULTIPLE_CALLBACK","Callback called multiple times");createErrorType("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");createErrorType("ERR_STREAM_WRITE_AFTER_END","write after end");createErrorType("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);createErrorType("ERR_UNKNOWN_ENCODING",function(arg){return"Unknown encoding: "+arg},TypeError);createErrorType("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event");module.exports.codes=codes},{}],79:[function(require,module,exports){(function(process){(function(){"use strict";var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){keys.push(key)}return keys};module.exports=Duplex;var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");require("inherits")(Duplex,Readable);{var keys=objectKeys(Writable.prototype);for(var v=0;v<keys.length;v++){var method=keys[v];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);this.allowHalfOpen=true;if(options){if(options.readable===false)this.readable=false;if(options.writable===false)this.writable=false;if(options.allowHalfOpen===false){this.allowHalfOpen=false;this.once("end",onend)}}}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:false,get:function get(){return this._writableState.highWaterMark}});Object.defineProperty(Duplex.prototype,"writableBuffer",{enumerable:false,get:function get(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(Duplex.prototype,"writableLength",{enumerable:false,get:function get(){return this._writableState.length}});function onend(){if(this._writableState.ended)return;process.nextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,"destroyed",{enumerable:false,get:function get(){if(this._readableState===undefined||this._writableState===undefined){return false}return this._readableState.destroyed&&this._writableState.destroyed},set:function set(value){if(this._readableState===undefined||this._writableState===undefined){return}this._readableState.destroyed=value;this._writableState.destroyed=value}})}).call(this)}).call(this,require("_process"))},{"./_stream_readable":81,"./_stream_writable":83,_process:66,inherits:64}],80:[function(require,module,exports){"use strict";module.exports=PassThrough;var Transform=require("./_stream_transform");require("inherits")(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":82,inherits:64}],81:[function(require,module,exports){(function(process,global){(function(){"use strict";module.exports=Readable;var Duplex;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;var EElistenerCount=function EElistenerCount(emitter,type){return emitter.listeners(type).length};var Stream=require("./internal/streams/stream");var Buffer=require("buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var debugUtil=require("util");var debug;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function debug(){}}var BufferList=require("./internal/streams/buffer_list");var destroyImpl=require("./internal/streams/destroy");var _require=require("./internal/streams/state"),getHighWaterMark=_require.getHighWaterMark;var _require$codes=require("../errors").codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_STREAM_PUSH_AFTER_EOF=_require$codes.ERR_STREAM_PUSH_AFTER_EOF,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_STREAM_UNSHIFT_AFTER_END_EVENT=_require$codes.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;var StringDecoder;var createReadableStreamAsyncIterator;var from;require("inherits")(Readable,Stream);var errorOrDestroy=destroyImpl.errorOrDestroy;var kProxyEvents=["error","close","destroy","pause","resume"];function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function")return emitter.prependListener(event,fn);if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(Array.isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}function ReadableState(options,stream,isDuplex){Duplex=Duplex||require("./_stream_duplex");options=options||{};if(typeof isDuplex!=="boolean")isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.readableObjectMode;this.highWaterMark=getHighWaterMark(this,options,"readableHighWaterMark",isDuplex);this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.paused=true;this.emitClose=options.emitClose!==false;this.autoDestroy=!!options.autoDestroy;this.destroyed=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);var isDuplex=this instanceof Duplex;this._readableState=new ReadableState(options,this,isDuplex);this.readable=true;if(options){if(typeof options.read==="function")this._read=options.read;if(typeof options.destroy==="function")this._destroy=options.destroy}Stream.call(this)}Object.defineProperty(Readable.prototype,"destroyed",{enumerable:false,get:function get(){if(this._readableState===undefined){return false}return this._readableState.destroyed},set:function set(value){if(!this._readableState){return}this._readableState.destroyed=value}});Readable.prototype.destroy=destroyImpl.destroy;Readable.prototype._undestroy=destroyImpl.undestroy;Readable.prototype._destroy=function(err,cb){cb(err)};Readable.prototype.push=function(chunk,encoding){var state=this._readableState;var skipChunkCheck;if(!state.objectMode){if(typeof chunk==="string"){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=Buffer.from(chunk,encoding);encoding=""}skipChunkCheck=true}}else{skipChunkCheck=true}return readableAddChunk(this,chunk,encoding,false,skipChunkCheck)};Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,true,false)};function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){debug("readableAddChunk",chunk);var state=stream._readableState;if(chunk===null){state.reading=false;onEofChunk(stream,state)}else{var er;if(!skipChunkCheck)er=chunkInvalid(state,chunk);if(er){errorOrDestroy(stream,er)}else if(state.objectMode||chunk&&chunk.length>0){if(typeof chunk!=="string"&&!state.objectMode&&Object.getPrototypeOf(chunk)!==Buffer.prototype){chunk=_uint8ArrayToBuffer(chunk)}if(addToFront){if(state.endEmitted)errorOrDestroy(stream,new ERR_STREAM_UNSHIFT_AFTER_END_EVENT);else addChunk(stream,state,chunk,true)}else if(state.ended){errorOrDestroy(stream,new ERR_STREAM_PUSH_AFTER_EOF)}else if(state.destroyed){return false}else{state.reading=false;if(state.decoder&&!encoding){chunk=state.decoder.write(chunk);if(state.objectMode||chunk.length!==0)addChunk(stream,state,chunk,false);else maybeReadMore(stream,state)}else{addChunk(stream,state,chunk,false)}}}else if(!addToFront){state.reading=false;maybeReadMore(stream,state)}}return!state.ended&&(state.length<state.highWaterMark||state.length===0)}function addChunk(stream,state,chunk,addToFront){if(state.flowing&&state.length===0&&!state.sync){state.awaitDrain=0;stream.emit("data",chunk)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}function chunkInvalid(state,chunk){var er;if(!_isUint8Array(chunk)&&typeof chunk!=="string"&&chunk!==undefined&&!state.objectMode){er=new ERR_INVALID_ARG_TYPE("chunk",["string","Buffer","Uint8Array"],chunk)}return er}Readable.prototype.isPaused=function(){return this._readableState.flowing===false};Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;var decoder=new StringDecoder(enc);this._readableState.decoder=decoder;this._readableState.encoding=this._readableState.decoder.encoding;var p=this._readableState.buffer.head;var content="";while(p!==null){content+=decoder.write(p.data);p=p.next}this._readableState.buffer.clear();if(content!=="")this._readableState.buffer.push(content);this._readableState.length=content.length;return this};var MAX_HWM=1073741824;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state){if(n<=0||state.length===0&&state.ended)return 0;if(state.objectMode)return 1;if(n!==n){if(state.flowing&&state.length)return state.buffer.head.data.length;else return state.length}if(n>state.highWaterMark)state.highWaterMark=computeNewHighWaterMark(n);if(n<=state.length)return n;if(!state.ended){state.needReadable=true;return 0}return state.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state=this._readableState;var nOrig=n;if(n!==0)state.emittedReadable=false;if(n===0&&state.needReadable&&((state.highWaterMark!==0?state.length>=state.highWaterMark:state.length>0)||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false;if(!state.reading)n=howMuchToRead(nOrig,state)}var ret;if(n>0)ret=fromList(n,state);else ret=null;if(ret===null){state.needReadable=state.length<=state.highWaterMark;n=0}else{state.length-=n;state.awaitDrain=0}if(state.length===0){if(!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function onEofChunk(stream,state){debug("onEofChunk");if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;if(state.sync){emitReadable(stream)}else{state.needReadable=false;if(!state.emittedReadable){state.emittedReadable=true;emitReadable_(stream)}}}function emitReadable(stream){var state=stream._readableState;debug("emitReadable",state.needReadable,state.emittedReadable);state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;process.nextTick(emitReadable_,stream)}}function emitReadable_(stream){var state=stream._readableState;debug("emitReadable_",state.destroyed,state.length,state.ended);if(!state.destroyed&&(state.length||state.ended)){stream.emit("readable");state.emittedReadable=false}state.needReadable=!state.flowing&&!state.ended&&state.length<=state.highWaterMark;flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(maybeReadMore_,stream,state)}}function maybeReadMore_(stream,state){while(!state.reading&&!state.ended&&(state.length<state.highWaterMark||state.flowing&&state.length===0)){var len=state.length;debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break}state.readingMore=false}Readable.prototype._read=function(n){errorOrDestroy(this,new ERR_METHOD_NOT_IMPLEMENTED("_read()"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:unpipe;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable,unpipeInfo){debug("onunpipe");if(readable===src){if(unpipeInfo&&unpipeInfo.hasUnpiped===false){unpipeInfo.hasUnpiped=true;cleanup()}}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",unpipe);src.removeListener("data",ondata);cleanedUp=true;if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);debug("dest.write",ret);if(ret===false){if((state.pipesCount===1&&state.pipes===dest||state.pipesCount>1&&indexOf(state.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",state.awaitDrain);state.awaitDrain++}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)errorOrDestroy(dest,er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function pipeOnDrainFunctionResult(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EElistenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;var unpipeInfo={hasUnpiped:false};if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this,unpipeInfo);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++){dests[i].emit("unpipe",this,{hasUnpiped:false})}return this}var index=indexOf(state.pipes,dest);if(index===-1)return this;state.pipes.splice(index,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this,unpipeInfo);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);var state=this._readableState;if(ev==="data"){state.readableListening=this.listenerCount("readable")>0;if(state.flowing!==false)this.resume()}else if(ev==="readable"){if(!state.endEmitted&&!state.readableListening){state.readableListening=state.needReadable=true;state.flowing=false;state.emittedReadable=false;debug("on readable",state.length,state.reading);if(state.length){emitReadable(this)}else if(!state.reading){process.nextTick(nReadingNextTick,this)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.removeListener=function(ev,fn){var res=Stream.prototype.removeListener.call(this,ev,fn);if(ev==="readable"){process.nextTick(updateReadableListening,this)}return res};Readable.prototype.removeAllListeners=function(ev){var res=Stream.prototype.removeAllListeners.apply(this,arguments);if(ev==="readable"||ev===undefined){process.nextTick(updateReadableListening,this)}return res};function updateReadableListening(self){var state=self._readableState;state.readableListening=self.listenerCount("readable")>0;if(state.resumeScheduled&&!state.paused){state.flowing=true}else if(self.listenerCount("data")>0){self.resume()}}function nReadingNextTick(self){debug("readable nexttick read 0");self.read(0)}Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=!state.readableListening;resume(this,state)}state.paused=false;return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;process.nextTick(resume_,stream,state)}}function resume_(stream,state){debug("resume",state.reading);if(!state.reading){stream.read(0)}state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(this._readableState.flowing!==false){debug("pause");this._readableState.flowing=false;this.emit("pause")}this._readableState.paused=true;return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);while(state.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var _this=this;var state=this._readableState;var paused=false;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)_this.push(chunk)}_this.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(state.objectMode&&(chunk===null||chunk===undefined))return;else if(!state.objectMode&&(!chunk||!chunk.length))return;var ret=_this.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(this[i]===undefined&&typeof stream[i]==="function"){this[i]=function methodWrap(method){return function methodWrapReturnFunction(){return stream[method].apply(stream,arguments)}}(i)}}for(var n=0;n<kProxyEvents.length;n++){stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]))}this._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return this};if(typeof Symbol==="function"){Readable.prototype[Symbol.asyncIterator]=function(){if(createReadableStreamAsyncIterator===undefined){createReadableStreamAsyncIterator=require("./internal/streams/async_iterator")}return createReadableStreamAsyncIterator(this)}}Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:false,get:function get(){return this._readableState.highWaterMark}});Object.defineProperty(Readable.prototype,"readableBuffer",{enumerable:false,get:function get(){return this._readableState&&this._readableState.buffer}});Object.defineProperty(Readable.prototype,"readableFlowing",{enumerable:false,get:function get(){return this._readableState.flowing},set:function set(state){if(this._readableState){this._readableState.flowing=state}}});Readable._fromList=fromList;Object.defineProperty(Readable.prototype,"readableLength",{enumerable:false,get:function get(){return this._readableState.length}});function fromList(n,state){if(state.length===0)return null;var ret;if(state.objectMode)ret=state.buffer.shift();else if(!n||n>=state.length){if(state.decoder)ret=state.buffer.join("");else if(state.buffer.length===1)ret=state.buffer.first();else ret=state.buffer.concat(state.length);state.buffer.clear()}else{ret=state.buffer.consume(n,state.decoder)}return ret}function endReadable(stream){var state=stream._readableState;debug("endReadable",state.endEmitted);if(!state.endEmitted){state.ended=true;process.nextTick(endReadableNT,state,stream)}}function endReadableNT(state,stream){debug("endReadableNT",state.endEmitted,state.length);if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end");if(state.autoDestroy){var wState=stream._writableState;if(!wState||wState.autoDestroy&&wState.finished){stream.destroy()}}}}if(typeof Symbol==="function"){Readable.from=function(iterable,opts){if(from===undefined){from=require("./internal/streams/from")}return from(Readable,iterable,opts)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../errors":78,"./_stream_duplex":79,"./internal/streams/async_iterator":84,"./internal/streams/buffer_list":85,"./internal/streams/destroy":86,"./internal/streams/from":88,"./internal/streams/state":90,"./internal/streams/stream":91,_process:66,buffer:55,events:61,inherits:64,"string_decoder/":92,util:54}],82:[function(require,module,exports){"use strict";module.exports=Transform;var _require$codes=require("../errors").codes,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes.ERR_TRANSFORM_WITH_LENGTH_0;var Duplex=require("./_stream_duplex");require("inherits")(Transform,Duplex);function afterTransform(er,data){var ts=this._transformState;ts.transforming=false;var cb=ts.writecb;if(cb===null){return this.emit("error",new ERR_MULTIPLE_CALLBACK)}ts.writechunk=null;ts.writecb=null;if(data!=null)this.push(data);cb(er);var rs=this._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){this._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState={afterTransform:afterTransform.bind(this),needTransform:false,transforming:false,writecb:null,writechunk:null,writeencoding:null};this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.on("prefinish",prefinish)}function prefinish(){var _this=this;if(typeof this._flush==="function"&&!this._readableState.destroyed){this._flush(function(er,data){done(_this,er,data)})}else{done(this,null,null)}}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED("_transform()"))};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};Transform.prototype._destroy=function(err,cb){Duplex.prototype._destroy.call(this,err,function(err2){cb(err2)})};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!=null)stream.push(data);if(stream._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if(stream._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;return stream.push(null)}},{"../errors":78,"./_stream_duplex":79,inherits:64}],83:[function(require,module,exports){(function(process,global){(function(){"use strict";module.exports=Writable;function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function CorkedRequest(state){var _this=this;this.next=null;this.entry=null;this.finish=function(){onCorkedFinish(_this,state)}}var Duplex;Writable.WritableState=WritableState;var internalUtil={deprecate:require("util-deprecate")};var Stream=require("./internal/streams/stream");var Buffer=require("buffer").Buffer;var OurUint8Array=global.Uint8Array||function(){};function _uint8ArrayToBuffer(chunk){return Buffer.from(chunk)}function _isUint8Array(obj){return Buffer.isBuffer(obj)||obj instanceof OurUint8Array}var destroyImpl=require("./internal/streams/destroy");var _require=require("./internal/streams/state"),getHighWaterMark=_require.getHighWaterMark;var _require$codes=require("../errors").codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes.ERR_MULTIPLE_CALLBACK,ERR_STREAM_CANNOT_PIPE=_require$codes.ERR_STREAM_CANNOT_PIPE,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED,ERR_STREAM_NULL_VALUES=_require$codes.ERR_STREAM_NULL_VALUES,ERR_STREAM_WRITE_AFTER_END=_require$codes.ERR_STREAM_WRITE_AFTER_END,ERR_UNKNOWN_ENCODING=_require$codes.ERR_UNKNOWN_ENCODING;var errorOrDestroy=destroyImpl.errorOrDestroy;require("inherits")(Writable,Stream);function nop(){}function WritableState(options,stream,isDuplex){Duplex=Duplex||require("./_stream_duplex");options=options||{};if(typeof isDuplex!=="boolean")isDuplex=stream instanceof Duplex;this.objectMode=!!options.objectMode;if(isDuplex)this.objectMode=this.objectMode||!!options.writableObjectMode;this.highWaterMark=getHighWaterMark(this,options,"writableHighWaterMark",isDuplex);this.finalCalled=false;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;this.destroyed=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.emitClose=options.emitClose!==false;this.autoDestroy=!!options.autoDestroy;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function writableStateBufferGetter(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer "+"instead.","DEP0003")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function value(object){if(realHasInstance.call(this,object))return true;if(this!==Writable)return false;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function realHasInstance(object){return object instanceof this}}function Writable(options){Duplex=Duplex||require("./_stream_duplex");var isDuplex=this instanceof Duplex;if(!isDuplex&&!realHasInstance.call(Writable,this))return new Writable(options);this._writableState=new WritableState(options,this,isDuplex);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev;if(typeof options.destroy==="function")this._destroy=options.destroy;if(typeof options.final==="function")this._final=options.final}Stream.call(this)}Writable.prototype.pipe=function(){errorOrDestroy(this,new ERR_STREAM_CANNOT_PIPE)};function writeAfterEnd(stream,cb){var er=new ERR_STREAM_WRITE_AFTER_END;errorOrDestroy(stream,er);process.nextTick(cb,er)}function validChunk(stream,state,chunk,cb){var er;if(chunk===null){er=new ERR_STREAM_NULL_VALUES}else if(typeof chunk!=="string"&&!state.objectMode){er=new ERR_INVALID_ARG_TYPE("chunk",["string","Buffer"],chunk)}if(er){errorOrDestroy(stream,er);process.nextTick(cb,er);return false}return true}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;var isBuf=!state.objectMode&&_isUint8Array(chunk);if(isBuf&&!Buffer.isBuffer(chunk)){chunk=_uint8ArrayToBuffer(chunk)}if(typeof encoding==="function"){cb=encoding;encoding=null}if(isBuf)encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state.ending)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,isBuf,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){this._writableState.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest)clearBuffer(this,state)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new ERR_UNKNOWN_ENCODING(encoding);this._writableState.defaultEncoding=encoding;return this};Object.defineProperty(Writable.prototype,"writableBuffer",{enumerable:false,get:function get(){return this._writableState&&this._writableState.getBuffer()}});function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&typeof chunk==="string"){chunk=Buffer.from(chunk,encoding)}return chunk}Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:false,get:function get(){return this._writableState.highWaterMark}});function writeOrBuffer(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=decodeChunk(state,chunk,encoding);if(chunk!==newChunk){isBuf=true;encoding="buffer";chunk=newChunk}}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null};if(last){last.next=state.lastBufferedRequest}else{state.bufferedRequest=state.lastBufferedRequest}state.bufferedRequestCount+=1}else{doWrite(stream,state,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(state.destroyed)state.onwrite(new ERR_STREAM_DESTROYED("write"));else if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){--state.pendingcb;if(sync){process.nextTick(cb,er);process.nextTick(finishMaybe,stream,state);stream._writableState.errorEmitted=true;errorOrDestroy(stream,er)}else{cb(er);stream._writableState.errorEmitted=true;errorOrDestroy(stream,er);finishMaybe(stream,state)}}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;if(typeof cb!=="function")throw new ERR_MULTIPLE_CALLBACK;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(state)||stream.destroyed;if(!finished&&!state.corked&&!state.bufferProcessing&&state.bufferedRequest){clearBuffer(stream,state)}if(sync){process.nextTick(afterWrite,stream,state,finished,cb)}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount;var buffer=new Array(l);var holder=state.corkedRequestsFree;holder.entry=entry;var count=0;var allBuffers=true;while(entry){buffer[count]=entry;if(!entry.isBuf)allBuffers=false;entry=entry.next;count+=1}buffer.allBuffers=allBuffers;doWrite(stream,state,true,state.length,buffer,"",holder.finish);state.pendingcb++;state.lastBufferedRequest=null;if(holder.next){state.corkedRequestsFree=holder.next;holder.next=null}else{state.corkedRequestsFree=new CorkedRequest(state)}state.bufferedRequestCount=0}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);entry=entry.next;state.bufferedRequestCount--;if(state.writing){break}}if(entry===null)state.lastBufferedRequest=null}state.bufferedRequest=entry;state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED("_write()"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==undefined)this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending)endWritable(this,state,cb);return this};Object.defineProperty(Writable.prototype,"writableLength",{enumerable:false,get:function get(){return this._writableState.length}});function needFinish(state){return state.ending&&state.length===0&&state.bufferedRequest===null&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--;if(err){errorOrDestroy(stream,err)}state.prefinished=true;stream.emit("prefinish");finishMaybe(stream,state)})}function prefinish(stream,state){if(!state.prefinished&&!state.finalCalled){if(typeof stream._final==="function"&&!state.destroyed){state.pendingcb++;state.finalCalled=true;process.nextTick(callFinal,stream,state)}else{state.prefinished=true;stream.emit("prefinish")}}}function finishMaybe(stream,state){var need=needFinish(state);if(need){prefinish(stream,state);if(state.pendingcb===0){state.finished=true;stream.emit("finish");if(state.autoDestroy){var rState=stream._readableState;if(!rState||rState.autoDestroy&&rState.endEmitted){stream.destroy()}}}}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true;stream.writable=false}function onCorkedFinish(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;while(entry){var cb=entry.callback;state.pendingcb--;cb(err);entry=entry.next}state.corkedRequestsFree.next=corkReq}Object.defineProperty(Writable.prototype,"destroyed",{enumerable:false,get:function get(){if(this._writableState===undefined){return false}return this._writableState.destroyed},set:function set(value){if(!this._writableState){return}this._writableState.destroyed=value}});Writable.prototype.destroy=destroyImpl.destroy;Writable.prototype._undestroy=destroyImpl.undestroy;Writable.prototype._destroy=function(err,cb){cb(err)}}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"../errors":78,"./_stream_duplex":79,"./internal/streams/destroy":86,"./internal/streams/state":90,"./internal/streams/stream":91,_process:66,buffer:55,inherits:64,"util-deprecate":94}],84:[function(require,module,exports){(function(process){(function(){"use strict";var _Object$setPrototypeO;function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var finished=require("./end-of-stream");var kLastResolve=Symbol("lastResolve");var kLastReject=Symbol("lastReject");var kError=Symbol("error");var kEnded=Symbol("ended");var kLastPromise=Symbol("lastPromise");var kHandlePromise=Symbol("handlePromise");var kStream=Symbol("stream");function createIterResult(value,done){return{value:value,done:done}}function readAndResolve(iter){var resolve=iter[kLastResolve];if(resolve!==null){var data=iter[kStream].read();if(data!==null){iter[kLastPromise]=null;iter[kLastResolve]=null;iter[kLastReject]=null;resolve(createIterResult(data,false))}}}function onReadable(iter){process.nextTick(readAndResolve,iter)}function wrapForNext(lastPromise,iter){return function(resolve,reject){lastPromise.then(function(){if(iter[kEnded]){resolve(createIterResult(undefined,true));return}iter[kHandlePromise](resolve,reject)},reject)}}var AsyncIteratorPrototype=Object.getPrototypeOf(function(){});var ReadableStreamAsyncIteratorPrototype=Object.setPrototypeOf((_Object$setPrototypeO={get stream(){return this[kStream]},next:function next(){var _this=this;var error=this[kError];if(error!==null){return Promise.reject(error)}if(this[kEnded]){return Promise.resolve(createIterResult(undefined,true))}if(this[kStream].destroyed){return new Promise(function(resolve,reject){process.nextTick(function(){if(_this[kError]){reject(_this[kError])}else{resolve(createIterResult(undefined,true))}})})}var lastPromise=this[kLastPromise];var promise;if(lastPromise){promise=new Promise(wrapForNext(lastPromise,this))}else{var data=this[kStream].read();if(data!==null){return Promise.resolve(createIterResult(data,false))}promise=new Promise(this[kHandlePromise])}this[kLastPromise]=promise;return promise}},_defineProperty(_Object$setPrototypeO,Symbol.asyncIterator,function(){return this}),_defineProperty(_Object$setPrototypeO,"return",function _return(){var _this2=this;return new Promise(function(resolve,reject){_this2[kStream].destroy(null,function(err){if(err){reject(err);return}resolve(createIterResult(undefined,true))})})}),_Object$setPrototypeO),AsyncIteratorPrototype);var createReadableStreamAsyncIterator=function createReadableStreamAsyncIterator(stream){var _Object$create;var iterator=Object.create(ReadableStreamAsyncIteratorPrototype,(_Object$create={},_defineProperty(_Object$create,kStream,{value:stream,writable:true}),_defineProperty(_Object$create,kLastResolve,{value:null,writable:true}),_defineProperty(_Object$create,kLastReject,{value:null,writable:true}),_defineProperty(_Object$create,kError,{value:null,writable:true}),_defineProperty(_Object$create,kEnded,{value:stream._readableState.endEmitted,writable:true}),_defineProperty(_Object$create,kHandlePromise,{value:function value(resolve,reject){var data=iterator[kStream].read();if(data){iterator[kLastPromise]=null;iterator[kLastResolve]=null;iterator[kLastReject]=null;resolve(createIterResult(data,false))}else{iterator[kLastResolve]=resolve;iterator[kLastReject]=reject}},writable:true}),_Object$create));iterator[kLastPromise]=null;finished(stream,function(err){if(err&&err.code!=="ERR_STREAM_PREMATURE_CLOSE"){var reject=iterator[kLastReject];if(reject!==null){iterator[kLastPromise]=null;iterator[kLastResolve]=null;iterator[kLastReject]=null;reject(err)}iterator[kError]=err;return}var resolve=iterator[kLastResolve];if(resolve!==null){iterator[kLastPromise]=null;iterator[kLastResolve]=null;iterator[kLastReject]=null;resolve(createIterResult(undefined,true))}iterator[kEnded]=true});stream.on("readable",onReadable.bind(null,iterator));return iterator};module.exports=createReadableStreamAsyncIterator}).call(this)}).call(this,require("_process"))},{"./end-of-stream":87,_process:66}],85:[function(require,module,exports){"use strict";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var _require=require("buffer"),Buffer=_require.Buffer;var _require2=require("util"),inspect=_require2.inspect;var custom=inspect&&inspect.custom||"inspect";function copyBuffer(src,target,offset){Buffer.prototype.copy.call(src,target,offset)}module.exports=function(){function BufferList(){_classCallCheck(this,BufferList);this.head=null;this.tail=null;this.length=0}_createClass(BufferList,[{key:"push",value:function push(v){var entry={data:v,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length}},{key:"unshift",value:function unshift(v){var entry={data:v,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length}},{key:"shift",value:function shift(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret}},{key:"clear",value:function clear(){this.head=this.tail=null;this.length=0}},{key:"join",value:function join(s){if(this.length===0)return"";var p=this.head;var ret=""+p.data;while(p=p.next){ret+=s+p.data}return ret}},{key:"concat",value:function concat(n){if(this.length===0)return Buffer.alloc(0);var ret=Buffer.allocUnsafe(n>>>0);var p=this.head;var i=0;while(p){copyBuffer(p.data,ret,i);i+=p.data.length;p=p.next}return ret}},{key:"consume",value:function consume(n,hasStrings){var ret;if(n<this.head.data.length){ret=this.head.data.slice(0,n);this.head.data=this.head.data.slice(n)}else if(n===this.head.data.length){ret=this.shift()}else{ret=hasStrings?this._getString(n):this._getBuffer(n)}return ret}},{key:"first",value:function first(){return this.head.data}},{key:"_getString",value:function _getString(n){var p=this.head;var c=1;var ret=p.data;n-=ret.length;while(p=p.next){var str=p.data;var nb=n>str.length?str.length:n;if(nb===str.length)ret+=str;else ret+=str.slice(0,n);n-=nb;if(n===0){if(nb===str.length){++c;if(p.next)this.head=p.next;else this.head=this.tail=null}else{this.head=p;p.data=str.slice(nb)}break}++c}this.length-=c;return ret}},{key:"_getBuffer",value:function _getBuffer(n){var ret=Buffer.allocUnsafe(n);var p=this.head;var c=1;p.data.copy(ret);n-=p.data.length;while(p=p.next){var buf=p.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p.next)this.head=p.next;else this.head=this.tail=null}else{this.head=p;p.data=buf.slice(nb)}break}++c}this.length-=c;return ret}},{key:custom,value:function value(_,options){return inspect(this,_objectSpread({},options,{depth:0,customInspect:false}))}}]);return BufferList}()},{buffer:55,util:54}],86:[function(require,module,exports){(function(process){(function(){"use strict";function destroy(err,cb){var _this=this;var readableDestroyed=this._readableState&&this._readableState.destroyed;var writableDestroyed=this._writableState&&this._writableState.destroyed;if(readableDestroyed||writableDestroyed){if(cb){cb(err)}else if(err){if(!this._writableState){process.nextTick(emitErrorNT,this,err)}else if(!this._writableState.errorEmitted){this._writableState.errorEmitted=true;process.nextTick(emitErrorNT,this,err)}}return this}if(this._readableState){this._readableState.destroyed=true}if(this._writableState){this._writableState.destroyed=true}this._destroy(err||null,function(err){if(!cb&&err){if(!_this._writableState){process.nextTick(emitErrorAndCloseNT,_this,err)}else if(!_this._writableState.errorEmitted){_this._writableState.errorEmitted=true;process.nextTick(emitErrorAndCloseNT,_this,err)}else{process.nextTick(emitCloseNT,_this)}}else if(cb){process.nextTick(emitCloseNT,_this);cb(err)}else{process.nextTick(emitCloseNT,_this)}});return this}function emitErrorAndCloseNT(self,err){emitErrorNT(self,err);emitCloseNT(self)}function emitCloseNT(self){if(self._writableState&&!self._writableState.emitClose)return;if(self._readableState&&!self._readableState.emitClose)return;self.emit("close")}function undestroy(){if(this._readableState){this._readableState.destroyed=false;this._readableState.reading=false;this._readableState.ended=false;this._readableState.endEmitted=false}if(this._writableState){this._writableState.destroyed=false;this._writableState.ended=false;this._writableState.ending=false;this._writableState.finalCalled=false;this._writableState.prefinished=false;this._writableState.finished=false;this._writableState.errorEmitted=false}}function emitErrorNT(self,err){self.emit("error",err)}function errorOrDestroy(stream,err){var rState=stream._readableState;var wState=stream._writableState;if(rState&&rState.autoDestroy||wState&&wState.autoDestroy)stream.destroy(err);else stream.emit("error",err)}module.exports={destroy:destroy,undestroy:undestroy,errorOrDestroy:errorOrDestroy}}).call(this)}).call(this,require("_process"))},{_process:66}],87:[function(require,module,exports){"use strict";var ERR_STREAM_PREMATURE_CLOSE=require("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;function once(callback){var called=false;return function(){if(called)return;called=true;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}callback.apply(this,args)}}function noop(){}function isRequest(stream){return stream.setHeader&&typeof stream.abort==="function"}function eos(stream,opts,callback){if(typeof opts==="function")return eos(stream,null,opts);if(!opts)opts={};callback=once(callback||noop);var readable=opts.readable||opts.readable!==false&&stream.readable;var writable=opts.writable||opts.writable!==false&&stream.writable;var onlegacyfinish=function onlegacyfinish(){if(!stream.writable)onfinish()};var writableEnded=stream._writableState&&stream._writableState.finished;var onfinish=function onfinish(){writable=false;writableEnded=true;if(!readable)callback.call(stream)};var readableEnded=stream._readableState&&stream._readableState.endEmitted;var onend=function onend(){readable=false;readableEnded=true;if(!writable)callback.call(stream)};var onerror=function onerror(err){callback.call(stream,err)};var onclose=function onclose(){var err;if(readable&&!readableEnded){if(!stream._readableState||!stream._readableState.ended)err=new ERR_STREAM_PREMATURE_CLOSE;return callback.call(stream,err)}if(writable&&!writableEnded){if(!stream._writableState||!stream._writableState.ended)err=new ERR_STREAM_PREMATURE_CLOSE;return callback.call(stream,err)}};var onrequest=function onrequest(){stream.req.on("finish",onfinish)};if(isRequest(stream)){stream.on("complete",onfinish);stream.on("abort",onclose);if(stream.req)onrequest();else stream.on("request",onrequest)}else if(writable&&!stream._writableState){stream.on("end",onlegacyfinish);stream.on("close",onlegacyfinish)}stream.on("end",onend);stream.on("finish",onfinish);if(opts.error!==false)stream.on("error",onerror);stream.on("close",onclose);return function(){stream.removeListener("complete",onfinish);stream.removeListener("abort",onclose);stream.removeListener("request",onrequest);if(stream.req)stream.req.removeListener("finish",onfinish);stream.removeListener("end",onlegacyfinish);stream.removeListener("close",onlegacyfinish);stream.removeListener("finish",onfinish);stream.removeListener("end",onend);stream.removeListener("error",onerror);stream.removeListener("close",onclose)}}module.exports=eos},{"../../../errors":78}],88:[function(require,module,exports){module.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],89:[function(require,module,exports){"use strict";var eos;function once(callback){var called=false;return function(){if(called)return;called=true;callback.apply(void 0,arguments)}}var _require$codes=require("../../../errors").codes,ERR_MISSING_ARGS=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED;function noop(err){if(err)throw err}function isRequest(stream){return stream.setHeader&&typeof stream.abort==="function"}function destroyer(stream,reading,writing,callback){callback=once(callback);var closed=false;stream.on("close",function(){closed=true});if(eos===undefined)eos=require("./end-of-stream");eos(stream,{readable:reading,writable:writing},function(err){if(err)return callback(err);closed=true;callback()});var destroyed=false;return function(err){if(closed)return;if(destroyed)return;destroyed=true;if(isRequest(stream))return stream.abort();if(typeof stream.destroy==="function")return stream.destroy();callback(err||new ERR_STREAM_DESTROYED("pipe"))}}function call(fn){fn()}function pipe(from,to){return from.pipe(to)}function popCallback(streams){if(!streams.length)return noop;if(typeof streams[streams.length-1]!=="function")return noop;return streams.pop()}function pipeline(){for(var _len=arguments.length,streams=new Array(_len),_key=0;_key<_len;_key++){streams[_key]=arguments[_key]}var callback=popCallback(streams);if(Array.isArray(streams[0]))streams=streams[0];if(streams.length<2){throw new ERR_MISSING_ARGS("streams")}var error;var destroys=streams.map(function(stream,i){var reading=i<streams.length-1;var writing=i>0;return destroyer(stream,reading,writing,function(err){if(!error)error=err;if(err)destroys.forEach(call);if(reading)return;destroys.forEach(call);callback(error)})});return streams.reduce(pipe)}module.exports=pipeline},{"../../../errors":78,"./end-of-stream":87}],90:[function(require,module,exports){"use strict";var ERR_INVALID_OPT_VALUE=require("../../../errors").codes.ERR_INVALID_OPT_VALUE;function highWaterMarkFrom(options,isDuplex,duplexKey){return options.highWaterMark!=null?options.highWaterMark:isDuplex?options[duplexKey]:null}function getHighWaterMark(state,options,duplexKey,isDuplex){var hwm=highWaterMarkFrom(options,isDuplex,duplexKey);if(hwm!=null){if(!(isFinite(hwm)&&Math.floor(hwm)===hwm)||hwm<0){var name=isDuplex?duplexKey:"highWaterMark";throw new ERR_INVALID_OPT_VALUE(name,hwm)}return Math.floor(hwm)}return state.objectMode?16:16*1024}module.exports={getHighWaterMark:getHighWaterMark}},{"../../../errors":78}],91:[function(require,module,exports){module.exports=require("events").EventEmitter},{events:61}],92:[function(require,module,exports){"use strict";var Buffer=require("safe-buffer").Buffer;var isEncoding=Buffer.isEncoding||function(encoding){encoding=""+encoding;switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function _normalizeEncoding(enc){if(!enc)return"utf8";var retried;while(true){switch(enc){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return enc;default:if(retried)return;enc=(""+enc).toLowerCase();retried=true}}}function normalizeEncoding(enc){var nenc=_normalizeEncoding(enc);if(typeof nenc!=="string"&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error("Unknown encoding: "+enc);return nenc||enc}exports.StringDecoder=StringDecoder;function StringDecoder(encoding){this.encoding=normalizeEncoding(encoding);var nb;switch(this.encoding){case"utf16le":this.text=utf16Text;this.end=utf16End;nb=4;break;case"utf8":this.fillLast=utf8FillLast;nb=4;break;case"base64":this.text=base64Text;this.end=base64End;nb=3;break;default:this.write=simpleWrite;this.end=simpleEnd;return}this.lastNeed=0;this.lastTotal=0;this.lastChar=Buffer.allocUnsafe(nb)}StringDecoder.prototype.write=function(buf){if(buf.length===0)return"";var r;var i;if(this.lastNeed){r=this.fillLast(buf);if(r===undefined)return"";i=this.lastNeed;this.lastNeed=0}else{i=0}if(i<buf.length)return r?r+this.text(buf,i):this.text(buf,i);return r||""};StringDecoder.prototype.end=utf8End;StringDecoder.prototype.text=utf8Text;StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length){buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length);this.lastNeed-=buf.length};function utf8CheckByte(byte){if(byte<=127)return 0;else if(byte>>5===6)return 2;else if(byte>>4===14)return 3;else if(byte>>3===30)return 4;return byte>>6===2?-1:-2}function utf8CheckIncomplete(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-1;return nb}if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0)self.lastNeed=nb-2;return nb}if(--j<i||nb===-2)return 0;nb=utf8CheckByte(buf[j]);if(nb>=0){if(nb>0){if(nb===2)nb=0;else self.lastNeed=nb-3}return nb}return 0}function utf8CheckExtraBytes(self,buf,p){if((buf[0]&192)!==128){self.lastNeed=0;return""}if(self.lastNeed>1&&buf.length>1){if((buf[1]&192)!==128){self.lastNeed=1;return""}if(self.lastNeed>2&&buf.length>2){if((buf[2]&192)!==128){self.lastNeed=2;return""}}}}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed;var r=utf8CheckExtraBytes(this,buf,p);if(r!==undefined)return r;if(this.lastNeed<=buf.length){buf.copy(this.lastChar,p,0,this.lastNeed);return this.lastChar.toString(this.encoding,0,this.lastTotal)}buf.copy(this.lastChar,p,0,buf.length);this.lastNeed-=buf.length}function utf8Text(buf,i){var total=utf8CheckIncomplete(this,buf,i);if(!this.lastNeed)return buf.toString("utf8",i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);buf.copy(this.lastChar,0,end);return buf.toString("utf8",i,end)}function utf8End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+"";return r}function utf16Text(buf,i){if((buf.length-i)%2===0){var r=buf.toString("utf16le",i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319){this.lastNeed=2;this.lastTotal=4;this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1];return r.slice(0,-1)}}return r}this.lastNeed=1;this.lastTotal=2;this.lastChar[0]=buf[buf.length-1];return buf.toString("utf16le",i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString("utf16le",0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;if(n===0)return buf.toString("base64",i);this.lastNeed=3-n;this.lastTotal=3;if(n===1){this.lastChar[0]=buf[buf.length-1]}else{this.lastChar[0]=buf[buf.length-2];this.lastChar[1]=buf[buf.length-1]}return buf.toString("base64",i,buf.length-n)}function base64End(buf){var r=buf&&buf.length?this.write(buf):"";if(this.lastNeed)return r+this.lastChar.toString("base64",0,3-this.lastNeed);return r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):""}},{"safe-buffer":93}],93:[function(require,module,exports){var buffer=require("buffer");var Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src){dst[key]=src[key]}}if(Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow){module.exports=buffer}else{copyProps(buffer,exports);exports.Buffer=SafeBuffer}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}copyProps(Buffer,SafeBuffer);SafeBuffer.from=function(arg,encodingOrOffset,length){if(typeof arg==="number"){throw new TypeError("Argument must not be a number")}return Buffer(arg,encodingOrOffset,length)};SafeBuffer.alloc=function(size,fill,encoding){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}var buf=Buffer(size);if(fill!==undefined){if(typeof encoding==="string"){buf.fill(fill,encoding)}else{buf.fill(fill)}}else{buf.fill(0)}return buf};SafeBuffer.allocUnsafe=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return Buffer(size)};SafeBuffer.allocUnsafeSlow=function(size){if(typeof size!=="number"){throw new TypeError("Argument must be a number")}return buffer.SlowBuffer(size)}},{buffer:55}],94:[function(require,module,exports){(function(global){(function(){module.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name){try{if(!global.localStorage)return false}catch(_){return false}var val=global.localStorage[name];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],95:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.clearMockWindowState=exports.windowRef=void 0;var cbs=[function(_){return undefined}];var windowRef={postMessage:function(message,_target){console.log("GOT MOCK POST MESSAGE",message);cbs.forEach(function(callbackElement){callbackElement({data:message})})},addEventListener:function(_name,eventCallback){cbs.push(eventCallback)},removeEventListener:function(_name,eventCallback){cbs.splice(cbs.indexOf(function(element){return element===eventCallback}),1)},location:{origin:"*"}};exports.windowRef=windowRef;try{if(typeof window!=="undefined"){exports.windowRef=windowRef=window}}catch(windowError){console.log("not defined: ".concat(windowError))}var clearMockWindowState=function(){cbs.length=0};exports.clearMockWindowState=clearMockWindowState},{}],96:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Serializer=void 0;var bs58check=require("bs58check");var Serializer=function(){function Serializer(){}Serializer.prototype.serialize=function(message){return __awaiter(this,void 0,void 0,function(){var str;return __generator(this,function(_a){str=JSON.stringify(message);return[2,bs58check.encode(Buffer.from(str))]})})};Serializer.prototype.deserialize=function(encoded){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(typeof encoded!=="string"){throw new Error("Encoded payload needs to be a string")}return[2,JSON.parse(bs58check.decode(encoded).toString())]})})};return Serializer}();exports.Serializer=Serializer}).call(this)}).call(this,require("buffer").Buffer)},{bs58check:58,buffer:55}],97:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.BeaconClient=void 0;var beacon_utils_1=require("@airgap/beacon-utils");var beacon_utils_2=require("@airgap/beacon-utils");var beacon_types_1=require("@airgap/beacon-types");var constants_1=require("../../constants");var MockWindow_1=require("../../MockWindow");var BeaconClient=function(){function BeaconClient(config){this._beaconId=new beacon_utils_1.ExposedPromise;this._keyPair=new beacon_utils_1.ExposedPromise;if(!config.name){throw new Error("Name not set")}if(!config.storage){throw new Error("Storage not set")}this.name=config.name;this.iconUrl=config.iconUrl;this.appUrl=config.appUrl;this.storage=config.storage;if(MockWindow_1.windowRef.beaconCreatedClientInstance){console.error("[BEACON] It looks like you created multiple Beacon SDK Client instances. This can lead to problems. Only create one instance and re-use it everywhere.")}else{MockWindow_1.windowRef.beaconCreatedClientInstance=true}this.initSDK().catch(console.error)}Object.defineProperty(BeaconClient.prototype,"beaconId",{get:function(){return this._beaconId.promise},enumerable:false,configurable:true});Object.defineProperty(BeaconClient.prototype,"keyPair",{get:function(){return this._keyPair.promise},enumerable:false,configurable:true});BeaconClient.prototype.destroy=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.removeBeaconEntriesFromStorage()];case 1:_a.sent();MockWindow_1.windowRef.beaconCreatedClientInstance=false;return[2]}})})};BeaconClient.prototype.initSDK=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){this.storage.set(beacon_types_1.StorageKey.BEACON_SDK_VERSION,constants_1.SDK_VERSION).catch(console.error);this.loadOrCreateBeaconSecret().catch(console.error);return[2,this.keyPair.then(function(keyPair){_this._beaconId.resolve((0,beacon_utils_2.toHex)(keyPair.publicKey))})]})})};BeaconClient.prototype.removeBeaconEntriesFromStorage=function(){return __awaiter(this,void 0,void 0,function(){var allKeys;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:allKeys=Object.values(beacon_types_1.StorageKey);return[4,Promise.all(allKeys.map(function(key){return _this.storage.delete(key)}))];case 1:_a.sent();return[2]}})})};BeaconClient.prototype.loadOrCreateBeaconSecret=function(){return __awaiter(this,void 0,void 0,function(){var storageValue,_a,_b,key,_c,_d;return __generator(this,function(_e){switch(_e.label){case 0:return[4,this.storage.get(beacon_types_1.StorageKey.BEACON_SDK_SECRET_SEED)];case 1:storageValue=_e.sent();if(!(storageValue&&typeof storageValue==="string"))return[3,3];_b=(_a=this._keyPair).resolve;return[4,(0,beacon_utils_2.getKeypairFromSeed)(storageValue)];case 2:_b.apply(_a,[_e.sent()]);return[3,7];case 3:return[4,(0,beacon_utils_2.generateGUID)()];case 4:key=_e.sent();return[4,this.storage.set(beacon_types_1.StorageKey.BEACON_SDK_SECRET_SEED,key)];case 5:_e.sent();_d=(_c=this._keyPair).resolve;return[4,(0,beacon_utils_2.getKeypairFromSeed)(key)];case 6:_d.apply(_c,[_e.sent()]);_e.label=7;case 7:return[2]}})})};return BeaconClient}();exports.BeaconClient=BeaconClient},{"../../MockWindow":95,"../../constants":99,"@airgap/beacon-types":145,"@airgap/beacon-utils":163}],98:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Client=void 0;var beacon_utils_1=require("@airgap/beacon-utils");var beacon_types_1=require("@airgap/beacon-types");var __1=require("../..");var BeaconClient_1=require("../beacon-client/BeaconClient");var AccountManager_1=require("../../managers/AccountManager");var get_sender_id_1=require("../../utils/get-sender-id");var Logger_1=require("../../utils/Logger");var logger=new Logger_1.Logger("Client");var Client=function(_super){__extends(Client,_super);function Client(config){var _this=this;var _a;_this=_super.call(this,config)||this;_this.rateLimit=2;_this.rateLimitWindowInSeconds=5;_this.requestCounter=[];_this._transport=new beacon_utils_1.ExposedPromise;_this.accountManager=new AccountManager_1.AccountManager(config.storage);_this.matrixNodes=(_a=config.matrixNodes)!==null&&_a!==void 0?_a:{};_this.handleResponse=function(message,connectionInfo){throw new Error("not overwritten".concat(JSON.stringify(message)," - ").concat(JSON.stringify(connectionInfo)))};return _this}Object.defineProperty(Client.prototype,"transport",{get:function(){return this._transport.promise},enumerable:false,configurable:true});Object.defineProperty(Client.prototype,"connectionStatus",{get:function(){var _a,_b;return(_b=(_a=this._transport.promiseResult)===null||_a===void 0?void 0:_a.connectionStatus)!==null&&_b!==void 0?_b:beacon_types_1.TransportStatus.NOT_CONNECTED},enumerable:false,configurable:true});Object.defineProperty(Client.prototype,"ready",{get:function(){return this.transport.then(function(){return undefined})},enumerable:false,configurable:true});Client.prototype.getAccounts=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.accountManager.getAccounts()]})})};Client.prototype.getAccount=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.accountManager.getAccount(accountIdentifier)]})})};Client.prototype.removeAccount=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.accountManager.removeAccount(accountIdentifier)]})})};Client.prototype.removeAllAccounts=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.accountManager.removeAllAccounts()]})})};Client.prototype.addRequestAndCheckIfRateLimited=function(){return __awaiter(this,void 0,void 0,function(){var now;var _this=this;return __generator(this,function(_a){now=(new Date).getTime();this.requestCounter=this.requestCounter.filter(function(date){return date+_this.rateLimitWindowInSeconds*1e3>now});this.requestCounter.push(now);return[2,this.requestCounter.length>this.rateLimit]})})};Client.prototype.init=function(transport){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:if(!(this._transport.status===beacon_utils_1.ExposedPromiseStatus.RESOLVED))return[3,2];return[4,this.transport];case 1:return[2,_a.sent().type];case 2:return[4,this.setTransport(transport)];case 3:_a.sent();return[2,transport.type]}})})};Client.prototype.getOwnAppMetadata=function(){return __awaiter(this,void 0,void 0,function(){var _a;var _b;return __generator(this,function(_c){switch(_c.label){case 0:_b={};_a=get_sender_id_1.getSenderId;return[4,this.beaconId];case 1:return[4,_a.apply(void 0,[_c.sent()])];case 2:return[2,(_b.senderId=_c.sent(),_b.name=this.name,_b.icon=this.iconUrl,_b)]}})})};Client.prototype.getPeers=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.transport];case 1:return[2,_a.sent().getPeers()]}})})};Client.prototype.addPeer=function(peer){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.transport];case 1:return[2,_a.sent().addPeer(peer)]}})})};Client.prototype.destroy=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:if(!(this._transport.status===beacon_utils_1.ExposedPromiseStatus.RESOLVED))return[3,3];return[4,this.transport];case 1:return[4,_a.sent().disconnect()];case 2:_a.sent();_a.label=3;case 3:return[4,_super.prototype.destroy.call(this)];case 4:_a.sent();return[2]}})})};Client.prototype.setTransport=function(transport){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(transport){if(this._transport.isSettled()){this._transport=beacon_utils_1.ExposedPromise.resolve(transport)}else{this._transport.resolve(transport)}}else{if(this._transport.isSettled()){this._transport=new beacon_utils_1.ExposedPromise}}return[2]})})};Client.prototype.addListener=function(transport){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){transport.addListener(function(message,connectionInfo){return __awaiter(_this,void 0,void 0,function(){var deserializedMessage;return __generator(this,function(_a){switch(_a.label){case 0:if(!(typeof message==="string"))return[3,2];return[4,(new __1.Serializer).deserialize(message)];case 1:deserializedMessage=_a.sent();this.handleResponse(deserializedMessage,connectionInfo);_a.label=2;case 2:return[2]}})})}).catch(function(error){return logger.error("addListener",error)});return[2]})})};Client.prototype.sendDisconnectToPeer=function(peer,transport){return __awaiter(this,void 0,void 0,function(){var request,_a,payload,selectedTransport,_b;var _c;return __generator(this,function(_d){switch(_d.label){case 0:_c={};return[4,(0,beacon_utils_1.generateGUID)()];case 1:_c.id=_d.sent(),_c.version=peer.version;_a=get_sender_id_1.getSenderId;return[4,this.beaconId];case 2:return[4,_a.apply(void 0,[_d.sent()])];case 3:request=(_c.senderId=_d.sent(),_c.type=beacon_types_1.BeaconMessageType.Disconnect,_c);return[4,(new __1.Serializer).serialize(request)];case 4:payload=_d.sent();if(!(transport!==null&&transport!==void 0))return[3,5];_b=transport;return[3,7];case 5:return[4,this.transport];case 6:_b=_d.sent();_d.label=7;case 7:selectedTransport=_b;return[4,selectedTransport.send(payload,peer)];case 8:_d.sent();return[2]}})})};return Client}(BeaconClient_1.BeaconClient);exports.Client=Client},{"../..":113,"../../managers/AccountManager":114,"../../utils/Logger":126,"../../utils/get-sender-id":129,"../beacon-client/BeaconClient":97,"@airgap/beacon-types":145,"@airgap/beacon-utils":163}],99:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NOTIFICATION_ORACLE_URL=exports.BEACON_VERSION=exports.SDK_VERSION=void 0;exports.SDK_VERSION="3.3.4";exports.BEACON_VERSION="3";exports.NOTIFICATION_ORACLE_URL="https://beacon-notification-oracle.dev.gke.papers.tech"},{}],100:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getDebugEnabled=exports.setDebugEnabled=void 0;var MockWindow_1=require("./MockWindow");var debug=MockWindow_1.windowRef.beaconSdkDebugEnabled?true:false;if(debug){console.log("[BEACON]: Debug mode is ON (turned on either by the developer or a browser extension)")}var setDebugEnabled=function(enabled){debug=enabled};exports.setDebugEnabled=setDebugEnabled;var getDebugEnabled=function(){return debug};exports.getDebugEnabled=getDebugEnabled},{"./MockWindow":95}],101:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.AbortedBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var AbortedBeaconError=function(_super){__extends(AbortedBeaconError,_super);function AbortedBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.ABORTED_ERROR,"The action was aborted by the user.")||this;_this.name="UnknownBeaconError";_this.title="Aborted";return _this}return AbortedBeaconError}(__1.BeaconError);exports.AbortedBeaconError=AbortedBeaconError},{"..":113,"@airgap/beacon-types":145}],102:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BeaconError=void 0;var assert_never_1=require("../utils/assert-never");var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var BeaconError=function(){function BeaconError(errorType,message){this.name="BeaconError";this.title="Error";this.message="[".concat(errorType,"]:").concat(message);this.description=message}Object.defineProperty(BeaconError.prototype,"fullDescription",{get:function(){return{description:this.description}},enumerable:false,configurable:true});BeaconError.getError=function(errorType,errorData){switch(errorType){case beacon_types_1.BeaconErrorType.BROADCAST_ERROR:return new __1.BroadcastBeaconError;case beacon_types_1.BeaconErrorType.NETWORK_NOT_SUPPORTED:return new __1.NetworkNotSupportedBeaconError;case beacon_types_1.BeaconErrorType.NO_ADDRESS_ERROR:return new __1.NoAddressBeaconError;case beacon_types_1.BeaconErrorType.NO_PRIVATE_KEY_FOUND_ERROR:return new __1.NoPrivateKeyBeaconError;case beacon_types_1.BeaconErrorType.NOT_GRANTED_ERROR:return new __1.NotGrantedBeaconError;case beacon_types_1.BeaconErrorType.PARAMETERS_INVALID_ERROR:return new __1.ParametersInvalidBeaconError;case beacon_types_1.BeaconErrorType.TOO_MANY_OPERATIONS:return new __1.TooManyOperationsBeaconError;case beacon_types_1.BeaconErrorType.TRANSACTION_INVALID_ERROR:return new __1.TransactionInvalidBeaconError(errorData);case beacon_types_1.BeaconErrorType.SIGNATURE_TYPE_NOT_SUPPORTED:return new __1.SignatureTypeNotSupportedBeaconError;case beacon_types_1.BeaconErrorType.ABORTED_ERROR:return new __1.AbortedBeaconError;case beacon_types_1.BeaconErrorType.UNKNOWN_ERROR:return new __1.UnknownBeaconError;default:(0,assert_never_1.assertNever)(errorType)}};return BeaconError}();exports.BeaconError=BeaconError},{"..":113,"../utils/assert-never":127,"@airgap/beacon-types":145}],103:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.BroadcastBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var BroadcastBeaconError=function(_super){__extends(BroadcastBeaconError,_super);function BroadcastBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.BROADCAST_ERROR,"The transaction could not be broadcast to the network. Please try again.")||this;_this.name="BroadcastBeaconError";_this.title="Broadcast Error";return _this}return BroadcastBeaconError}(__1.BeaconError);exports.BroadcastBeaconError=BroadcastBeaconError},{"..":113,"@airgap/beacon-types":145}],104:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.NetworkNotSupportedBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var NetworkNotSupportedBeaconError=function(_super){__extends(NetworkNotSupportedBeaconError,_super);function NetworkNotSupportedBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.NETWORK_NOT_SUPPORTED,"The wallet does not support this network. Please select another one.")||this;_this.name="NetworkNotSupportedBeaconError";_this.title="Network Error";return _this}return NetworkNotSupportedBeaconError}(__1.BeaconError);exports.NetworkNotSupportedBeaconError=NetworkNotSupportedBeaconError},{"..":113,"@airgap/beacon-types":145}],105:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.NoAddressBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var NoAddressBeaconError=function(_super){__extends(NoAddressBeaconError,_super);function NoAddressBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.NO_ADDRESS_ERROR,"The wallet does not have an account set up. Please make sure to set up your wallet and try again.")||this;_this.name="NoAddressBeaconError";_this.title="No Address";return _this}return NoAddressBeaconError}(__1.BeaconError);exports.NoAddressBeaconError=NoAddressBeaconError},{"..":113,"@airgap/beacon-types":145}],106:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.NoPrivateKeyBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var NoPrivateKeyBeaconError=function(_super){__extends(NoPrivateKeyBeaconError,_super);function NoPrivateKeyBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.NO_PRIVATE_KEY_FOUND_ERROR,"The account you are trying to interact with is not available. Please make sure to add the account to your wallet and try again.")||this;_this.name="NoPrivateKeyBeaconError";_this.title="Account Not Found";return _this}return NoPrivateKeyBeaconError}(__1.BeaconError);exports.NoPrivateKeyBeaconError=NoPrivateKeyBeaconError},{"..":113,"@airgap/beacon-types":145}],107:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.NotGrantedBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var NotGrantedBeaconError=function(_super){__extends(NotGrantedBeaconError,_super);function NotGrantedBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.NOT_GRANTED_ERROR,"You do not have the necessary permissions to perform this action. Please initiate another permission request and give the necessary permissions.")||this;_this.name="NotGrantedBeaconError";_this.title="Permission Not Granted";return _this}return NotGrantedBeaconError}(__1.BeaconError);exports.NotGrantedBeaconError=NotGrantedBeaconError},{"..":113,"@airgap/beacon-types":145}],108:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.ParametersInvalidBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var ParametersInvalidBeaconError=function(_super){__extends(ParametersInvalidBeaconError,_super);function ParametersInvalidBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.PARAMETERS_INVALID_ERROR,"Some of the parameters you provided are invalid and the request could not be completed. Please check your inputs and try again.")||this;_this.name="ParametersInvalidBeaconError";_this.title="Parameters Invalid";return _this}return ParametersInvalidBeaconError}(__1.BeaconError);exports.ParametersInvalidBeaconError=ParametersInvalidBeaconError},{"..":113,"@airgap/beacon-types":145}],109:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.SignatureTypeNotSupportedBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var SignatureTypeNotSupportedBeaconError=function(_super){__extends(SignatureTypeNotSupportedBeaconError,_super);function SignatureTypeNotSupportedBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.SIGNATURE_TYPE_NOT_SUPPORTED,"The wallet is not able to sign payloads of this type.")||this;_this.name="SignatureTypeNotSupportedBeaconError";_this.title="Signature Type Not Supported";return _this}return SignatureTypeNotSupportedBeaconError}(__1.BeaconError);exports.SignatureTypeNotSupportedBeaconError=SignatureTypeNotSupportedBeaconError},{"..":113,"@airgap/beacon-types":145}],110:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.TooManyOperationsBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var TooManyOperationsBeaconError=function(_super){__extends(TooManyOperationsBeaconError,_super);function TooManyOperationsBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.TOO_MANY_OPERATIONS,"The request contains too many transactions. Please include fewer operations and try again.")||this;_this.name="TooManyOperationsBeaconError";_this.title="Too Many Operations";return _this}return TooManyOperationsBeaconError}(__1.BeaconError);exports.TooManyOperationsBeaconError=TooManyOperationsBeaconError},{"..":113,"@airgap/beacon-types":145}],111:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.TransactionInvalidBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var TransactionInvalidBeaconError=function(_super){__extends(TransactionInvalidBeaconError,_super);function TransactionInvalidBeaconError(data){var _this=_super.call(this,beacon_types_1.BeaconErrorType.TRANSACTION_INVALID_ERROR,"The transaction is invalid and the node did not accept it.")||this;_this.data=data;_this.name="TransactionInvalidBeaconError";_this.title="Transaction Invalid";_this.data=data;return _this}Object.defineProperty(TransactionInvalidBeaconError.prototype,"fullDescription",{get:function(){return{description:this.description,data:JSON.stringify(this.data,undefined,2)}},enumerable:false,configurable:true});return TransactionInvalidBeaconError}(__1.BeaconError);exports.TransactionInvalidBeaconError=TransactionInvalidBeaconError},{"..":113,"@airgap/beacon-types":145}],112:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.UnknownBeaconError=void 0;var __1=require("..");var beacon_types_1=require("@airgap/beacon-types");var UnknownBeaconError=function(_super){__extends(UnknownBeaconError,_super);function UnknownBeaconError(){var _this=_super.call(this,beacon_types_1.BeaconErrorType.UNKNOWN_ERROR,"An unknown error occured. Please try again or report it to a developer.")||this;_this.name="UnknownBeaconError";_this.title="Error";return _this}return UnknownBeaconError}(__1.BeaconError);exports.UnknownBeaconError=UnknownBeaconError},{"..":113,"@airgap/beacon-types":145}],113:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NOTIFICATION_ORACLE_URL=exports.getDebugEnabled=exports.setDebugEnabled=exports.getLogger=exports.setLogger=exports.Logger=exports.Serializer=exports.windowRef=exports.getAccountIdentifier=exports.getSenderId=exports.BEACON_VERSION=exports.SDK_VERSION=exports.PermissionManager=exports.AppMetadataManager=exports.AccountManager=exports.PeerManager=exports.getStorage=exports.LocalStorage=exports.ChromeStorage=exports.CommunicationClient=exports.MessageBasedClient=exports.Transport=exports.UnknownBeaconError=exports.SignatureTypeNotSupportedBeaconError=exports.TransactionInvalidBeaconError=exports.TooManyOperationsBeaconError=exports.ParametersInvalidBeaconError=exports.NotGrantedBeaconError=exports.NoPrivateKeyBeaconError=exports.NoAddressBeaconError=exports.NetworkNotSupportedBeaconError=exports.BroadcastBeaconError=exports.AbortedBeaconError=exports.BeaconError=exports.Client=exports.BeaconClient=void 0;var Client_1=require("./clients/client/Client");Object.defineProperty(exports,"Client",{enumerable:true,get:function(){return Client_1.Client}});var BeaconError_1=require("./errors/BeaconError");Object.defineProperty(exports,"BeaconError",{enumerable:true,get:function(){return BeaconError_1.BeaconError}});var BroadcastBeaconError_1=require("./errors/BroadcastBeaconError");Object.defineProperty(exports,"BroadcastBeaconError",{enumerable:true,get:function(){return BroadcastBeaconError_1.BroadcastBeaconError}});var NetworkNotSupportedBeaconError_1=require("./errors/NetworkNotSupportedBeaconError");Object.defineProperty(exports,"NetworkNotSupportedBeaconError",{enumerable:true,get:function(){return NetworkNotSupportedBeaconError_1.NetworkNotSupportedBeaconError}});var NoAddressBeaconError_1=require("./errors/NoAddressBeaconError");Object.defineProperty(exports,"NoAddressBeaconError",{enumerable:true,get:function(){return NoAddressBeaconError_1.NoAddressBeaconError}});var NoPrivateKeyBeaconError_1=require("./errors/NoPrivateKeyBeaconError");Object.defineProperty(exports,"NoPrivateKeyBeaconError",{enumerable:true,get:function(){return NoPrivateKeyBeaconError_1.NoPrivateKeyBeaconError}});var NotGrantedBeaconError_1=require("./errors/NotGrantedBeaconError");Object.defineProperty(exports,"NotGrantedBeaconError",{enumerable:true,get:function(){return NotGrantedBeaconError_1.NotGrantedBeaconError}});var ParametersInvalidBeaconError_1=require("./errors/ParametersInvalidBeaconError");Object.defineProperty(exports,"ParametersInvalidBeaconError",{enumerable:true,get:function(){return ParametersInvalidBeaconError_1.ParametersInvalidBeaconError}});var TooManyOperationsBeaconError_1=require("./errors/TooManyOperationsBeaconError");Object.defineProperty(exports,"TooManyOperationsBeaconError",{enumerable:true,get:function(){return TooManyOperationsBeaconError_1.TooManyOperationsBeaconError}});var TransactionInvalidBeaconError_1=require("./errors/TransactionInvalidBeaconError");Object.defineProperty(exports,"TransactionInvalidBeaconError",{enumerable:true,get:function(){return TransactionInvalidBeaconError_1.TransactionInvalidBeaconError}});var UnknownBeaconError_1=require("./errors/UnknownBeaconError");Object.defineProperty(exports,"UnknownBeaconError",{enumerable:true,get:function(){return UnknownBeaconError_1.UnknownBeaconError}});var Transport_1=require("./transports/Transport");Object.defineProperty(exports,"Transport",{enumerable:true,get:function(){return Transport_1.Transport}});var ChromeStorage_1=require("./storage/ChromeStorage");Object.defineProperty(exports,"ChromeStorage",{enumerable:true,get:function(){return ChromeStorage_1.ChromeStorage}});var LocalStorage_1=require("./storage/LocalStorage");Object.defineProperty(exports,"LocalStorage",{enumerable:true,get:function(){return LocalStorage_1.LocalStorage}});var getStorage_1=require("./storage/getStorage");Object.defineProperty(exports,"getStorage",{enumerable:true,get:function(){return getStorage_1.getStorage}});var Serializer_1=require("./Serializer");Object.defineProperty(exports,"Serializer",{enumerable:true,get:function(){return Serializer_1.Serializer}});var constants_1=require("./constants");Object.defineProperty(exports,"SDK_VERSION",{enumerable:true,get:function(){return constants_1.SDK_VERSION}});Object.defineProperty(exports,"BEACON_VERSION",{enumerable:true,get:function(){return constants_1.BEACON_VERSION}});var AccountManager_1=require("./managers/AccountManager");Object.defineProperty(exports,"AccountManager",{enumerable:true,get:function(){return AccountManager_1.AccountManager}});var AppMetadataManager_1=require("./managers/AppMetadataManager");Object.defineProperty(exports,"AppMetadataManager",{enumerable:true,get:function(){return AppMetadataManager_1.AppMetadataManager}});var PermissionManager_1=require("./managers/PermissionManager");Object.defineProperty(exports,"PermissionManager",{enumerable:true,get:function(){return PermissionManager_1.PermissionManager}});var BeaconClient_1=require("./clients/beacon-client/BeaconClient");Object.defineProperty(exports,"BeaconClient",{enumerable:true,get:function(){return BeaconClient_1.BeaconClient}});var get_account_identifier_1=require("./utils/get-account-identifier");Object.defineProperty(exports,"getAccountIdentifier",{enumerable:true,get:function(){return get_account_identifier_1.getAccountIdentifier}});var AbortedBeaconError_1=require("./errors/AbortedBeaconError");Object.defineProperty(exports,"AbortedBeaconError",{enumerable:true,get:function(){return AbortedBeaconError_1.AbortedBeaconError}});var get_sender_id_1=require("./utils/get-sender-id");Object.defineProperty(exports,"getSenderId",{enumerable:true,get:function(){return get_sender_id_1.getSenderId}});var PeerManager_1=require("./managers/PeerManager");Object.defineProperty(exports,"PeerManager",{enumerable:true,get:function(){return PeerManager_1.PeerManager}});var MessageBasedClient_1=require("./transports/clients/MessageBasedClient");Object.defineProperty(exports,"MessageBasedClient",{enumerable:true,get:function(){return MessageBasedClient_1.MessageBasedClient}});var debug_1=require("./debug");Object.defineProperty(exports,"setDebugEnabled",{enumerable:true,get:function(){return debug_1.setDebugEnabled}});Object.defineProperty(exports,"getDebugEnabled",{enumerable:true,get:function(){return debug_1.getDebugEnabled}});var SignatureTypeNotSupportedBeaconError_1=require("./errors/SignatureTypeNotSupportedBeaconError");Object.defineProperty(exports,"SignatureTypeNotSupportedBeaconError",{enumerable:true,get:function(){return SignatureTypeNotSupportedBeaconError_1.SignatureTypeNotSupportedBeaconError}});var Logger_1=require("./utils/Logger");Object.defineProperty(exports,"getLogger",{enumerable:true,get:function(){return Logger_1.getLogger}});Object.defineProperty(exports,"Logger",{enumerable:true,get:function(){return Logger_1.Logger}});Object.defineProperty(exports,"setLogger",{enumerable:true,get:function(){return Logger_1.setLogger}});var MockWindow_1=require("./MockWindow");Object.defineProperty(exports,"windowRef",{enumerable:true,get:function(){return MockWindow_1.windowRef}});var CommunicationClient_1=require("./transports/clients/CommunicationClient");Object.defineProperty(exports,"CommunicationClient",{enumerable:true,get:function(){return CommunicationClient_1.CommunicationClient}});var constants_2=require("./constants");Object.defineProperty(exports,"NOTIFICATION_ORACLE_URL",{enumerable:true,get:function(){return constants_2.NOTIFICATION_ORACLE_URL}})},{"./MockWindow":95,"./Serializer":96,"./clients/beacon-client/BeaconClient":97,"./clients/client/Client":98,"./constants":99,"./debug":100,"./errors/AbortedBeaconError":101,"./errors/BeaconError":102,"./errors/BroadcastBeaconError":103,"./errors/NetworkNotSupportedBeaconError":104,"./errors/NoAddressBeaconError":105,"./errors/NoPrivateKeyBeaconError":106,"./errors/NotGrantedBeaconError":107,"./errors/ParametersInvalidBeaconError":108,"./errors/SignatureTypeNotSupportedBeaconError":109,"./errors/TooManyOperationsBeaconError":110,"./errors/TransactionInvalidBeaconError":111,"./errors/UnknownBeaconError":112,"./managers/AccountManager":114,"./managers/AppMetadataManager":115,"./managers/PeerManager":116,"./managers/PermissionManager":117,"./storage/ChromeStorage":120,"./storage/LocalStorage":121,"./storage/getStorage":122,"./transports/Transport":123,"./transports/clients/CommunicationClient":124,"./transports/clients/MessageBasedClient":125,"./utils/Logger":126,"./utils/get-account-identifier":128,"./utils/get-sender-id":129}],114:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.AccountManager=void 0;var beacon_types_1=require("@airgap/beacon-types");var StorageManager_1=require("./StorageManager");var PermissionValidator_1=require("./PermissionValidator");var AccountManager=function(){function AccountManager(storage){this.storageManager=new StorageManager_1.StorageManager(storage,beacon_types_1.StorageKey.ACCOUNTS)}AccountManager.prototype.getAccounts=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getAll()]})})};AccountManager.prototype.getAccount=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getOne(function(account){return account.accountIdentifier===accountIdentifier})]})})};AccountManager.prototype.addAccount=function(accountInfo){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.addOne(accountInfo,function(account){return account.accountIdentifier===accountInfo.accountIdentifier})]})})};AccountManager.prototype.removeAccount=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(account){return account.accountIdentifier===accountIdentifier})]})})};AccountManager.prototype.removeAccounts=function(accountIdentifiers){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(account){return accountIdentifiers.includes(account.accountIdentifier)})]})})};AccountManager.prototype.removeAllAccounts=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.removeAll()]})})};AccountManager.prototype.hasPermission=function(message){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,PermissionValidator_1.PermissionValidator.hasPermission(message,this.getAccount.bind(this),this.getAccounts.bind(this))]})})};return AccountManager}();exports.AccountManager=AccountManager},{"./PermissionValidator":118,"./StorageManager":119,"@airgap/beacon-types":145}],115:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.AppMetadataManager=void 0;var beacon_types_1=require("@airgap/beacon-types");var StorageManager_1=require("./StorageManager");var AppMetadataManager=function(){function AppMetadataManager(storage){this.storageManager=new StorageManager_1.StorageManager(storage,beacon_types_1.StorageKey.APP_METADATA_LIST)}AppMetadataManager.prototype.getAppMetadataList=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getAll()]})})};AppMetadataManager.prototype.getAppMetadata=function(senderId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getOne(function(appMetadata){return appMetadata.senderId===senderId})]})})};AppMetadataManager.prototype.addAppMetadata=function(appMetadata){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.addOne(appMetadata,function(appMetadataElement){return appMetadataElement.senderId===appMetadata.senderId})]})})};AppMetadataManager.prototype.removeAppMetadata=function(senderId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(appMetadata){return appMetadata.senderId===senderId})]})})};AppMetadataManager.prototype.removeAppMetadatas=function(senderIds){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(appMetadata){return senderIds.includes(appMetadata.senderId)})]})})};AppMetadataManager.prototype.removeAllAppMetadata=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.removeAll()]})})};return AppMetadataManager}();exports.AppMetadataManager=AppMetadataManager},{"./StorageManager":119,"@airgap/beacon-types":145}],116:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.PeerManager=void 0;var StorageManager_1=require("./StorageManager");var PeerManager=function(){function PeerManager(storage,key){this.storageManager=new StorageManager_1.StorageManager(storage,key)}PeerManager.prototype.hasPeer=function(publicKey){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.getPeer(publicKey)];case 1:return[2,_a.sent()?true:false]}})})};PeerManager.prototype.getPeers=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getAll()]})})};PeerManager.prototype.getPeer=function(publicKey){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getOne(function(peer){return peer.publicKey===publicKey})]})})};PeerManager.prototype.addPeer=function(peerInfo){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.addOne(peerInfo,function(peer){return peer.publicKey===peerInfo.publicKey})]})})};PeerManager.prototype.removePeer=function(publicKey){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(peer){return peer.publicKey===publicKey})]})})};PeerManager.prototype.removePeers=function(publicKeys){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(peer){return publicKeys.includes(peer.publicKey)})]})})};PeerManager.prototype.removeAllPeers=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.removeAll()]})})};return PeerManager}();exports.PeerManager=PeerManager},{"./StorageManager":119}],117:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.PermissionManager=void 0;var beacon_types_1=require("@airgap/beacon-types");var StorageManager_1=require("./StorageManager");var PermissionValidator_1=require("./PermissionValidator");var PermissionManager=function(){function PermissionManager(storage){this.storageManager=new StorageManager_1.StorageManager(storage,beacon_types_1.StorageKey.PERMISSION_LIST)}PermissionManager.prototype.getPermissions=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getAll()]})})};PermissionManager.prototype.getPermission=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.getOne(function(permission){return permission.accountIdentifier===accountIdentifier})]})})};PermissionManager.prototype.addPermission=function(permissionInfo){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.addOne(permissionInfo,function(permission){return permission.accountIdentifier===permissionInfo.accountIdentifier})]})})};PermissionManager.prototype.removePermission=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(permissionInfo){return permissionInfo.accountIdentifier===accountIdentifier})]})})};PermissionManager.prototype.removePermissions=function(accountIdentifiers){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.remove(function(permission){return accountIdentifiers.includes(permission.accountIdentifier)})]})})};PermissionManager.prototype.removeAllPermissions=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storageManager.removeAll()]})})};PermissionManager.prototype.hasPermission=function(message){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,PermissionValidator_1.PermissionValidator.hasPermission(message,this.getPermission.bind(this),this.getPermissions.bind(this))]})})};return PermissionManager}();exports.PermissionManager=PermissionManager},{"./PermissionValidator":118,"./StorageManager":119,"@airgap/beacon-types":145}],118:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.PermissionValidator=void 0;var beacon_types_1=require("@airgap/beacon-types");var get_account_identifier_1=require("../utils/get-account-identifier");var PermissionValidator=function(){function PermissionValidator(){}PermissionValidator.hasPermission=function(message,getOne,getAll){return __awaiter(this,void 0,void 0,function(){var _a,accountIdentifier,permission,permissions,filteredPermissions;return __generator(this,function(_b){switch(_b.label){case 0:_a=message.type;switch(_a){case beacon_types_1.BeaconMessageType.PermissionRequest:return[3,1];case beacon_types_1.BeaconMessageType.BroadcastRequest:return[3,1];case beacon_types_1.BeaconMessageType.OperationRequest:return[3,2];case beacon_types_1.BeaconMessageType.SignPayloadRequest:return[3,5]}return[3,7];case 1:{return[2,true]}_b.label=2;case 2:return[4,(0,get_account_identifier_1.getAccountIdentifier)(message.sourceAddress,message.network)];case 3:accountIdentifier=_b.sent();return[4,getOne(accountIdentifier)];case 4:permission=_b.sent();if(!permission){return[2,false]}return[2,permission.scopes.includes(beacon_types_1.PermissionScope.OPERATION_REQUEST)];case 5:return[4,getAll()];case 6:permissions=_b.sent();filteredPermissions=permissions.filter(function(permission){return permission.address===message.sourceAddress});if(filteredPermissions.length===0){return[2,false]}return[2,filteredPermissions.some(function(permission){return permission.scopes.includes(beacon_types_1.PermissionScope.SIGN)})];case 7:throw new Error("Message not handled")}})})};return PermissionValidator}();exports.PermissionValidator=PermissionValidator},{"../utils/get-account-identifier":128,"@airgap/beacon-types":145}],119:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.StorageManager=void 0;function fixArrayType(array){return array}var StorageManager=function(){function StorageManager(storage,storageKey){this.storage=storage;this.storageKey=storageKey}StorageManager.prototype.getAll=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storage.get(this.storageKey)]})})};StorageManager.prototype.getOne=function(predicate){return __awaiter(this,void 0,void 0,function(){var entities;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.storage.get(this.storageKey)];case 1:entities=_a.sent();return[2,fixArrayType(entities).find(predicate)]}})})};StorageManager.prototype.addOne=function(element,predicate,overwrite){if(overwrite===void 0){overwrite=true}return __awaiter(this,void 0,void 0,function(){var entities,i;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.storage.get(this.storageKey)];case 1:entities=_a.sent();if(!fixArrayType(entities).some(predicate)){fixArrayType(entities).push(element)}else if(overwrite){for(i=0;i<entities.length;i++){if(predicate(fixArrayType(entities)[i])){entities[i]=element}}}return[2,this.storage.set(this.storageKey,entities)]}})})};StorageManager.prototype.remove=function(predicate){return __awaiter(this,void 0,void 0,function(){var entities,filteredEntities;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.storage.get(this.storageKey)];case 1:entities=_a.sent();filteredEntities=fixArrayType(entities).filter(function(entity){return!predicate(entity)});return[2,this.storage.set(this.storageKey,filteredEntities)]}})})};StorageManager.prototype.removeAll=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.storage.delete(this.storageKey)]})})};return StorageManager}();exports.StorageManager=StorageManager},{}],120:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.ChromeStorage=void 0;var beacon_types_1=require("@airgap/beacon-types");var ChromeStorage=function(){function ChromeStorage(){}ChromeStorage.isSupported=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,typeof window!=="undefined"&&typeof chrome!=="undefined"&&Boolean(chrome)&&Boolean(chrome.runtime)&&Boolean(chrome.runtime.id)]})})};ChromeStorage.prototype.get=function(key){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve){chrome.storage.local.get(null,function(storageContent){if(storageContent[key]){resolve(storageContent[key])}else{if(typeof beacon_types_1.defaultValues[key]==="object"){resolve(JSON.parse(JSON.stringify(beacon_types_1.defaultValues[key])))}else{resolve(beacon_types_1.defaultValues[key])}}})})]})})};ChromeStorage.prototype.set=function(key,value){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve){var _a;chrome.storage.local.set((_a={},_a[key]=value,_a),function(){resolve()})})]})})};ChromeStorage.prototype.delete=function(key){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,new Promise(function(resolve){var _a;chrome.storage.local.set((_a={},_a[key]=undefined,_a),function(){resolve()})})]})})};return ChromeStorage}();exports.ChromeStorage=ChromeStorage},{"@airgap/beacon-types":145}],121:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.LocalStorage=void 0;var beacon_types_1=require("@airgap/beacon-types");var LocalStorage=function(){function LocalStorage(prefix){this.prefix=prefix}LocalStorage.isSupported=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,Promise.resolve(Boolean(typeof window!=="undefined")&&Boolean(window.localStorage))]})})};LocalStorage.prototype.get=function(key){return __awaiter(this,void 0,void 0,function(){var value;return __generator(this,function(_a){value=localStorage.getItem(this.getPrefixedKey(key));if(!value){if(typeof beacon_types_1.defaultValues[key]==="object"){return[2,JSON.parse(JSON.stringify(beacon_types_1.defaultValues[key]))]}else{return[2,beacon_types_1.defaultValues[key]]}}else{try{return[2,JSON.parse(value)]}catch(jsonParseError){return[2,value]}}return[2]})})};LocalStorage.prototype.set=function(key,value){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(typeof value==="string"){return[2,localStorage.setItem(this.getPrefixedKey(key),value)]}else{return[2,localStorage.setItem(this.getPrefixedKey(key),JSON.stringify(value))]}return[2]})})};LocalStorage.prototype.delete=function(key){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,Promise.resolve(localStorage.removeItem(this.getPrefixedKey(key)))]})})};LocalStorage.prototype.getPrefixedKey=function(key){return this.prefix?"".concat(this.prefix,"-").concat(key):key};return LocalStorage}();exports.LocalStorage=LocalStorage},{"@airgap/beacon-types":145}],122:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.getStorage=void 0;var Logger_1=require("../utils/Logger");var __1=require("..");var logger=new Logger_1.Logger("STORAGE");var getStorage=function(){return __awaiter(void 0,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,__1.ChromeStorage.isSupported()];case 1:if(!_a.sent())return[3,2];logger.log("getStorage","USING CHROME STORAGE");return[2,new __1.ChromeStorage];case 2:return[4,__1.LocalStorage.isSupported()];case 3:if(_a.sent()){logger.log("getStorage","USING LOCAL STORAGE");return[2,new __1.LocalStorage]}else{throw new Error("no storage type supported")}_a.label=4;case 4:return[2]}})})};exports.getStorage=getStorage},{"..":113,"../utils/Logger":126}],123:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.Transport=void 0;var Logger_1=require("../utils/Logger");var beacon_types_1=require("@airgap/beacon-types");var logger=new Logger_1.Logger("Transport");var Transport=function(){function Transport(name,client,peerManager){this.type=beacon_types_1.TransportType.POST_MESSAGE;this._isConnected=beacon_types_1.TransportStatus.NOT_CONNECTED;this.listeners=[];this.name=name;this.client=client;this.peerManager=peerManager}Object.defineProperty(Transport.prototype,"connectionStatus",{get:function(){return this._isConnected},enumerable:false,configurable:true});Transport.isAvailable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,Promise.resolve(false)]})})};Transport.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){logger.log("connect");this._isConnected=beacon_types_1.TransportStatus.CONNECTED;return[2]})})};Transport.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){logger.log("disconnect");this._isConnected=beacon_types_1.TransportStatus.NOT_CONNECTED;return[2]})})};Transport.prototype.send=function(message,peer){return __awaiter(this,void 0,void 0,function(){var knownPeers,promises;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(!peer)return[3,1];return[2,this.client.sendMessage(message,peer)];case 1:return[4,this.getPeers()];case 2:knownPeers=_a.sent();promises=knownPeers.map(function(peerEl){return _this.client.sendMessage(message,peerEl)});return[4,Promise.all(promises)];case 3:return[2,_a.sent()[0]]}})})};Transport.prototype.addListener=function(listener){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){logger.debug("addListener");this.listeners.push(listener);return[2]})})};Transport.prototype.removeListener=function(listener){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){logger.log("removeListener");this.listeners=this.listeners.filter(function(element){return element!==listener});return[2]})})};Transport.prototype.getPeers=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.peerManager.getPeers()]})})};Transport.prototype.addPeer=function(newPeer,_sendPairingResponse){if(_sendPairingResponse===void 0){_sendPairingResponse=true}return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:logger.log("addPeer","adding peer",newPeer);return[4,this.peerManager.addPeer(newPeer)];case 1:_a.sent();return[4,this.listen(newPeer.publicKey)];case 2:_a.sent();return[2]}})})};Transport.prototype.removePeer=function(peerToBeRemoved){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:logger.log("removePeer","removing peer",peerToBeRemoved);return[4,this.peerManager.removePeer(peerToBeRemoved.publicKey)];case 1:_a.sent();if(!this.client)return[3,3];return[4,this.client.unsubscribeFromEncryptedMessage(peerToBeRemoved.publicKey)];case 2:_a.sent();_a.label=3;case 3:return[2]}})})};Transport.prototype.removeAllPeers=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:logger.log("removeAllPeers");return[4,this.peerManager.removeAllPeers()];case 1:_a.sent();if(!this.client)return[3,3];return[4,this.client.unsubscribeFromEncryptedMessages()];case 2:_a.sent();_a.label=3;case 3:return[2]}})})};Transport.prototype.notifyListeners=function(message,connectionInfo){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(this.listeners.length===0){logger.warn("notifyListeners","0 listeners notified!",this)}else{logger.log("notifyListeners","Notifying ".concat(this.listeners.length," listeners"),this)}this.listeners.forEach(function(listener){listener(message,connectionInfo)});return[2]})})};return Transport}();exports.Transport=Transport},{"../utils/Logger":126,"@airgap/beacon-types":145}],124:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.CommunicationClient=void 0;var beacon_utils_1=require("@airgap/beacon-utils");var ed25519_1=require("@stablelib/ed25519");var x25519_session_1=require("@stablelib/x25519-session");var CommunicationClient=function(){function CommunicationClient(keyPair){this.keyPair=keyPair}CommunicationClient.prototype.getPublicKey=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,(0,beacon_utils_1.toHex)(this.keyPair.publicKey)]})})};CommunicationClient.prototype.getPublicKeyHash=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,(0,beacon_utils_1.getHexHash)(this.keyPair.publicKey)]})})};CommunicationClient.prototype.createCryptoBoxServer=function(otherPublicKey,selfKeypair){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,(0,x25519_session_1.serverSessionKeys)({publicKey:(0,ed25519_1.convertPublicKeyToX25519)(selfKeypair.publicKey),secretKey:(0,ed25519_1.convertSecretKeyToX25519)(selfKeypair.secretKey)},(0,ed25519_1.convertPublicKeyToX25519)(Buffer.from(otherPublicKey,"hex")))]})})};CommunicationClient.prototype.createCryptoBoxClient=function(otherPublicKey,selfKeypair){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,(0,x25519_session_1.clientSessionKeys)({publicKey:(0,ed25519_1.convertPublicKeyToX25519)(selfKeypair.publicKey),secretKey:(0,ed25519_1.convertSecretKeyToX25519)(selfKeypair.secretKey)},(0,ed25519_1.convertPublicKeyToX25519)(Buffer.from(otherPublicKey,"hex")))]})})};CommunicationClient.prototype.encryptMessageAsymmetric=function(recipientPublicKey,message){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,(0,beacon_utils_1.sealCryptobox)(message,Buffer.from(recipientPublicKey,"hex"))]})})};return CommunicationClient}();exports.CommunicationClient=CommunicationClient}).call(this)}).call(this,require("buffer").Buffer)},{"@airgap/beacon-utils":163,"@stablelib/ed25519":5,"@stablelib/x25519-session":20,buffer:55}],125:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.MessageBasedClient=void 0;var constants_1=require("../../constants");var beacon_utils_1=require("@airgap/beacon-utils");var CommunicationClient_1=require("./CommunicationClient");var MessageBasedClient=function(_super){__extends(MessageBasedClient,_super);function MessageBasedClient(name,keyPair){var _this=_super.call(this,keyPair)||this;_this.name=name;_this.init().catch(console.error);return _this}MessageBasedClient.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,Promise.resolve()];case 1:_a.sent();return[2]}})})};MessageBasedClient.prototype.getPairingRequestInfo=function(){return __awaiter(this,void 0,void 0,function(){var _a;return __generator(this,function(_b){switch(_b.label){case 0:_a={};return[4,(0,beacon_utils_1.generateGUID)()];case 1:_a.id=_b.sent(),_a.type="postmessage-pairing-request",_a.name=this.name,_a.version=constants_1.BEACON_VERSION;return[4,this.getPublicKey()];case 2:return[2,(_a.publicKey=_b.sent(),_a)]}})})};MessageBasedClient.prototype.getPairingResponseInfo=function(request){return __awaiter(this,void 0,void 0,function(){var _a;return __generator(this,function(_b){switch(_b.label){case 0:_a={id:request.id,type:"postmessage-pairing-response",name:this.name,version:request.version};return[4,this.getPublicKey()];case 1:return[2,(_a.publicKey=_b.sent(),_a)]}})})};MessageBasedClient.prototype.unsubscribeFromEncryptedMessage=function(senderPublicKey){return __awaiter(this,void 0,void 0,function(){var listener;return __generator(this,function(_a){listener=this.activeListeners.get(senderPublicKey);if(!listener){return[2]}this.activeListeners.delete(senderPublicKey);return[2]})})};MessageBasedClient.prototype.unsubscribeFromEncryptedMessages=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){this.activeListeners.clear();return[2]})})};MessageBasedClient.prototype.decryptMessage=function(senderPublicKey,payload){return __awaiter(this,void 0,void 0,function(){var sharedKey,hexPayload,decryptionError_1;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.createCryptoBoxServer(senderPublicKey,this.keyPair)];case 1:sharedKey=_a.sent();hexPayload=Buffer.from(payload,"hex");if(!(hexPayload.length>=beacon_utils_1.secretbox_NONCEBYTES+beacon_utils_1.secretbox_MACBYTES))return[3,5];_a.label=2;case 2:_a.trys.push([2,4,,5]);return[4,(0,beacon_utils_1.decryptCryptoboxPayload)(hexPayload,sharedKey.receive)];case 3:return[2,_a.sent()];case 4:decryptionError_1=_a.sent();return[3,5];case 5:throw new Error("Could not decrypt message")}})})};MessageBasedClient.prototype.encryptMessage=function(recipientPublicKey,message){return __awaiter(this,void 0,void 0,function(){var sharedKey;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.createCryptoBoxClient(recipientPublicKey,this.keyPair)];case 1:sharedKey=_a.sent();return[2,(0,beacon_utils_1.encryptCryptoboxPayload)(message,sharedKey.send)]}})})};return MessageBasedClient}(CommunicationClient_1.CommunicationClient);exports.MessageBasedClient=MessageBasedClient}).call(this)}).call(this,require("buffer").Buffer)},{"../../constants":99,"./CommunicationClient":124,"@airgap/beacon-utils":163,buffer:55}],126:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getLogger=exports.setLogger=exports.Logger=exports.InternalLogger=void 0;var debug_1=require("../debug");var InternalLogger=function(){function InternalLogger(){}InternalLogger.prototype.debug=function(name,method){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}this._log("debug",name,method,args)};InternalLogger.prototype.log=function(name,method){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}this._log("log",name,method,args)};InternalLogger.prototype.warn=function(name,method){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}this._log("warn",name,method,args)};InternalLogger.prototype.error=function(name,method){var args=[];for(var _i=2;_i<arguments.length;_i++){args[_i-2]=arguments[_i]}this._log("error",name,method,args)};InternalLogger.prototype._log=function(type,name,method,args){if(args===void 0){args=[]}if(!(0,debug_1.getDebugEnabled)()){return}var groupText="[BEACON] ".concat((new Date).toISOString()," [").concat(name,"](").concat(method,")");var data=args;if(args[0]&&typeof args[0]==="string"){groupText+=" ".concat(args[0]);data=args.slice(1)}switch(type){case"error":console.group(groupText);console.error.apply(console,data);break;case"warn":console.group(groupText);console.warn.apply(console,data);break;case"debug":console.groupCollapsed(groupText);console.debug.apply(console,data);break;default:console.group(groupText);console.log.apply(console,data)}console.groupEnd()};return InternalLogger}();exports.InternalLogger=InternalLogger;var Logger=function(){function Logger(service){this.name=service}Logger.prototype.debug=function(method){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}logger.debug(this.name,method,args)};Logger.prototype.log=function(method){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}logger.log(this.name,method,args)};Logger.prototype.warn=function(method){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}logger.warn(this.name,method,args)};Logger.prototype.error=function(method){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}logger.error(this.name,method,args)};return Logger}();exports.Logger=Logger;var loggerWrapper=new Logger("");var logger=new InternalLogger;var setLogger=function(newLogger){logger=newLogger};exports.setLogger=setLogger;var getLogger=function(){return loggerWrapper};exports.getLogger=getLogger},{"../debug":100}],127:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.assertNever=void 0;function assertNever(empty){return empty}exports.assertNever=assertNever},{}],128:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.getAccountIdentifier=void 0;var bs58check=require("bs58check");var blake2b_1=require("@stablelib/blake2b");var utf8_1=require("@stablelib/utf8");var getAccountIdentifier=function(address,network){return __awaiter(void 0,void 0,void 0,function(){var data,buffer;return __generator(this,function(_a){data=[address,network.type];if(network.name){data.push("name:".concat(network.name))}if(network.rpcUrl){data.push("rpc:".concat(network.rpcUrl))}buffer=Buffer.from((0,blake2b_1.hash)((0,utf8_1.encode)(data.join("-")),10));return[2,bs58check.encode(buffer)]})})};exports.getAccountIdentifier=getAccountIdentifier}).call(this)}).call(this,require("buffer").Buffer)},{"@stablelib/blake2b":2,"@stablelib/utf8":17,bs58check:58,buffer:55}],129:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.getSenderId=void 0;var blake2b_1=require("@stablelib/blake2b");var bs58check=require("bs58check");var getSenderId=function(publicKey){return __awaiter(void 0,void 0,void 0,function(){var buffer;return __generator(this,function(_a){buffer=Buffer.from((0,blake2b_1.hash)(Buffer.from(publicKey,"hex"),5));return[2,bs58check.encode(buffer)]})})};exports.getSenderId=getSenderId}).call(this)}).call(this,require("buffer").Buffer)},{"@stablelib/blake2b":2,bs58check:58,buffer:55}],130:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.P2PTransport=void 0;var beacon_core_1=require("@airgap/beacon-core");var beacon_types_1=require("@airgap/beacon-types");var beacon_transport_matrix_1=require("@airgap/beacon-transport-matrix");var logger=new beacon_core_1.Logger("P2PTransport");var P2PTransport=function(_super){__extends(P2PTransport,_super);function P2PTransport(name,keyPair,storage,matrixNodes,storageKey,iconUrl,appUrl){var _this=_super.call(this,name,new beacon_transport_matrix_1.P2PCommunicationClient(name,keyPair,1,storage,matrixNodes,iconUrl,appUrl),new beacon_core_1.PeerManager(storage,storageKey))||this;_this.type=beacon_types_1.TransportType.P2P;return _this}P2PTransport.isAvailable=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,Promise.resolve(true)]})})};P2PTransport.prototype.connect=function(){return __awaiter(this,void 0,void 0,function(){var knownPeers,connectionPromises;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(this._isConnected!==beacon_types_1.TransportStatus.NOT_CONNECTED){return[2]}logger.log("connect");this._isConnected=beacon_types_1.TransportStatus.CONNECTING;return[4,this.client.start()];case 1:_a.sent();return[4,this.getPeers()];case 2:knownPeers=_a.sent();if(knownPeers.length>0){logger.log("connect","connecting to ".concat(knownPeers.length," peers"));connectionPromises=knownPeers.map(function(peer){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.listen(peer.publicKey)]})})});Promise.all(connectionPromises).catch(function(error){return logger.error("connect",error)})}return[4,this.startOpenChannelListener()];case 3:_a.sent();return[2,_super.prototype.connect.call(this)]}})})};P2PTransport.prototype.disconnect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.client.stop()];case 1:_a.sent();return[2,_super.prototype.disconnect.call(this)]}})})};P2PTransport.prototype.startOpenChannelListener=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})};P2PTransport.prototype.getPairingRequestInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.client.getPairingRequestInfo()]})})};P2PTransport.prototype.listen=function(publicKey){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.client.listenForEncryptedMessage(publicKey,function(message){var connectionContext={origin:beacon_types_1.Origin.P2P,id:publicKey};_this.notifyListeners(message,connectionContext).catch(function(error){throw error})}).catch(function(error){throw error})];case 1:_a.sent();return[2]}})})};return P2PTransport}(beacon_core_1.Transport);exports.P2PTransport=P2PTransport},{"@airgap/beacon-core":113,"@airgap/beacon-transport-matrix":132,"@airgap/beacon-types":145}],131:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};var _a;Object.defineProperty(exports,"__esModule",{value:true});exports.P2PCommunicationClient=void 0;var ed25519_1=require("@stablelib/ed25519");var axios_1=require("axios");var beacon_utils_1=require("@airgap/beacon-utils");var MatrixClient_1=require("../matrix-client/MatrixClient");var MatrixClientEvent_1=require("../matrix-client/models/MatrixClientEvent");var MatrixMessage_1=require("../matrix-client/models/MatrixMessage");var beacon_types_1=require("@airgap/beacon-types");var beacon_core_1=require("@airgap/beacon-core");var beacon_utils_2=require("@airgap/beacon-utils");var blake2b_1=require("@stablelib/blake2b");var utf8_1=require("@stablelib/utf8");var logger=new beacon_core_1.Logger("P2PCommunicationClient");var REGIONS_AND_SERVERS=(_a={},_a[beacon_types_1.Regions.EUROPE_WEST]=["beacon-node-1.diamond.papers.tech","beacon-node-1.sky.papers.tech","beacon-node-2.sky.papers.tech","beacon-node-1.hope.papers.tech","beacon-node-1.hope-2.papers.tech","beacon-node-1.hope-3.papers.tech","beacon-node-1.hope-4.papers.tech","beacon-node-1.hope-5.papers.tech"],_a);var P2PCommunicationClient=function(_super){__extends(P2PCommunicationClient,_super);function P2PCommunicationClient(name,keyPair,replicationCount,storage,matrixNodes,iconUrl,appUrl){var _this=_super.call(this,keyPair)||this;_this.name=name;_this.replicationCount=replicationCount;_this.storage=storage;_this.iconUrl=iconUrl;_this.appUrl=appUrl;_this.client=new beacon_utils_2.ExposedPromise;_this.activeListeners=new Map;_this.ignoredRooms=[];_this.loginCounter=0;logger.log("constructor","P2PCommunicationClient created");_this.ENABLED_RELAY_SERVERS=REGIONS_AND_SERVERS;if(matrixNodes){_this.ENABLED_RELAY_SERVERS=__assign(__assign({},REGIONS_AND_SERVERS),matrixNodes)}return _this}P2PCommunicationClient.prototype.getPairingRequestInfo=function(){return __awaiter(this,void 0,void 0,function(){var info;var _a;return __generator(this,function(_b){switch(_b.label){case 0:_a={};return[4,(0,beacon_utils_2.generateGUID)()];case 1:_a.id=_b.sent(),_a.type="p2p-pairing-request",_a.name=this.name,_a.version=beacon_core_1.BEACON_VERSION;return[4,this.getPublicKey()];case 2:_a.publicKey=_b.sent();return[4,this.getRelayServer()];case 3:info=(_a.relayServer=_b.sent().server,_a);if(this.iconUrl){info.icon=this.iconUrl}if(this.appUrl){info.appUrl=this.appUrl}return[2,info]}})})};P2PCommunicationClient.prototype.getPairingResponseInfo=function(request){return __awaiter(this,void 0,void 0,function(){var info;var _a;return __generator(this,function(_b){switch(_b.label){case 0:_a={id:request.id,type:"p2p-pairing-response",name:this.name,version:request.version};return[4,this.getPublicKey()];case 1:_a.publicKey=_b.sent();return[4,this.getRelayServer()];case 2:info=(_a.relayServer=_b.sent().server,_a);if(this.iconUrl){info.icon=this.iconUrl}if(this.appUrl){info.appUrl=this.appUrl}return[2,info]}})})};P2PCommunicationClient.prototype.findBestRegion=function(){return __awaiter(this,void 0,void 0,function(){var keys,allPromises,region;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(this.selectedRegion){return[2,this.selectedRegion]}keys=Object.keys(this.ENABLED_RELAY_SERVERS);allPromises=[];keys.forEach(function(key){var _a;var nodes=(_a=_this.ENABLED_RELAY_SERVERS[key])!==null&&_a!==void 0?_a:[];var index=Math.floor(Math.random()*nodes.length);allPromises.push(_this.getBeaconInfo(nodes[index]).then(function(res){return{region:key,server:nodes[index],response:res}}).catch(function(err){return new Promise(function(_resolve,reject){setTimeout(function(){return reject(err)},2e3)})}))});return[4,Promise.race(allPromises)];case 1:region=_a.sent();this.selectedRegion=region.region;return[2,region.region]}})})};P2PCommunicationClient.prototype.getRelayServer=function(){return __awaiter(this,void 0,void 0,function(){var relayServer,info,node,info,region,regionNodes,nodes,index,server,response,relayError_1;return __generator(this,function(_a){switch(_a.label){case 0:if(!this.relayServer)return[3,3];return[4,this.relayServer.promise];case 1:relayServer=_a.sent();if(Date.now()-relayServer.localTimestamp<60*1e3){return[2,{server:relayServer.server,timestamp:relayServer.timestamp}]}return[4,this.getBeaconInfo(relayServer.server)];case 2:info=_a.sent();this.relayServer.resolve({server:relayServer.server,timestamp:info.timestamp,localTimestamp:(new Date).getTime()});return[2,{server:relayServer.server,timestamp:info.timestamp}];case 3:this.relayServer=new beacon_utils_2.ExposedPromise;_a.label=4;case 4:return[4,this.storage.get(beacon_types_1.StorageKey.MATRIX_SELECTED_NODE)];case 5:node=_a.sent();if(!(node&&node.length>0))return[3,7];return[4,this.getBeaconInfo(node)];case 6:info=_a.sent();this.relayServer.resolve({server:node,timestamp:info.timestamp,localTimestamp:(new Date).getTime()});return[2,{server:node,timestamp:info.timestamp}];case 7:return[4,this.findBestRegion()];case 8:region=_a.sent();regionNodes=this.ENABLED_RELAY_SERVERS[region];if(!regionNodes){throw new Error("No servers found for region ".concat(region))}nodes=__spreadArray([],regionNodes,true);_a.label=9;case 9:if(!(nodes.length>0))return[3,14];index=Math.floor(Math.random()*nodes.length);server=nodes[index];_a.label=10;case 10:_a.trys.push([10,12,,13]);return[4,this.getBeaconInfo(server)];case 11:response=_a.sent();this.storage.set(beacon_types_1.StorageKey.MATRIX_SELECTED_NODE,server).catch(function(error){return logger.log(error)});this.relayServer.resolve({server:server,timestamp:response.timestamp,localTimestamp:(new Date).getTime()});return[2,{server:server,timestamp:response.timestamp}];case 12:relayError_1=_a.sent();logger.log('Ignoring server "'.concat(server,'", trying another one...'));nodes.splice(index,1);return[3,13];case 13:return[3,9];case 14:this.relayServer.reject("No matrix server reachable!");throw new Error("No matrix server reachable!")}})})};P2PCommunicationClient.prototype.getBeaconInfo=function(server){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,axios_1.default.get("https://".concat(server,"/_synapse/client/beacon/info")).then(function(res){return{region:res.data.region,known_servers:res.data.known_servers,timestamp:Math.floor(res.data.timestamp)}})]})})};P2PCommunicationClient.prototype.tryJoinRooms=function(roomId,retry){if(retry===void 0){retry=1}return __awaiter(this,void 0,void 0,function(){var error_1;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,3,,4]);return[4,this.client.promise];case 1:return[4,_a.sent().joinRooms(roomId)];case 2:_a.sent();return[3,4];case 3:error_1=_a.sent();if(retry<=10&&error_1.errcode==="M_FORBIDDEN"){logger.log("Retrying to join...",error_1);setTimeout(function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.tryJoinRooms(roomId,retry+1)];case 1:_a.sent();return[2]}})})},200)}else{logger.log("Failed to join after ".concat(retry," tries."),error_1)}return[3,4];case 4:return[2]}})})};P2PCommunicationClient.prototype.start=function(){var _a,_b;return __awaiter(this,void 0,void 0,function(){var relayServer,client,time,loginString,_c,_d,_e,_f,_g,loginRawDigest,secretKey,rawSignature,_h,_j,_k,_l,error_2;var _m;var _this=this;return __generator(this,function(_o){switch(_o.label){case 0:logger.log("start","starting client");logger.log("start","connecting to server");return[4,this.getRelayServer()];case 1:relayServer=_o.sent();client=MatrixClient_1.MatrixClient.create({baseUrl:"https://".concat(relayServer.server),storage:this.storage});this.initialListener=function(event){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){if(this.initialEvent&&this.initialEvent.timestamp&&event&&event.timestamp){if(this.initialEvent.timestamp<event.timestamp){this.initialEvent=event}}else{this.initialEvent=event}return[2]})})};client.subscribe(MatrixClientEvent_1.MatrixClientEventType.MESSAGE,this.initialListener);client.subscribe(MatrixClientEvent_1.MatrixClientEventType.INVITE,function(event){return __awaiter(_this,void 0,void 0,function(){var member;return __generator(this,function(_a){switch(_a.label){case 0:if(event.content.members.length===1){member=event.content.members[0]}return[4,this.tryJoinRooms(event.content.roomId)];case 1:_a.sent();if(!member)return[3,4];return[4,this.updateRelayServer(member)];case 2:_a.sent();return[4,this.updatePeerRoom(member,event.content.roomId)];case 3:_a.sent();_a.label=4;case 4:return[2]}})})});if(!relayServer.timestamp){throw new Error("No timestamp received from relay server")}time=Math.floor(relayServer.timestamp);loginString="login:".concat(Math.floor(time/(5*60)));_d=(_c=logger).log;_e=["start"];_g=(_f="login ".concat(loginString,", ")).concat;return[4,this.getPublicKeyHash()];case 2:_d.apply(_c,_e.concat([_g.apply(_f,[_o.sent()," on "]).concat(relayServer.server)]));loginRawDigest=(0,blake2b_1.hash)((0,utf8_1.encode)(loginString),32);secretKey=(_a=this.keyPair.secretKey)!==null&&_a!==void 0?_a:this.keyPair.privateKey;rawSignature=(0,ed25519_1.sign)(secretKey,loginRawDigest);_o.label=3;case 3:_o.trys.push([3,7,,9]);_j=(_h=client).start;_m={};return[4,this.getPublicKeyHash()];case 4:_m.id=_o.sent();_l=(_k="ed:".concat((0,beacon_utils_1.toHex)(rawSignature),":")).concat;return[4,this.getPublicKey()];case 5:return[4,_j.apply(_h,[(_m.password=_l.apply(_k,[_o.sent()]),_m.deviceId=(0,beacon_utils_1.toHex)(this.keyPair.publicKey),_m)])];case 6:_o.sent();return[3,9];case 7:error_2=_o.sent();logger.error("start","Could not log in, retrying");return[4,this.reset()];case 8:_o.sent();if(!this.selectedRegion){throw new Error("No region selected.")}if(this.loginCounter<=((_b=this.ENABLED_RELAY_SERVERS[this.selectedRegion])!==null&&_b!==void 0?_b:[]).length){this.loginCounter++;this.start();return[2]}else{logger.error("start","Tried to log in to every known beacon node, but no login was successful.");throw new Error("Could not connect to any beacon nodes. Try again later.")}return[3,9];case 9:logger.log("start","login successful, client is ready");this.client.resolve(client);return[2]}})})};P2PCommunicationClient.prototype.stop=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:logger.log("stop","stopping client");if(!this.client.isResolved())return[3,3];return[4,this.client.promise];case 1:return[4,_a.sent().stop().catch(function(error){return logger.error(error)})];case 2:_a.sent();_a.label=3;case 3:return[4,this.reset()];case 4:_a.sent();return[2]}})})};P2PCommunicationClient.prototype.reset=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:logger.log("reset","resetting connection");return[4,this.storage.delete(beacon_types_1.StorageKey.MATRIX_PEER_ROOM_IDS).catch(function(error){return logger.log(error)})];case 1:_a.sent();return[4,this.storage.delete(beacon_types_1.StorageKey.MATRIX_PRESERVED_STATE).catch(function(error){return logger.log(error)})];case 2:_a.sent();return[4,this.storage.delete(beacon_types_1.StorageKey.MATRIX_SELECTED_NODE).catch(function(error){return logger.log(error)})];case 3:_a.sent();this.relayServer=undefined;this.client=new beacon_utils_2.ExposedPromise;this.initialEvent=undefined;this.initialListener=undefined;return[2]}})})};P2PCommunicationClient.prototype.listenForEncryptedMessage=function(senderPublicKey,messageCallback){return __awaiter(this,void 0,void 0,function(){var sharedKey,callbackFunction,lastEvent,initialListener;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(this.activeListeners.has(senderPublicKey)){return[2]}logger.log("listenForEncryptedMessage","start listening for encrypted messages from publicKey ".concat(senderPublicKey));return[4,this.createCryptoBoxServer(senderPublicKey,this.keyPair)];case 1:sharedKey=_a.sent();callbackFunction=function(event){return __awaiter(_this,void 0,void 0,function(){var _a,payload,decryptedMessage,decryptionError_1;return __generator(this,function(_b){switch(_b.label){case 0:_a=this.isTextMessage(event.content);if(!_a)return[3,2];return[4,this.isSender(event,senderPublicKey)];case 1:_a=_b.sent();_b.label=2;case 2:if(!_a)return[3,8];payload=void 0;return[4,this.updateRelayServer(event.content.message.sender)];case 3:_b.sent();return[4,this.updatePeerRoom(event.content.message.sender,event.content.roomId)];case 4:_b.sent();try{payload=Buffer.from(event.content.message.content,"hex")}catch(_c){}if(!(payload&&payload.length>=beacon_utils_1.secretbox_NONCEBYTES+beacon_utils_1.secretbox_MACBYTES))return[3,8];_b.label=5;case 5:_b.trys.push([5,7,,8]);return[4,(0,beacon_utils_1.decryptCryptoboxPayload)(payload,sharedKey.receive)];case 6:decryptedMessage=_b.sent();logger.log("listenForEncryptedMessage","received a message from ".concat(senderPublicKey),decryptedMessage);messageCallback(decryptedMessage);return[3,8];case 7:decryptionError_1=_b.sent();return[3,8];case 8:return[2]}})})};this.activeListeners.set(senderPublicKey,callbackFunction);return[4,this.client.promise];case 2:_a.sent().subscribe(MatrixClientEvent_1.MatrixClientEventType.MESSAGE,callbackFunction);lastEvent=this.initialEvent;if(!(lastEvent&&lastEvent.timestamp&&(new Date).getTime()-lastEvent.timestamp<5*60*1e3))return[3,4];logger.log("listenForEncryptedMessage","Handling previous event");return[4,callbackFunction(lastEvent)];case 3:_a.sent();return[3,5];case 4:logger.log("listenForEncryptedMessage","No previous event found");_a.label=5;case 5:initialListener=this.initialListener;if(!initialListener)return[3,7];return[4,this.client.promise];case 6:_a.sent().unsubscribe(MatrixClientEvent_1.MatrixClientEventType.MESSAGE,initialListener);_a.label=7;case 7:this.initialListener=undefined;this.initialEvent=undefined;return[2]}})})};P2PCommunicationClient.prototype.unsubscribeFromEncryptedMessage=function(senderPublicKey){return __awaiter(this,void 0,void 0,function(){var listener;return __generator(this,function(_a){switch(_a.label){case 0:listener=this.activeListeners.get(senderPublicKey);if(!listener){return[2]};return[4,this.client.promise];case 1:_a.sent().unsubscribe(MatrixClientEvent_1.MatrixClientEventType.MESSAGE,listener);this.activeListeners.delete(senderPublicKey);return[2]}})})};P2PCommunicationClient.prototype.unsubscribeFromEncryptedMessages=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:;return[4,this.client.promise];case 1:_a.sent().unsubscribeAll(MatrixClientEvent_1.MatrixClientEventType.MESSAGE);this.activeListeners.clear();return[2]}})})};P2PCommunicationClient.prototype.sendMessage=function(message,peer){return __awaiter(this,void 0,void 0,function(){var sharedKey,recipientHash,recipient,roomId,encryptedMessage;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.createCryptoBoxClient(peer.publicKey,this.keyPair)];case 1:sharedKey=_a.sent();return[4,(0,beacon_utils_1.getHexHash)(Buffer.from(peer.publicKey,"hex"))];case 2:recipientHash=_a.sent();recipient=(0,beacon_utils_1.recipientString)(recipientHash,peer.relayServer);return[4,this.getRelevantRoom(recipient)];case 3:roomId=_a.sent();return[4,this.waitForJoin(roomId)];case 4:_a.sent();return[4,(0,beacon_utils_1.encryptCryptoboxPayload)(message,sharedKey.send)];case 5:encryptedMessage=_a.sent();logger.log("sendMessage","sending encrypted message",peer.publicKey,roomId,message);return[4,this.client.promise];case 6:_a.sent().sendTextMessage(roomId,encryptedMessage).catch(function(error){return __awaiter(_this,void 0,void 0,function(){var newRoomId_1;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(!(error.errcode==="M_FORBIDDEN"))return[3,4];logger.log("sendMessage","M_FORBIDDEN",roomId,error);return[4,this.deleteRoomIdFromRooms(roomId)];case 1:_a.sent();return[4,this.getRelevantRoom(recipient)];case 2:newRoomId_1=_a.sent();logger.log("sendMessage","Old room deleted, new room created",newRoomId_1);return[4,this.client.promise];case 3:_a.sent().sendTextMessage(newRoomId_1,encryptedMessage).catch(function(error2){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){logger.log("sendMessage","inner error",newRoomId_1,error2);return[2]})})});return[3,5];case 4:logger.log("sendMessage","unexpected error",error);_a.label=5;case 5:return[2]}})})});return[2]}})})};P2PCommunicationClient.prototype.updatePeerRoom=function(sender,roomId){return __awaiter(this,void 0,void 0,function(){var split,roomIds,room;return __generator(this,function(_a){switch(_a.label){case 0:logger.log("updatePeerRoom",sender,roomId);split=sender.split(":");if(split.length<2||!split[0].startsWith("@")){throw new Error("Invalid sender")}return[4,this.storage.get(beacon_types_1.StorageKey.MATRIX_PEER_ROOM_IDS)];case 1:roomIds=_a.sent();room=roomIds[sender];if(room===roomId){logger.debug("updatePeerRoom","rooms are the same, not updating")}logger.debug("updatePeerRoom","current room",room,"new room",roomId);if(room&&room[1]){logger.log("updatePeerRoom",'adding room "'.concat(room[1],'" to ignored array'));this.ignoredRooms.push(room[1])}roomIds[sender]=roomId;return[4,this.storage.set(beacon_types_1.StorageKey.MATRIX_PEER_ROOM_IDS,roomIds)];case 2:_a.sent();return[2]}})})};P2PCommunicationClient.prototype.deleteRoomIdFromRooms=function(roomId){return __awaiter(this,void 0,void 0,function(){var roomIds,newRoomIds;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.storage.get(beacon_types_1.StorageKey.MATRIX_PEER_ROOM_IDS)];case 1:roomIds=_a.sent();newRoomIds=Object.entries(roomIds).filter(function(entry){return entry[1]!==roomId}).reduce(function(pv,cv){var _a;return __assign(__assign({},pv),(_a={},_a[cv[0]]=cv[1],_a))},{});return[4,this.storage.set(beacon_types_1.StorageKey.MATRIX_PEER_ROOM_IDS,newRoomIds)];case 2:_a.sent();this.ignoredRooms.push(roomId);return[2]}})})};P2PCommunicationClient.prototype.listenForChannelOpening=function(messageCallback){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:logger.debug("listenForChannelOpening");return[4,this.client.promise];case 1:_a.sent().subscribe(MatrixClientEvent_1.MatrixClientEventType.MESSAGE,function(event){return __awaiter(_this,void 0,void 0,function(){var _a,splits,payload,pairingResponse,_b,_c,_d,_e,decryptionError_2;var _f;return __generator(this,function(_g){switch(_g.label){case 0:_a=this.isTextMessage(event.content);if(!_a)return[3,2];return[4,this.isChannelOpenMessage(event.content)];case 1:_a=_g.sent();_g.label=2;case 2:if(!_a)return[3,9];logger.log("listenForChannelOpening","channel opening received, trying to decrypt",JSON.stringify(event));return[4,this.updateRelayServer(event.content.message.sender)];case 3:_g.sent();return[4,this.updatePeerRoom(event.content.message.sender,event.content.roomId)];case 4:_g.sent();splits=event.content.message.content.split(":");payload=Buffer.from(splits[splits.length-1],"hex");if(!(payload.length>=beacon_utils_1.secretbox_NONCEBYTES+beacon_utils_1.secretbox_MACBYTES))return[3,9];_g.label=5;case 5:_g.trys.push([5,8,,9]);_c=(_b=JSON).parse;return[4,(0,beacon_utils_1.openCryptobox)(payload,this.keyPair.publicKey,this.keyPair.secretKey)];case 6:pairingResponse=_c.apply(_b,[_g.sent()]);logger.log("listenForChannelOpening","channel opening received and decrypted",JSON.stringify(pairingResponse));_d=messageCallback;_e=[__assign({},pairingResponse)];_f={};return[4,(0,beacon_core_1.getSenderId)(pairingResponse.publicKey)];case 7:_d.apply(void 0,[__assign.apply(void 0,_e.concat([(_f.senderId=_g.sent(),_f)]))]);return[3,9];case 8:decryptionError_2=_g.sent();return[3,9];case 9:return[2]}})})});return[2]}})})};P2PCommunicationClient.prototype.waitForJoin=function(roomId,retry){if(retry===void 0){retry=0}return __awaiter(this,void 0,void 0,function(){var room;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.client.promise];case 1:return[4,_a.sent().getRoomById(roomId)];case 2:room=_a.sent();logger.log("waitForJoin","Currently ".concat(room.members.length," members, we need at least 2"));if(room.members.length>=2||room.members.length===0){return[2]}else{if(retry<=200){logger.log("Waiting for join... Try: ".concat(retry));return[2,new Promise(function(resolve){setTimeout(function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){resolve(this.waitForJoin(roomId,retry+1));return[2]})})},100*(retry>50?10:1))})]}else{throw new Error("No one joined after ".concat(retry," tries."))}}return[2]}})})};P2PCommunicationClient.prototype.sendPairingResponse=function(pairingRequest){return __awaiter(this,void 0,void 0,function(){var recipientHash,recipient,roomId,message,_a,_b,_c,encryptedMessage,msg;var _this=this;return __generator(this,function(_d){switch(_d.label){case 0:logger.log("sendPairingResponse");return[4,(0,beacon_utils_1.getHexHash)(Buffer.from(pairingRequest.publicKey,"hex"))];case 1:recipientHash=_d.sent();recipient=(0,beacon_utils_1.recipientString)(recipientHash,pairingRequest.relayServer);return[4,this.client.promise];case 2:return[4,_d.sent().createTrustedPrivateRoom(recipient)];case 3:roomId=_d.sent();logger.debug("sendPairingResponse",'Connecting to room "'.concat(roomId,'"'));return[4,this.updatePeerRoom(recipient,roomId)];case 4:_d.sent();return[4,this.waitForJoin(roomId)];case 5:_d.sent();logger.debug("sendPairingResponse","Successfully joined room.");if(!(typeof pairingRequest.version==="undefined"))return[3,7];return[4,this.getPublicKey()];case 6:_a=_d.sent();return[3,9];case 7:_c=(_b=JSON).stringify;return[4,this.getPairingResponseInfo(pairingRequest)];case 8:_a=_c.apply(_b,[_d.sent()]);_d.label=9;case 9:message=_a;logger.debug("sendPairingResponse","Sending pairing response",message);return[4,this.encryptMessageAsymmetric(pairingRequest.publicKey,message)];case 10:encryptedMessage=_d.sent();msg=["@channel-open",recipient,encryptedMessage].join(":");return[4,this.client.promise];case 11:_d.sent().sendTextMessage(roomId,msg).catch(function(error){return __awaiter(_this,void 0,void 0,function(){var newRoomId_2;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:if(!(error.errcode==="M_FORBIDDEN"))return[3,4];logger.log("sendPairingResponse","M_FORBIDDEN",roomId,error);return[4,this.deleteRoomIdFromRooms(roomId)];case 1:_a.sent();return[4,this.getRelevantRoom(recipient)];case 2:newRoomId_2=_a.sent();logger.log("sendPairingResponse","Old room deleted, new room created",newRoomId_2);return[4,this.client.promise];case 3:_a.sent().sendTextMessage(newRoomId_2,msg).catch(function(error2){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){logger.log("sendPairingResponse","inner error",newRoomId_2,error2);return[2]})})});return[3,5];case 4:logger.log("sendPairingResponse","unexpected error",error);_a.label=5;case 5:return[2]}})})});return[2]}})})};P2PCommunicationClient.prototype.isTextMessage=function(content){return content.message.type===MatrixMessage_1.MatrixMessageType.TEXT};P2PCommunicationClient.prototype.updateRelayServer=function(sender){return __awaiter(this,void 0,void 0,function(){var split,senderHash,relayServer,manager,peers,promiseArray;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:logger.log("updateRelayServer",sender);split=sender.split(":");if(split.length<2||!split[0].startsWith("@")){throw new Error("Invalid sender")}senderHash=split.shift();relayServer=split.join(":");manager=localStorage.getItem("beacon:communication-peers-dapp")?new beacon_core_1.PeerManager(this.storage,beacon_types_1.StorageKey.TRANSPORT_P2P_PEERS_DAPP):new beacon_core_1.PeerManager(this.storage,beacon_types_1.StorageKey.TRANSPORT_P2P_PEERS_WALLET);return[4,manager.getPeers()];case 1:peers=_a.sent();promiseArray=peers.map(function(peer){return __awaiter(_this,void 0,void 0,function(){var hash,_a;return __generator(this,function(_b){switch(_b.label){case 0:_a="@".concat;return[4,(0,beacon_utils_1.getHexHash)(Buffer.from(peer.publicKey,"hex"))];case 1:hash=_a.apply("@",[_b.sent()]);if(!(hash===senderHash))return[3,3];if(!(peer.relayServer!==relayServer))return[3,3];peer.relayServer=relayServer;return[4,manager.addPeer(peer)];case 2:_b.sent();_b.label=3;case 3:return[2]}})})});return[4,Promise.all(promiseArray)];case 2:_a.sent();return[2]}})})};P2PCommunicationClient.prototype.isChannelOpenMessage=function(content){return __awaiter(this,void 0,void 0,function(){var _a,_b,_c,_d,_e,_f;return __generator(this,function(_g){switch(_g.label){case 0:_b=(_a=content.message.content).startsWith;_c="@channel-open:@".concat;_d=beacon_utils_1.getHexHash;_f=(_e=Buffer).from;return[4,this.getPublicKey()];case 1:return[4,_d.apply(void 0,[_f.apply(_e,[_g.sent(),"hex"])])];case 2:return[2,_b.apply(_a,[_c.apply("@channel-open:@",[_g.sent()])])]}})})};P2PCommunicationClient.prototype.isSender=function(event,senderPublicKey){return __awaiter(this,void 0,void 0,function(){var _a,_b,_c;return __generator(this,function(_d){switch(_d.label){case 0:_b=(_a=event.content.message.sender).startsWith;_c="@".concat;return[4,(0,beacon_utils_1.getHexHash)(Buffer.from(senderPublicKey,"hex"))];case 1:return[2,_b.apply(_a,[_c.apply("@",[_d.sent()])])]}})})};P2PCommunicationClient.prototype.getRelevantRoom=function(recipient){return __awaiter(this,void 0,void 0,function(){var roomIds,roomId,room;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.storage.get(beacon_types_1.StorageKey.MATRIX_PEER_ROOM_IDS)];case 1:roomIds=_a.sent();roomId=roomIds[recipient];if(!!roomId)return[3,4];logger.log("getRelevantRoom","No room found for peer ".concat(recipient,", checking joined ones."));return[4,this.getRelevantJoinedRoom(recipient)];case 2:room=_a.sent();roomId=room.id;roomIds[recipient]=room.id;return[4,this.storage.set(beacon_types_1.StorageKey.MATRIX_PEER_ROOM_IDS,roomIds)];case 3:_a.sent();_a.label=4;case 4:logger.log("getRelevantRoom","Using room ".concat(roomId));return[2,roomId]}})})};P2PCommunicationClient.prototype.getRelevantJoinedRoom=function(recipient){return __awaiter(this,void 0,void 0,function(){var joinedRooms,relevantRooms,room,roomId;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.client.promise];case 1:return[4,_a.sent().joinedRooms];case 2:joinedRooms=_a.sent();logger.log("checking joined rooms",joinedRooms,recipient);relevantRooms=joinedRooms.filter(function(roomElement){return!_this.ignoredRooms.some(function(id){return roomElement.id===id})}).filter(function(roomElement){return roomElement.members.some(function(member){return member===recipient})});if(!(relevantRooms.length===0||this.ignoredRooms.length>0))return[3,8];logger.log("getRelevantJoinedRoom","no relevant rooms found, creating new one");return[4,this.client.promise];case 3:return[4,_a.sent().createTrustedPrivateRoom(recipient)];case 4:roomId=_a.sent();return[4,this.client.promise];case 5:return[4,_a.sent().getRoomById(roomId)];case 6:room=_a.sent();logger.log("getRelevantJoinedRoom","waiting for other party to join room: ".concat(room.id));return[4,this.waitForJoin(roomId)];case 7:_a.sent();logger.log("getRelevantJoinedRoom","new room created and peer invited: ".concat(room.id));return[3,9];case 8:room=relevantRooms[0];logger.log("getRelevantJoinedRoom","channel already open, reusing room ".concat(room.id));_a.label=9;case 9:return[2,room]}})})};return P2PCommunicationClient}(beacon_core_1.CommunicationClient);exports.P2PCommunicationClient=P2PCommunicationClient}).call(this)}).call(this,require("buffer").Buffer)},{"../matrix-client/MatrixClient":134,"../matrix-client/models/MatrixClientEvent":138,"../matrix-client/models/MatrixMessage":139,"@airgap/beacon-core":113,"@airgap/beacon-types":145,"@airgap/beacon-utils":163,"@stablelib/blake2b":2,"@stablelib/ed25519":5,"@stablelib/utf8":17,axios:23,buffer:55}],132:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.P2PTransport=exports.P2PCommunicationClient=void 0;var P2PCommunicationClient_1=require("./communication-client/P2PCommunicationClient");Object.defineProperty(exports,"P2PCommunicationClient",{enumerable:true,get:function(){return P2PCommunicationClient_1.P2PCommunicationClient}});var P2PTransport_1=require("./P2PTransport");Object.defineProperty(exports,"P2PTransport",{enumerable:true,get:function(){return P2PTransport_1.P2PTransport}})},{"./P2PTransport":130,"./communication-client/P2PCommunicationClient":131}],133:[function(require,module,exports){"use strict";var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};Object.defineProperty(exports,"__esModule",{value:true});exports.EventEmitter=void 0;var EventEmitter=function(){function EventEmitter(){this.events={}}EventEmitter.prototype.on=function(event,listener){var _this=this;if(typeof this.events[event]!=="object"){this.events[event]=[]}this.events[event].push(listener);return function(){return _this.removeListener(event,listener)}};EventEmitter.prototype.removeListener=function(event,listener){if(typeof this.events[event]!=="object"){return}if(!listener){this.events[event]=[];return}var idx=this.events[event].indexOf(listener);if(idx>-1){this.events[event].splice(idx,1)}};EventEmitter.prototype.removeAllListeners=function(){var _this=this;Object.keys(this.events).forEach(function(event){return _this.events[event].splice(0,_this.events[event].length)})};EventEmitter.prototype.emit=function(event){var _this=this;var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}if(typeof this.events[event]!=="object"){return}__spreadArray([],this.events[event],true).forEach(function(listener){return listener.apply(_this,args)})};EventEmitter.prototype.once=function(event,listener){var _this=this;var remove=this.on(event,function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}remove();listener.apply(_this,args)});return remove};return EventEmitter}();exports.EventEmitter=EventEmitter},{}],134:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixClient=void 0;var beacon_core_1=require("@airgap/beacon-core");var beacon_utils_1=require("@airgap/beacon-utils");var MatrixClientStore_1=require("./MatrixClientStore");var MatrixHttpClient_1=require("./MatrixHttpClient");var MatrixRoom_1=require("./models/MatrixRoom");var MatrixRoomService_1=require("./services/MatrixRoomService");var MatrixUserService_1=require("./services/MatrixUserService");var MatrixEventService_1=require("./services/MatrixEventService");var MatrixClientEventEmitter_1=require("./MatrixClientEventEmitter");var logger=new beacon_core_1.Logger("MatrixClient");var IMMEDIATE_POLLING_RETRIES=3;var RETRY_INTERVAL=5e3;var MatrixClient=function(){function MatrixClient(store,eventEmitter,userService,roomService,eventService,httpClient){var _this=this;this.store=store;this.eventEmitter=eventEmitter;this.userService=userService;this.roomService=roomService;this.eventService=eventService;this.httpClient=httpClient;this.isActive=true;this._isReady=new beacon_utils_1.ExposedPromise;this.store.onStateChanged(function(oldState,newState,stateChange){_this.eventEmitter.onStateChanged(oldState,newState,stateChange)},"rooms")}MatrixClient.create=function(config){var store=new MatrixClientStore_1.MatrixClientStore(config.storage);var eventEmitter=new MatrixClientEventEmitter_1.MatrixClientEventEmitter;var httpClient=new MatrixHttpClient_1.MatrixHttpClient(config.baseUrl);var accountService=new MatrixUserService_1.MatrixUserService(httpClient);var roomService=new MatrixRoomService_1.MatrixRoomService(httpClient);var eventService=new MatrixEventService_1.MatrixEventService(httpClient);return new MatrixClient(store,eventEmitter,accountService,roomService,eventService,httpClient)};Object.defineProperty(MatrixClient.prototype,"joinedRooms",{get:function(){var _this=this;return new Promise(function(resolve){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();resolve(Object.values(this.store.get("rooms")).filter(function(room){return room.status===MatrixRoom_1.MatrixRoomStatus.JOINED}));return[2]}})})})},enumerable:false,configurable:true});Object.defineProperty(MatrixClient.prototype,"invitedRooms",{get:function(){var _this=this;return new Promise(function(resolve){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();resolve(Object.values(this.store.get("rooms")).filter(function(room){return room.status===MatrixRoom_1.MatrixRoomStatus.INVITED}));return[2]}})})})},enumerable:false,configurable:true});Object.defineProperty(MatrixClient.prototype,"leftRooms",{get:function(){var _this=this;return new Promise(function(resolve){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();resolve(Object.values(this.store.get("rooms")).filter(function(room){return room.status===MatrixRoom_1.MatrixRoomStatus.LEFT}));return[2]}})})})},enumerable:false,configurable:true});MatrixClient.prototype.start=function(user){return __awaiter(this,void 0,void 0,function(){var response,initialPollingResult;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.userService.login(user.id,user.password,user.deviceId)];case 1:response=_a.sent();return[4,this.store.update({accessToken:response.access_token})];case 2:_a.sent();initialPollingResult=new Promise(function(resolve,reject){return __awaiter(_this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.poll(0,function(pollingResponse){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:if(!this.store.get("isRunning")){resolve()}return[4,this.store.update({isRunning:true,syncToken:pollingResponse.next_batch,pollingTimeout:3e4,pollingRetries:0,rooms:MatrixRoom_1.MatrixRoom.fromSync(pollingResponse.rooms)})];case 1:_a.sent();return[2]}})})},function(error){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:if(!this.store.get("isRunning")){reject(error)}return[4,this.store.update({isRunning:false,pollingRetries:this.store.get("pollingRetries")+1})];case 1:_a.sent();return[2]}})})})];case 1:_a.sent();return[2]}})})});initialPollingResult.then(function(){_this._isReady.resolve()}).catch(console.error);return[2,initialPollingResult]}})})};MatrixClient.prototype.isConnected=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this._isReady.promise]})})};MatrixClient.prototype.stop=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){logger.log("MATRIX CLIENT STOPPED");this.isActive=false;this._isReady=new beacon_utils_1.ExposedPromise;return[2,this.httpClient.cancelAllRequests()]})})};MatrixClient.prototype.subscribe=function(event,listener){this.eventEmitter.on(event,listener)};MatrixClient.prototype.unsubscribe=function(event,listener){if(listener){this.eventEmitter.removeListener(event,listener)}};MatrixClient.prototype.unsubscribeAll=function(event){this.eventEmitter.removeListener(event)};MatrixClient.prototype.getRoomById=function(id){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();return[2,this.store.getRoom(id)]}})})};MatrixClient.prototype.createTrustedPrivateRoom=function(){var members=[];for(var _i=0;_i<arguments.length;_i++){members[_i]=arguments[_i]}return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();return[2,this.requiresAuthorization("createRoom",function(accessToken){return __awaiter(_this,void 0,void 0,function(){var response;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.roomService.createRoom(accessToken,{room_version:"5",invite:members,preset:"public_chat",is_direct:true})];case 1:response=_a.sent();return[2,response.room_id]}})})})]}})})};MatrixClient.prototype.inviteToRooms=function(user){var roomsOrIds=[];for(var _i=1;_i<arguments.length;_i++){roomsOrIds[_i-1]=arguments[_i]}return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();return[4,this.requiresAuthorization("invite",function(accessToken){return Promise.all(roomsOrIds.map(function(roomOrId){var room=_this.store.getRoom(roomOrId);_this.roomService.inviteToRoom(accessToken,user,room).catch(function(error){return logger.warn("inviteToRooms",error)})}))})];case 2:_a.sent();return[2]}})})};MatrixClient.prototype.joinRooms=function(){var roomsOrIds=[];for(var _i=0;_i<arguments.length;_i++){roomsOrIds[_i]=arguments[_i]}return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();return[4,this.requiresAuthorization("join",function(accessToken){return Promise.all(roomsOrIds.map(function(roomOrId){var room=_this.store.getRoom(roomOrId);return _this.roomService.joinRoom(accessToken,room)}))})];case 2:_a.sent();return[2]}})})};MatrixClient.prototype.sendTextMessage=function(roomId,message){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.isConnected()];case 1:_a.sent();return[4,this.requiresAuthorization("send",function(accessToken){return __awaiter(_this,void 0,void 0,function(){var txnId;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.createTxnId()];case 1:txnId=_a.sent();return[2,this.eventService.sendMessage(accessToken,roomId,{msgtype:"m.text",body:message},txnId)]}})})})];case 2:_a.sent();return[2]}})})};MatrixClient.prototype.poll=function(interval,onSyncSuccess,onSyncError){return __awaiter(this,void 0,void 0,function(){var store,sync,pollSync;var _this=this;return __generator(this,function(_a){store=this.store;sync=this.sync.bind(this);pollSync=function(resolve,reject){return __awaiter(_this,void 0,void 0,function(){var syncingRetries,response,error_1;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:syncingRetries=0;_a.label=1;case 1:_a.trys.push([1,3,4,5]);return[4,sync()];case 2:response=_a.sent();onSyncSuccess(response);return[3,5];case 3:error_1=_a.sent();onSyncError(error_1);syncingRetries=store.get("pollingRetries");if(this.isActive){logger.log("Retry syncing... ".concat(syncingRetries," retries so far"))}return[3,5];case 4:if(this.isActive){setTimeout(function(){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,pollSync(resolve,reject)];case 1:_a.sent();return[2]}})})},syncingRetries>IMMEDIATE_POLLING_RETRIES?RETRY_INTERVAL+interval:interval)}else{reject(new Error("Syncing stopped manually."))}return[7];case 5:return[2]}})})};return[2,new Promise(pollSync)]})})};MatrixClient.prototype.sync=function(){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,this.requiresAuthorization("sync",function(accessToken){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.eventService.sync(accessToken,{pollingTimeout:this.store.get("pollingTimeout"),syncToken:this.store.get("syncToken")})]})})})]})})};MatrixClient.prototype.requiresAuthorization=function(name,action){return __awaiter(this,void 0,void 0,function(){var storedToken;return __generator(this,function(_a){storedToken=this.store.get("accessToken");if(!storedToken){return[2,Promise.reject("".concat(name," requires authorization but no access token has been provided."))]}return[2,action(storedToken)]})})};MatrixClient.prototype.createTxnId=function(){return __awaiter(this,void 0,void 0,function(){var timestamp,counter;return __generator(this,function(_a){switch(_a.label){case 0:timestamp=(new Date).getTime();counter=this.store.get("txnNo");return[4,this.store.update({txnNo:counter+1})];case 1:_a.sent();return[2,"m".concat(timestamp,".").concat(counter)]}})})};return MatrixClient}();exports.MatrixClient=MatrixClient},{"./MatrixClientEventEmitter":135,"./MatrixClientStore":136,"./MatrixHttpClient":137,"./models/MatrixRoom":140,"./services/MatrixEventService":141,"./services/MatrixRoomService":142,"./services/MatrixUserService":143,"@airgap/beacon-core":113,"@airgap/beacon-utils":163}],135:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixClientEventEmitter=void 0;var EventEmitter_1=require("./EventEmitter");var beacon_utils_1=require("@airgap/beacon-utils");var MatrixRoom_1=require("./models/MatrixRoom");var MatrixClientEvent_1=require("./models/MatrixClientEvent");var MatrixClientEventEmitter=function(_super){__extends(MatrixClientEventEmitter,_super);function MatrixClientEventEmitter(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.eventEmitProviders=new Map([[MatrixClientEvent_1.MatrixClientEventType.INVITE,function(){return[_this.isInvite,_this.emitInvite.bind(_this)]}],[MatrixClientEvent_1.MatrixClientEventType.MESSAGE,function(){return[_this.isMessage,_this.emitMessage.bind(_this)]}]]);return _this}MatrixClientEventEmitter.prototype.onStateChanged=function(_oldState,_newState,stateChange){for(var _i=0,_a=(0,beacon_utils_1.keys)(MatrixClientEvent_1.MatrixClientEventType);_i<_a.length;_i++){var event_1=_a[_i];this.emitIfEvent(MatrixClientEvent_1.MatrixClientEventType[event_1],stateChange)}};MatrixClientEventEmitter.prototype.emitIfEvent=function(eventType,object){var provider=this.eventEmitProviders.get(eventType);if(provider){var _a=provider(),predicate=_a[0],emitter=_a[1];if(predicate(object)){emitter(eventType,object)}}};MatrixClientEventEmitter.prototype.emitClientEvent=function(eventType,content,timestamp){this.emit(eventType,{type:eventType,content:content,timestamp:timestamp})};MatrixClientEventEmitter.prototype.isInvite=function(stateChange){return stateChange.rooms?stateChange.rooms.some(function(room){return room.status===MatrixRoom_1.MatrixRoomStatus.INVITED}):false};MatrixClientEventEmitter.prototype.emitInvite=function(eventType,stateChange){var _this=this;stateChange.rooms.filter(function(room){return room.status===MatrixRoom_1.MatrixRoomStatus.INVITED}).map(function(room){return[room.id,room.members]}).forEach(function(_a){var id=_a[0],members=_a[1];_this.emitClientEvent(eventType,{roomId:id,members:members})})};MatrixClientEventEmitter.prototype.isMessage=function(stateChange){return stateChange.rooms?stateChange.rooms.some(function(room){return room.messages.length>0}):false};MatrixClientEventEmitter.prototype.emitMessage=function(eventType,stateChange){var _this=this;stateChange.rooms.filter(function(room){return room.messages.length>0}).map(function(room){return room.messages.map(function(message){return[room.id,message,message.timestamp]})}).reduce(function(flatten,toFlatten){return flatten.concat(toFlatten)},[]).forEach(function(_a){var roomId=_a[0],message=_a[1],timestamp=_a[2];_this.emitClientEvent(eventType,{roomId:roomId,message:message},timestamp)})};return MatrixClientEventEmitter}(EventEmitter_1.EventEmitter);exports.MatrixClientEventEmitter=MatrixClientEventEmitter},{"./EventEmitter":133,"./models/MatrixClientEvent":138,"./models/MatrixRoom":140,"@airgap/beacon-utils":163}],136:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixClientStore=void 0;var beacon_utils_1=require("@airgap/beacon-utils");var MatrixRoom_1=require("./models/MatrixRoom");var beacon_types_1=require("@airgap/beacon-types");var PRESERVED_FIELDS=["syncToken","rooms"];var MatrixClientStore=function(){function MatrixClientStore(storage){var _this=this;this.storage=storage;this.state={isRunning:false,userId:undefined,deviceId:undefined,txnNo:0,accessToken:undefined,syncToken:undefined,pollingTimeout:undefined,pollingRetries:0,rooms:{}};this.onStateChangedListeners=new Map;this.waitReadyPromise=new Promise(function(resolve,reject){return __awaiter(_this,void 0,void 0,function(){var error_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,this.initFromStorage()];case 1:_a.sent();resolve();return[3,3];case 2:error_1=_a.sent();reject(error_1);return[3,3];case 3:return[2]}})})})}MatrixClientStore.prototype.get=function(key){return this.state[key]};MatrixClientStore.prototype.getRoom=function(roomOrId){var room=MatrixRoom_1.MatrixRoom.from(roomOrId,MatrixRoom_1.MatrixRoomStatus.UNKNOWN);return this.state.rooms[room.id]||room};MatrixClientStore.prototype.update=function(stateUpdate){return __awaiter(this,void 0,void 0,function(){var oldState;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.waitReady()];case 1:_a.sent();oldState=Object.assign({},this.state);this.setState(stateUpdate);this.updateStorage(stateUpdate);this.notifyListeners(oldState,this.state,stateUpdate);return[2]}})})};MatrixClientStore.prototype.onStateChanged=function(listener){var _this=this;var subscribed=[];for(var _i=1;_i<arguments.length;_i++){subscribed[_i-1]=arguments[_i]}if(subscribed.length>0){subscribed.forEach(function(key){_this.onStateChangedListeners.set(key,listener)})}else{this.onStateChangedListeners.set("all",listener)}};MatrixClientStore.prototype.waitReady=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.waitReadyPromise]})})};MatrixClientStore.prototype.initFromStorage=function(){return __awaiter(this,void 0,void 0,function(){var preserved;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.storage.get(beacon_types_1.StorageKey.MATRIX_PRESERVED_STATE)];case 1:preserved=_a.sent();this.setState(preserved);return[2]}})})};MatrixClientStore.prototype.prepareData=function(toStore){var requiresPreparation=["rooms"];var toStoreCopy=requiresPreparation.some(function(key){return toStore[key]!==undefined})?JSON.parse(JSON.stringify(toStore)):toStore;Object.values(toStoreCopy.rooms||{}).forEach(function(room){room.messages=[]});return toStoreCopy};MatrixClientStore.prototype.updateStorage=function(stateUpdate){var _this=this;var updatedCachedFields=Object.entries(stateUpdate).filter(function(_a){var key=_a[0],value=_a[1];return PRESERVED_FIELDS.includes(key)&&Boolean(value)});if(updatedCachedFields.length>0){var filteredState_1={};PRESERVED_FIELDS.forEach(function(key){filteredState_1[key]=_this.state[key]});this.storage.set(beacon_types_1.StorageKey.MATRIX_PRESERVED_STATE,this.prepareData(filteredState_1))}};MatrixClientStore.prototype.setState=function(partialState){this.state={isRunning:partialState.isRunning||this.state.isRunning,userId:partialState.userId||this.state.userId,deviceId:partialState.deviceId||this.state.deviceId,txnNo:partialState.txnNo||this.state.txnNo,accessToken:partialState.accessToken||this.state.accessToken,syncToken:partialState.syncToken||this.state.syncToken,pollingTimeout:partialState.pollingTimeout||this.state.pollingTimeout,pollingRetries:partialState.pollingRetries||this.state.pollingRetries,rooms:this.mergeRooms(this.state.rooms,partialState.rooms)}};MatrixClientStore.prototype.mergeRooms=function(oldRooms,_newRooms){if(!_newRooms){return oldRooms}var newRooms=Array.isArray(_newRooms)?_newRooms:Object.values(_newRooms);var merged=Object.assign({},oldRooms);newRooms.forEach(function(newRoom){merged[newRoom.id]=MatrixRoom_1.MatrixRoom.merge(newRoom,oldRooms[newRoom.id])});return merged};MatrixClientStore.prototype.notifyListeners=function(oldState,newState,stateChange){var _this=this;var listenForAll=this.onStateChangedListeners.get("all");if(listenForAll){listenForAll(oldState,newState,stateChange)}(0,beacon_utils_1.keys)(stateChange).filter(function(key){return stateChange[key]!==undefined}).forEach(function(key){var listener=_this.onStateChangedListeners.get(key);if(listener){listener(oldState,newState,stateChange)}})};return MatrixClientStore}();exports.MatrixClientStore=MatrixClientStore},{"./models/MatrixRoom":140,"@airgap/beacon-types":145,"@airgap/beacon-utils":163}],137:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixHttpClient=void 0;var axios_1=require("axios");var beacon_utils_1=require("@airgap/beacon-utils");var beacon_core_1=require("@airgap/beacon-core");var logger=new beacon_core_1.Logger("MatrixHttpClient");var CLIENT_API_R0="/_matrix/client/r0";var MatrixHttpClient=function(){function MatrixHttpClient(baseUrl){this.baseUrl=baseUrl;this.cancelTokenSource=axios_1.default.CancelToken.source()}MatrixHttpClient.prototype.get=function(endpoint,params,options){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.send("GET",endpoint,options,params)]})})};MatrixHttpClient.prototype.post=function(endpoint,body,options,params){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.send("POST",endpoint,options,params,body)]})})};MatrixHttpClient.prototype.put=function(endpoint,body,options,params){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.send("PUT",endpoint,options,params,body)]})})};MatrixHttpClient.prototype.cancelAllRequests=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.cancelTokenSource.cancel("Manually cancelled")]})})};MatrixHttpClient.prototype.send=function(method,endpoint,config,requestParams,data){return __awaiter(this,void 0,void 0,function(){var headers,params,response,error_1,axiosError;return __generator(this,function(_a){switch(_a.label){case 0:headers=config?this.getHeaders(config):undefined;params=requestParams?this.getParams(requestParams):undefined;_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,axios_1.default.request({method:method,url:endpoint,baseURL:this.apiUrl(CLIENT_API_R0),headers:headers,data:data,params:params,cancelToken:this.cancelTokenSource.token})];case 2:response=_a.sent();return[3,4];case 3:error_1=_a.sent();axiosError=error_1;logger.error("send",axiosError.code,axiosError.message,axiosError.response.data);throw error_1.response.data;case 4:return[2,response.data]}})})};MatrixHttpClient.prototype.getHeaders=function(options){var headers={};var entries=[];if(options.accessToken){entries.push(["Authorization","Bearer ".concat(options.accessToken)])}if(entries.length===0){return undefined}for(var _i=0,entries_1=entries;_i<entries_1.length;_i++){var _a=entries_1[_i],key=_a[0],value=_a[1];headers[key]=value}return headers};MatrixHttpClient.prototype.getParams=function(_params){if(!_params){return undefined}var params=Object.assign(_params,{});(0,beacon_utils_1.keys)(params).forEach(function(key){return params[key]===undefined&&delete params[key]});return params};MatrixHttpClient.prototype.apiUrl=function(){var parts=[];for(var _i=0;_i<arguments.length;_i++){parts[_i]=arguments[_i]}var apiBase=this.baseUrl.endsWith("/")?this.baseUrl.substr(0,this.baseUrl.length-1):this.baseUrl;var apiParts=parts.map(function(path){return path.startsWith("/")?path.substr(1):path});return __spreadArray([apiBase],apiParts,true).join("/")};return MatrixHttpClient}();exports.MatrixHttpClient=MatrixHttpClient},{"@airgap/beacon-core":113,"@airgap/beacon-utils":163,axios:23}],138:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixClientEventType=void 0;var MatrixClientEventType;(function(MatrixClientEventType){MatrixClientEventType["INVITE"]="invite";MatrixClientEventType["MESSAGE"]="message"})(MatrixClientEventType=exports.MatrixClientEventType||(exports.MatrixClientEventType={}))},{}],139:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixMessage=exports.MatrixMessageType=void 0;var events_1=require("../utils/events");var MatrixMessageType;(function(MatrixMessageType){MatrixMessageType["TEXT"]="m.text"})(MatrixMessageType=exports.MatrixMessageType||(exports.MatrixMessageType={}));var MatrixMessage=function(){function MatrixMessage(type,sender,content,timestamp){this.type=type;this.sender=sender;this.content=content;this.timestamp=timestamp}MatrixMessage.from=function(event){if((0,events_1.isTextMessageEvent)(event)){return new MatrixMessage(event.content.msgtype,event.sender,event.content.body,event.origin_server_ts)}return undefined};return MatrixMessage}();exports.MatrixMessage=MatrixMessage},{"../utils/events":144}],140:[function(require,module,exports){"use strict";var __spreadArray=this&&this.__spreadArray||function(to,from,pack){if(pack||arguments.length===2)for(var i=0,l=from.length,ar;i<l;i++){if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))};Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixRoom=exports.MatrixRoomStatus=void 0;var events_1=require("../utils/events");var MatrixMessage_1=require("./MatrixMessage");var MatrixRoomStatus;(function(MatrixRoomStatus){MatrixRoomStatus[MatrixRoomStatus["UNKNOWN"]=0]="UNKNOWN";MatrixRoomStatus[MatrixRoomStatus["JOINED"]=1]="JOINED";MatrixRoomStatus[MatrixRoomStatus["INVITED"]=2]="INVITED";MatrixRoomStatus[MatrixRoomStatus["LEFT"]=3]="LEFT"})(MatrixRoomStatus=exports.MatrixRoomStatus||(exports.MatrixRoomStatus={}));var MatrixRoom=function(){function MatrixRoom(id,status,members,messages){if(status===void 0){status=MatrixRoomStatus.UNKNOWN}if(members===void 0){members=[]}if(messages===void 0){messages=[]}this.id=id;this.status=status;this.members=members;this.messages=messages}MatrixRoom.fromSync=function(roomSync){var _a,_b,_c;if(!roomSync){return[]}function create(rooms,creator){return Object.entries(rooms).map(function(_a){var id=_a[0],room=_a[1];return creator(id,room)})}return __spreadArray(__spreadArray(__spreadArray([],create((_a=roomSync.join)!==null&&_a!==void 0?_a:{},MatrixRoom.fromJoined),true),create((_b=roomSync.invite)!==null&&_b!==void 0?_b:{},MatrixRoom.fromInvited),true),create((_c=roomSync.leave)!==null&&_c!==void 0?_c:{},MatrixRoom.fromLeft),true)};MatrixRoom.from=function(roomOrId,status){return typeof roomOrId==="string"?new MatrixRoom(roomOrId,status||MatrixRoomStatus.UNKNOWN):status!==undefined?new MatrixRoom(roomOrId.id,status,roomOrId.members,roomOrId.messages):roomOrId};MatrixRoom.merge=function(newState,previousState){if(!previousState||previousState.id!==newState.id){return MatrixRoom.from(newState)}return new MatrixRoom(newState.id,newState.status,__spreadArray(__spreadArray([],previousState.members,true),newState.members,true).filter(function(member,index,array){return array.indexOf(member)===index}),__spreadArray(__spreadArray([],previousState.messages,true),newState.messages,true))};MatrixRoom.fromJoined=function(id,joined){var events=__spreadArray(__spreadArray([],joined.state.events,true),joined.timeline.events,true);var members=MatrixRoom.getMembersFromEvents(events);var messages=MatrixRoom.getMessagesFromEvents(events);return new MatrixRoom(id,MatrixRoomStatus.JOINED,members,messages)};MatrixRoom.fromInvited=function(id,invited){var members=MatrixRoom.getMembersFromEvents(invited.invite_state.events);return new MatrixRoom(id,MatrixRoomStatus.INVITED,members)};MatrixRoom.fromLeft=function(id,left){var events=__spreadArray(__spreadArray([],left.state.events,true),left.timeline.events,true);var members=MatrixRoom.getMembersFromEvents(events);var messages=MatrixRoom.getMessagesFromEvents(events);return new MatrixRoom(id,MatrixRoomStatus.LEFT,members,messages)};MatrixRoom.getMembersFromEvents=function(events){return MatrixRoom.getUniqueEvents(events.filter(function(event){return(0,events_1.isCreateEvent)(event)||(0,events_1.isJoinEvent)(event)})).map(function(event){return event.sender}).filter(function(member,index,array){return array.indexOf(member)===index})};MatrixRoom.getMessagesFromEvents=function(events){return MatrixRoom.getUniqueEvents(events.filter(events_1.isMessageEvent)).map(function(event){return MatrixMessage_1.MatrixMessage.from(event)}).filter(Boolean)};MatrixRoom.getUniqueEvents=function(events){var eventIds={};var uniqueEvents=[];events.forEach(function(event,index){var eventId=event.event_id;if(eventId===undefined||!(eventId in eventIds)){if(eventId!==undefined){eventIds[eventId]=index}uniqueEvents.push(event)}});return uniqueEvents};return MatrixRoom}();exports.MatrixRoom=MatrixRoom},{"../utils/events":144,"./MatrixMessage":139}],141:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixEventService=void 0;var MatrixEventService=function(){function MatrixEventService(httpClient){this.httpClient=httpClient;this.cachedPromises=new Map}MatrixEventService.prototype.sync=function(accessToken,options){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,this.withCache("sync",function(){return _this.httpClient.get("/sync",{timeout:options?options.pollingTimeout:undefined,since:options?options.syncToken:undefined},{accessToken:accessToken})})]})})};MatrixEventService.prototype.sendMessage=function(accessToken,roomId,content,txnId){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){return[2,new Promise(function(resolve,reject){return _this.scheduleEvent({accessToken:accessToken,roomId:roomId,type:"m.room.message",content:content,txnId:txnId,onSuccess:resolve,onError:reject})})]})})};MatrixEventService.prototype.scheduleEvent=function(event){this.sendEvent(event)};MatrixEventService.prototype.sendEvent=function(scheduledEvent){return __awaiter(this,void 0,void 0,function(){var roomId,type,txnId,content,accessToken,response,error_1;return __generator(this,function(_a){switch(_a.label){case 0:roomId=scheduledEvent.roomId,type=scheduledEvent.type,txnId=scheduledEvent.txnId,content=scheduledEvent.content,accessToken=scheduledEvent.accessToken;_a.label=1;case 1:_a.trys.push([1,3,,4]);return[4,this.httpClient.put("/rooms/".concat(encodeURIComponent(roomId),"/send/").concat(type,"/").concat(encodeURIComponent(txnId)),content,{accessToken:accessToken})];case 2:response=_a.sent();scheduledEvent.onSuccess(response);return[3,4];case 3:error_1=_a.sent();scheduledEvent.onError(error_1);return[3,4];case 4:return[2]}})})};MatrixEventService.prototype.withCache=function(key,promiseProvider){var _this=this;var promise=this.cachedPromises.get(key);if(!promise){promise=promiseProvider().finally(function(){_this.cachedPromises.delete(key)});this.cachedPromises.set(key,promise)}return promise};return MatrixEventService}();exports.MatrixEventService=MatrixEventService},{}],142:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixRoomService=void 0;var MatrixRoom_1=require("../models/MatrixRoom");var MatrixRoomService=function(){function MatrixRoomService(httpClient){this.httpClient=httpClient}MatrixRoomService.prototype.createRoom=function(accessToken,config){if(config===void 0){config={}}return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.httpClient.post("/createRoom",config,{accessToken:accessToken})]})})};MatrixRoomService.prototype.inviteToRoom=function(accessToken,user,room){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(room.status!==MatrixRoom_1.MatrixRoomStatus.JOINED&&room.status!==MatrixRoom_1.MatrixRoomStatus.UNKNOWN){return[2,Promise.reject("User is not a member of room ".concat(room.id,"."))]}return[2,this.httpClient.post("/rooms/".concat(encodeURIComponent(room.id),"/invite"),{user_id:user},{accessToken:accessToken})]})})};MatrixRoomService.prototype.joinRoom=function(accessToken,room){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(room.status===MatrixRoom_1.MatrixRoomStatus.JOINED){return[2,Promise.resolve({room_id:room.id})]}return[2,this.httpClient.post("/rooms/".concat(encodeURIComponent(room.id),"/join"),{},{accessToken:accessToken})]})})};MatrixRoomService.prototype.getJoinedRooms=function(accessToken){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.httpClient.get("/joined_rooms",undefined,{accessToken:accessToken})]})})};return MatrixRoomService}();exports.MatrixRoomService=MatrixRoomService},{"../models/MatrixRoom":140}],143:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.MatrixUserService=void 0;var MatrixUserService=function(){function MatrixUserService(httpClient){this.httpClient=httpClient}MatrixUserService.prototype.login=function(user,password,deviceId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.httpClient.post("/login",{type:"m.login.password",identifier:{type:"m.id.user",user:user},password:password,device_id:deviceId})]})})};return MatrixUserService}();exports.MatrixUserService=MatrixUserService},{}],144:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isTextMessageEvent=exports.isMessageEvent=exports.isJoinEvent=exports.isCreateEvent=void 0;var MatrixMessage_1=require("../models/MatrixMessage");var isCreateEvent=function(event){return event.type==="m.room.create"&&event.content instanceof Object&&"creator"in event.content};exports.isCreateEvent=isCreateEvent;var isJoinEvent=function(event){return event.type==="m.room.member"&&event.content instanceof Object&&"membership"in event.content&&event.content["membership"]==="join"};exports.isJoinEvent=isJoinEvent;var isMessageEvent=function(event){return event.type==="m.room.message"};exports.isMessageEvent=isMessageEvent;var isTextMessageEvent=function(event){return(0,exports.isMessageEvent)(event)&&event.content instanceof Object&&"msgtype"in event.content&&event.content["msgtype"]===MatrixMessage_1.MatrixMessageType.TEXT};exports.isTextMessageEvent=isTextMessageEvent},{"../models/MatrixMessage":139}],145:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});exports.ColorMode=exports.defaultValues=exports.StorageKey=exports.Storage=exports.TransportType=exports.TransportStatus=exports.BeaconErrorType=exports.ExtensionMessageTarget=exports.SigningType=exports.Origin=exports.PermissionScope=exports.BeaconMessageType=exports.NetworkType=exports.TezosOperationType=void 0;var BeaconMessageType_1=require("./types/beacon/BeaconMessageType");Object.defineProperty(exports,"BeaconMessageType",{enumerable:true,get:function(){return BeaconMessageType_1.BeaconMessageType}});var PermissionScope_1=require("./types/beacon/PermissionScope");Object.defineProperty(exports,"PermissionScope",{enumerable:true,get:function(){return PermissionScope_1.PermissionScope}});var NetworkType_1=require("./types/beacon/NetworkType");Object.defineProperty(exports,"NetworkType",{enumerable:true,get:function(){return NetworkType_1.NetworkType}});var OperationTypes_1=require("./types/tezos/OperationTypes");Object.defineProperty(exports,"TezosOperationType",{enumerable:true,get:function(){return OperationTypes_1.TezosOperationType}});var Origin_1=require("./types/Origin");Object.defineProperty(exports,"Origin",{enumerable:true,get:function(){return Origin_1.Origin}});var ExtensionMessageTarget_1=require("./types/ExtensionMessageTarget");Object.defineProperty(exports,"ExtensionMessageTarget",{enumerable:true,get:function(){return ExtensionMessageTarget_1.ExtensionMessageTarget}});var BeaconErrorType_1=require("./types/BeaconErrorType");Object.defineProperty(exports,"BeaconErrorType",{enumerable:true,get:function(){return BeaconErrorType_1.BeaconErrorType}});var TransportStatus_1=require("./types/transport/TransportStatus");Object.defineProperty(exports,"TransportStatus",{enumerable:true,get:function(){return TransportStatus_1.TransportStatus}});var TransportType_1=require("./types/transport/TransportType");Object.defineProperty(exports,"TransportType",{enumerable:true,get:function(){return TransportType_1.TransportType}});var Storage_1=require("./types/storage/Storage");Object.defineProperty(exports,"Storage",{enumerable:true,get:function(){return Storage_1.Storage}});var StorageKey_1=require("./types/storage/StorageKey");Object.defineProperty(exports,"StorageKey",{enumerable:true,get:function(){return StorageKey_1.StorageKey}});var StorageKeyReturnDefaults_1=require("./types/storage/StorageKeyReturnDefaults");Object.defineProperty(exports,"defaultValues",{enumerable:true,get:function(){return StorageKeyReturnDefaults_1.defaultValues}});var SigningType_1=require("./types/beacon/SigningType");Object.defineProperty(exports,"SigningType",{enumerable:true,get:function(){return SigningType_1.SigningType}});var ColorMode_1=require("./types/ColorMode");Object.defineProperty(exports,"ColorMode",{enumerable:true,get:function(){return ColorMode_1.ColorMode}});__exportStar(require("./types/beaconV3/PermissionRequest"),exports);__exportStar(require("./types/ui"),exports);__exportStar(require("./types/Regions"),exports)},{"./types/BeaconErrorType":146,"./types/ColorMode":147,"./types/ExtensionMessageTarget":148,"./types/Origin":149,"./types/Regions":150,"./types/beacon/BeaconMessageType":151,"./types/beacon/NetworkType":152,"./types/beacon/PermissionScope":153,"./types/beacon/SigningType":154,"./types/beaconV3/PermissionRequest":155,"./types/storage/Storage":156,"./types/storage/StorageKey":157,"./types/storage/StorageKeyReturnDefaults":158,"./types/tezos/OperationTypes":159,"./types/transport/TransportStatus":160,"./types/transport/TransportType":161,"./types/ui":162}],146:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BeaconErrorType=void 0;var BeaconErrorType;(function(BeaconErrorType){BeaconErrorType["BROADCAST_ERROR"]="BROADCAST_ERROR";BeaconErrorType["NETWORK_NOT_SUPPORTED"]="NETWORK_NOT_SUPPORTED";BeaconErrorType["NO_ADDRESS_ERROR"]="NO_ADDRESS_ERROR";BeaconErrorType["NO_PRIVATE_KEY_FOUND_ERROR"]="NO_PRIVATE_KEY_FOUND_ERROR";BeaconErrorType["NOT_GRANTED_ERROR"]="NOT_GRANTED_ERROR";BeaconErrorType["PARAMETERS_INVALID_ERROR"]="PARAMETERS_INVALID_ERROR";BeaconErrorType["TOO_MANY_OPERATIONS"]="TOO_MANY_OPERATIONS";BeaconErrorType["TRANSACTION_INVALID_ERROR"]="TRANSACTION_INVALID_ERROR";BeaconErrorType["SIGNATURE_TYPE_NOT_SUPPORTED"]="SIGNATURE_TYPE_NOT_SUPPORTED";BeaconErrorType["ABORTED_ERROR"]="ABORTED_ERROR";BeaconErrorType["UNKNOWN_ERROR"]="UNKNOWN_ERROR"})(BeaconErrorType=exports.BeaconErrorType||(exports.BeaconErrorType={}))},{}],147:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ColorMode=void 0;var ColorMode;(function(ColorMode){ColorMode["LIGHT"]="light";ColorMode["DARK"]="dark"})(ColorMode=exports.ColorMode||(exports.ColorMode={}))},{}],148:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExtensionMessageTarget=void 0;var ExtensionMessageTarget;(function(ExtensionMessageTarget){ExtensionMessageTarget["BACKGROUND"]="toBackground";ExtensionMessageTarget["PAGE"]="toPage";ExtensionMessageTarget["EXTENSION"]="toExtension"})(ExtensionMessageTarget=exports.ExtensionMessageTarget||(exports.ExtensionMessageTarget={}))},{}],149:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Origin=void 0;var Origin;(function(Origin){Origin["WEBSITE"]="website";Origin["EXTENSION"]="extension";Origin["P2P"]="p2p"})(Origin=exports.Origin||(exports.Origin={}))},{}],150:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Regions=void 0;var Regions;(function(Regions){Regions["EUROPE_EAST"]="europe-east";Regions["EUROPE_WEST"]="europe-west";Regions["NORTH_AMERICA_EAST"]="north-america-east";Regions["NORTH_AMERICA_WEST"]="north-america-west";Regions["CENTRAL_AMERICA"]="central-america";Regions["SOUTH_AMERICA"]="south-america";Regions["ASIA_EAST"]="asia-east";Regions["ASIA_WEST"]="asia-west";Regions["AFRICA"]="africa";Regions["AUSTRALIA"]="australia"})(Regions=exports.Regions||(exports.Regions={}))},{}],151:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BeaconMessageType=void 0;var BeaconMessageType;(function(BeaconMessageType){BeaconMessageType["BlockchainRequest"]="blockchain_request";BeaconMessageType["PermissionRequest"]="permission_request";BeaconMessageType["SignPayloadRequest"]="sign_payload_request";BeaconMessageType["OperationRequest"]="operation_request";BeaconMessageType["BroadcastRequest"]="broadcast_request";BeaconMessageType["BlockchainResponse"]="blockchain_response";BeaconMessageType["PermissionResponse"]="permission_response";BeaconMessageType["SignPayloadResponse"]="sign_payload_response";BeaconMessageType["OperationResponse"]="operation_response";BeaconMessageType["BroadcastResponse"]="broadcast_response";BeaconMessageType["Acknowledge"]="acknowledge";BeaconMessageType["Disconnect"]="disconnect";BeaconMessageType["Error"]="error"})(BeaconMessageType=exports.BeaconMessageType||(exports.BeaconMessageType={}))},{}],152:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NetworkType=void 0;var NetworkType;(function(NetworkType){NetworkType["MAINNET"]="mainnet";NetworkType["GHOSTNET"]="ghostnet";NetworkType["MONDAYNET"]="mondaynet";NetworkType["DAILYNET"]="dailynet";NetworkType["DELPHINET"]="delphinet";NetworkType["EDONET"]="edonet";NetworkType["FLORENCENET"]="florencenet";NetworkType["GRANADANET"]="granadanet";NetworkType["HANGZHOUNET"]="hangzhounet";NetworkType["ITHACANET"]="ithacanet";NetworkType["JAKARTANET"]="jakartanet";NetworkType["KATHMANDUNET"]="kathmandunet";NetworkType["LIMANET"]="limanet";NetworkType["MUMBAINET"]="mumbainet";NetworkType["CUSTOM"]="custom"})(NetworkType=exports.NetworkType||(exports.NetworkType={}))},{}],153:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PermissionScope=void 0;var PermissionScope;(function(PermissionScope){PermissionScope["SIGN"]="sign";PermissionScope["OPERATION_REQUEST"]="operation_request";PermissionScope["ENCRYPT"]="encrypt";PermissionScope["NOTIFICATION"]="notification";PermissionScope["THRESHOLD"]="threshold"})(PermissionScope=exports.PermissionScope||(exports.PermissionScope={}))},{}],154:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SigningType=void 0;var SigningType;(function(SigningType){SigningType["RAW"]="raw";SigningType["OPERATION"]="operation";SigningType["MICHELINE"]="micheline"})(SigningType=exports.SigningType||(exports.SigningType={}))},{}],155:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true})},{}],156:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Storage=void 0;var Storage=function(){function Storage(){}Storage.isSupported=function(){return Promise.resolve(false)};return Storage}();exports.Storage=Storage},{}],157:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StorageKey=void 0;var StorageKey;(function(StorageKey){StorageKey["TRANSPORT_P2P_PEERS_DAPP"]="beacon:communication-peers-dapp";StorageKey["TRANSPORT_P2P_PEERS_WALLET"]="beacon:communication-peers-wallet";StorageKey["TRANSPORT_POSTMESSAGE_PEERS_DAPP"]="beacon:postmessage-peers-dapp";StorageKey["TRANSPORT_POSTMESSAGE_PEERS_WALLET"]="beacon:postmessage-peers-wallet";StorageKey["ACCOUNTS"]="beacon:accounts";StorageKey["ACTIVE_ACCOUNT"]="beacon:active-account";StorageKey["PUSH_TOKENS"]="beacon:push-tokens";StorageKey["BEACON_SDK_SECRET_SEED"]="beacon:sdk-secret-seed";StorageKey["APP_METADATA_LIST"]="beacon:app-metadata-list";StorageKey["PERMISSION_LIST"]="beacon:permissions";StorageKey["BEACON_SDK_VERSION"]="beacon:sdk_version";StorageKey["MATRIX_PRESERVED_STATE"]="beacon:sdk-matrix-preserved-state";StorageKey["MATRIX_PEER_ROOM_IDS"]="beacon:matrix-peer-rooms";StorageKey["MATRIX_SELECTED_NODE"]="beacon:matrix-selected-node";StorageKey["MULTI_NODE_SETUP_DONE"]="beacon:multi-node-setup"})(StorageKey=exports.StorageKey||(exports.StorageKey={}))},{}],158:[function(require,module,exports){"use strict";var _a;Object.defineProperty(exports,"__esModule",{value:true});exports.defaultValues=void 0;var __1=require("../..");exports.defaultValues=(_a={},_a[__1.StorageKey.TRANSPORT_P2P_PEERS_DAPP]=[],_a[__1.StorageKey.TRANSPORT_P2P_PEERS_WALLET]=[],_a[__1.StorageKey.TRANSPORT_POSTMESSAGE_PEERS_DAPP]=[],_a[__1.StorageKey.TRANSPORT_POSTMESSAGE_PEERS_WALLET]=[],_a[__1.StorageKey.ACCOUNTS]=[],_a[__1.StorageKey.ACTIVE_ACCOUNT]=undefined,_a[__1.StorageKey.PUSH_TOKENS]=[],_a[__1.StorageKey.BEACON_SDK_SECRET_SEED]=undefined,_a[__1.StorageKey.APP_METADATA_LIST]=[],_a[__1.StorageKey.PERMISSION_LIST]=[],_a[__1.StorageKey.BEACON_SDK_VERSION]=undefined,_a[__1.StorageKey.MATRIX_PRESERVED_STATE]={},_a[__1.StorageKey.MATRIX_PEER_ROOM_IDS]={},_a[__1.StorageKey.MATRIX_SELECTED_NODE]=undefined,_a[__1.StorageKey.MULTI_NODE_SETUP_DONE]=undefined,_a)},{"../..":145}],159:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TezosOperationType=void 0;var TezosOperationType;(function(TezosOperationType){TezosOperationType["ENDORSEMENT"]="endorsement";TezosOperationType["SEED_NONCE_REVELATION"]="seed_nonce_revelation";TezosOperationType["DOUBLE_ENDORSEMENT_EVIDENCE"]="double_endorsement_evidence";TezosOperationType["DOUBLE_BAKING_EVIDENCE"]="double_baking_evidence";TezosOperationType["ACTIVATE_ACCOUNT"]="activate_account";TezosOperationType["PROPOSALS"]="proposals";TezosOperationType["BALLOT"]="ballot";TezosOperationType["REVEAL"]="reveal";TezosOperationType["TRANSACTION"]="transaction";TezosOperationType["ORIGINATION"]="origination";TezosOperationType["DELEGATION"]="delegation"})(TezosOperationType=exports.TezosOperationType||(exports.TezosOperationType={}))},{}],160:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TransportStatus=void 0;var TransportStatus;(function(TransportStatus){TransportStatus["NOT_CONNECTED"]="NOT_CONNECTED";TransportStatus["CONNECTING"]="CONNECTING";TransportStatus["CONNECTED"]="CONNECTED"})(TransportStatus=exports.TransportStatus||(exports.TransportStatus={}))},{}],161:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TransportType=void 0;var TransportType;(function(TransportType){TransportType["CHROME_MESSAGE"]="chrome_message";TransportType["POST_MESSAGE"]="post_message";TransportType["LEDGER"]="ledger";TransportType["P2P"]="p2p"})(TransportType=exports.TransportType||(exports.TransportType={}))},{}],162:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var NetworkType_1=require("./beacon/NetworkType")},{"./beacon/NetworkType":152}],163:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.secretbox_MACBYTES=exports.secretbox_NONCEBYTES=exports.generateGUID=exports.signMessage=exports.recipientString=exports.openCryptobox=exports.sealCryptobox=exports.getHexHash=exports.encryptCryptoboxPayload=exports.decryptCryptoboxPayload=exports.getAddressFromPublicKey=exports.toHex=exports.getKeypairFromSeed=exports.ExposedPromiseStatus=exports.ExposedPromise=exports.keys=void 0;var keys_1=require("./utils/keys");Object.defineProperty(exports,"keys",{enumerable:true,get:function(){return keys_1.keys}});var exposed_promise_1=require("./utils/exposed-promise");Object.defineProperty(exports,"ExposedPromise",{enumerable:true,get:function(){return exposed_promise_1.ExposedPromise}});Object.defineProperty(exports,"ExposedPromiseStatus",{enumerable:true,get:function(){return exposed_promise_1.ExposedPromiseStatus}});var crypto_1=require("./utils/crypto");Object.defineProperty(exports,"getKeypairFromSeed",{enumerable:true,get:function(){return crypto_1.getKeypairFromSeed}});Object.defineProperty(exports,"toHex",{enumerable:true,get:function(){return crypto_1.toHex}});Object.defineProperty(exports,"getAddressFromPublicKey",{enumerable:true,get:function(){return crypto_1.getAddressFromPublicKey}});Object.defineProperty(exports,"decryptCryptoboxPayload",{enumerable:true,get:function(){return crypto_1.decryptCryptoboxPayload}});Object.defineProperty(exports,"encryptCryptoboxPayload",{enumerable:true,get:function(){return crypto_1.encryptCryptoboxPayload}});Object.defineProperty(exports,"getHexHash",{enumerable:true,get:function(){return crypto_1.getHexHash}});Object.defineProperty(exports,"sealCryptobox",{enumerable:true,get:function(){return crypto_1.sealCryptobox}});Object.defineProperty(exports,"openCryptobox",{enumerable:true,get:function(){return crypto_1.openCryptobox}});Object.defineProperty(exports,"recipientString",{enumerable:true,get:function(){return crypto_1.recipientString}});Object.defineProperty(exports,"signMessage",{enumerable:true,get:function(){return crypto_1.signMessage}});var generate_uuid_1=require("./utils/generate-uuid");Object.defineProperty(exports,"generateGUID",{enumerable:true,get:function(){return generate_uuid_1.generateGUID}});exports.secretbox_NONCEBYTES=24;exports.secretbox_MACBYTES=16},{"./utils/crypto":164,"./utils/exposed-promise":165,"./utils/generate-uuid":166,"./utils/keys":167}],164:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.signMessage=exports.recipientString=exports.getAddressFromPublicKey=exports.openCryptobox=exports.sealCryptobox=exports.decryptCryptoboxPayload=exports.encryptCryptoboxPayload=exports.getKeypairFromSeed=exports.getHexHash=exports.toHex=exports.secretbox_MACBYTES=exports.secretbox_NONCEBYTES=void 0;var bs58check=require("bs58check");var nacl_1=require("@stablelib/nacl");var random_1=require("@stablelib/random");var utf8_1=require("@stablelib/utf8");var blake2b_1=require("@stablelib/blake2b");var ed25519_1=require("@stablelib/ed25519");var ed25519_2=require("@stablelib/ed25519");var blake2b_2=require("@stablelib/blake2b");var bytes_1=require("@stablelib/bytes");var ed25519_3=require("@stablelib/ed25519");exports.secretbox_NONCEBYTES=24;exports.secretbox_MACBYTES=16;function toHex(value){return Buffer.from(value).toString("hex")}exports.toHex=toHex;function getHexHash(key){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(typeof key==="string"){return[2,toHex((0,blake2b_1.hash)((0,utf8_1.encode)(key),32))]}return[2,toHex((0,blake2b_1.hash)(key,32))]})})}exports.getHexHash=getHexHash;function getKeypairFromSeed(seed){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,(0,ed25519_1.generateKeyPairFromSeed)((0,blake2b_1.hash)((0,utf8_1.encode)(seed),32))]})})}exports.getKeypairFromSeed=getKeypairFromSeed;function encryptCryptoboxPayload(message,sharedKey){return __awaiter(this,void 0,void 0,function(){var nonce,combinedPayload;return __generator(this,function(_a){nonce=Buffer.from((0,random_1.randomBytes)(exports.secretbox_NONCEBYTES));combinedPayload=Buffer.concat([nonce,Buffer.from((0,nacl_1.secretBox)(sharedKey,nonce,Buffer.from(message,"utf8")))]);return[2,toHex(combinedPayload)]})})}exports.encryptCryptoboxPayload=encryptCryptoboxPayload;function decryptCryptoboxPayload(payload,sharedKey){return __awaiter(this,void 0,void 0,function(){var nonce,ciphertext,openBox;return __generator(this,function(_a){nonce=payload.slice(0,exports.secretbox_NONCEBYTES);ciphertext=payload.slice(exports.secretbox_NONCEBYTES);openBox=(0,nacl_1.openSecretBox)(sharedKey,nonce,ciphertext);if(!openBox){throw new Error("Decryption failed")}return[2,Buffer.from(openBox).toString("utf8")]})})}exports.decryptCryptoboxPayload=decryptCryptoboxPayload;function sealCryptobox(payload,otherPublicKey){return __awaiter(this,void 0,void 0,function(){var kxOtherPublicKey,keypair,state,nonce,bytesPayload,encryptedMessage;return __generator(this,function(_a){kxOtherPublicKey=(0,ed25519_2.convertPublicKeyToX25519)(Buffer.from(otherPublicKey));keypair=(0,nacl_1.generateKeyPair)();state=new blake2b_2.BLAKE2b(24);nonce=state.update(keypair.publicKey,32).update(kxOtherPublicKey,32).digest();bytesPayload=typeof payload==="string"?(0,utf8_1.encode)(payload):payload;encryptedMessage=(0,nacl_1.box)(kxOtherPublicKey,keypair.secretKey,nonce,bytesPayload);return[2,toHex((0,bytes_1.concat)(keypair.publicKey,encryptedMessage))]})})}exports.sealCryptobox=sealCryptobox;function openCryptobox(encryptedPayload,publicKey,privateKey){return __awaiter(this,void 0,void 0,function(){var kxSelfPrivateKey,kxSelfPublicKey,bytesPayload,epk,ciphertext,state,nonce,decryptedMessage2;return __generator(this,function(_a){kxSelfPrivateKey=(0,ed25519_2.convertSecretKeyToX25519)(Buffer.from(privateKey));kxSelfPublicKey=(0,ed25519_2.convertPublicKeyToX25519)(Buffer.from(publicKey));bytesPayload=typeof encryptedPayload==="string"?(0,utf8_1.encode)(encryptedPayload):encryptedPayload;epk=bytesPayload.slice(0,32);ciphertext=bytesPayload.slice(32);state=new blake2b_2.BLAKE2b(24);nonce=state.update(epk,32).update(kxSelfPublicKey,32).digest();decryptedMessage2=(0,nacl_1.openBox)(epk,kxSelfPrivateKey,nonce,ciphertext);if(!decryptedMessage2){throw new Error("Decryption failed")}return[2,Buffer.from(decryptedMessage2).toString()]})})}exports.openCryptobox=openCryptobox;function getAddressFromPublicKey(publicKey){return __awaiter(this,void 0,void 0,function(){var prefixes,prefix,plainPublicKey,entries,index,_a,key,value,decoded,payload;return __generator(this,function(_b){prefixes={edpk:{length:54,prefix:Buffer.from(new Uint8Array([6,161,159]))},sppk:{length:55,prefix:Buffer.from(new Uint8Array([6,161,161]))},p2pk:{length:55,prefix:Buffer.from(new Uint8Array([6,161,164]))}};if(publicKey.length===64){prefix=prefixes.edpk.prefix;plainPublicKey=publicKey}else{entries=Object.entries(prefixes);for(index=0;index<entries.length;index++){_a=entries[index],key=_a[0],value=_a[1];if(publicKey.startsWith(key)&&publicKey.length===value.length){prefix=value.prefix;decoded=bs58check.decode(publicKey);plainPublicKey=decoded.slice(key.length,decoded.length).toString("hex");break}}}if(!prefix||!plainPublicKey){throw new Error("invalid publicKey: ".concat(publicKey))}payload=(0,blake2b_1.hash)(Buffer.from(plainPublicKey,"hex"),20);return[2,bs58check.encode(Buffer.concat([prefix,Buffer.from(payload)]))]})})}exports.getAddressFromPublicKey=getAddressFromPublicKey;function recipientString(recipientHash,relayServer){return"@".concat(recipientHash,":").concat(relayServer)}exports.recipientString=recipientString;var toBuffer=function(message){return __awaiter(void 0,void 0,void 0,function(){var adjustedMessage,buffer;return __generator(this,function(_a){if(message.length%2!==0){return[2,(0,utf8_1.encode)(message)]}adjustedMessage=message;if(message.startsWith("0x")){adjustedMessage=message.slice(2)}buffer=Buffer.from(adjustedMessage,"hex");if(buffer.length===adjustedMessage.length/2){return[2,buffer]}return[2,(0,utf8_1.encode)(message)]})})};var coinlibhash=function(message,size){if(size===void 0){size=32}return __awaiter(void 0,void 0,void 0,function(){return __generator(this,function(_a){return[2,(0,blake2b_1.hash)(message,size)]})})};var signMessage=function(message,keypair){return __awaiter(void 0,void 0,void 0,function(){var bufferMessage,edsigPrefix,hash,rawSignature,signature;return __generator(this,function(_a){switch(_a.label){case 0:return[4,toBuffer(message)];case 1:bufferMessage=_a.sent();edsigPrefix=new Uint8Array([9,245,205,134,18]);return[4,coinlibhash(bufferMessage)];case 2:hash=_a.sent();rawSignature=(0,ed25519_3.sign)(keypair.secretKey,hash);signature=bs58check.encode(Buffer.concat([Buffer.from(edsigPrefix),Buffer.from(rawSignature)]));return[2,signature]}})})};exports.signMessage=signMessage}).call(this)}).call(this,require("buffer").Buffer)},{"@stablelib/blake2b":2,"@stablelib/bytes":3,"@stablelib/ed25519":5,"@stablelib/nacl":8,"@stablelib/random":11,"@stablelib/utf8":17,bs58check:58,buffer:55}],165:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ExposedPromise=exports.ExposedPromiseStatus=void 0;var ExposedPromiseStatus;(function(ExposedPromiseStatus){ExposedPromiseStatus["PENDING"]="pending";ExposedPromiseStatus["RESOLVED"]="resolved";ExposedPromiseStatus["REJECTED"]="rejected"})(ExposedPromiseStatus=exports.ExposedPromiseStatus||(exports.ExposedPromiseStatus={}));var notInitialized=function(){throw new Error("ExposedPromise not initialized yet.")};var ExposedPromise=function(){function ExposedPromise(){var _this=this;this._resolve=notInitialized;this._reject=notInitialized;this._status=ExposedPromiseStatus.PENDING;this._promise=new Promise(function(innerResolve,innerReject){_this._resolve=function(value){if(_this.isSettled()){return}_this._promiseResult=value;innerResolve(value);_this._status=ExposedPromiseStatus.RESOLVED;return};_this._reject=function(reason){if(_this.isSettled()){return}_this._promiseError=reason;innerReject(reason);_this._status=ExposedPromiseStatus.REJECTED;return}})}Object.defineProperty(ExposedPromise.prototype,"promise",{get:function(){return this._promise},enumerable:false,configurable:true});Object.defineProperty(ExposedPromise.prototype,"resolve",{get:function(){return this._resolve},enumerable:false,configurable:true});Object.defineProperty(ExposedPromise.prototype,"reject",{get:function(){return this._reject},enumerable:false,configurable:true});Object.defineProperty(ExposedPromise.prototype,"status",{get:function(){return this._status},enumerable:false,configurable:true});Object.defineProperty(ExposedPromise.prototype,"promiseResult",{get:function(){return this._promiseResult},enumerable:false,configurable:true});Object.defineProperty(ExposedPromise.prototype,"promiseError",{get:function(){return this._promiseError},enumerable:false,configurable:true});ExposedPromise.resolve=function(value){var promise=new ExposedPromise;promise.resolve(value);return promise};ExposedPromise.reject=function(reason){var promise=new ExposedPromise;promise.reject(reason);return promise};ExposedPromise.prototype.isPending=function(){return this.status===ExposedPromiseStatus.PENDING};ExposedPromise.prototype.isResolved=function(){return this.status===ExposedPromiseStatus.RESOLVED};ExposedPromise.prototype.isRejected=function(){return this.status===ExposedPromiseStatus.REJECTED};ExposedPromise.prototype.isSettled=function(){return this.isResolved()||this.isRejected()};return ExposedPromise}();exports.ExposedPromise=ExposedPromise},{}],166:[function(require,module,exports){(function(Buffer){(function(){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.generateGUID=void 0;var random_1=require("@stablelib/random");function generateGUID(){return __awaiter(this,void 0,void 0,function(){var buf;return __generator(this,function(_a){buf=(0,random_1.randomBytes)(16);return[2,[buf.slice(0,4),buf.slice(4,6),buf.slice(6,8),buf.slice(8,10),buf.slice(10,16)].map(function(subbuf){return Buffer.from(subbuf).toString("hex")}).join("-")]})})}exports.generateGUID=generateGUID}).call(this)}).call(this,require("buffer").Buffer)},{"@stablelib/random":11,buffer:55}],167:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.keys=void 0;function keys(obj){return Object.keys(obj)}exports.keys=keys},{}],168:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.WalletClient=void 0;var axios_1=require("axios");var beacon_core_1=require("@airgap/beacon-core");var beacon_utils_1=require("@airgap/beacon-utils");var beacon_types_1=require("@airgap/beacon-types");var WalletP2PTransport_1=require("../transports/WalletP2PTransport");var IncomingRequestInterceptor_1=require("../interceptors/IncomingRequestInterceptor");var OutgoingResponseInterceptor_1=require("../interceptors/OutgoingResponseInterceptor");var logger=new beacon_core_1.Logger("WalletClient");var WalletClient=function(_super){__extends(WalletClient,_super);function WalletClient(config){var _this=_super.call(this,__assign({storage:config&&config.storage?config.storage:new beacon_core_1.LocalStorage},config))||this;_this._isConnected=new beacon_utils_1.ExposedPromise;_this.pendingRequests=[];_this.permissionManager=new beacon_core_1.PermissionManager(_this.storage);_this.appMetadataManager=new beacon_core_1.AppMetadataManager(_this.storage);return _this}Object.defineProperty(WalletClient.prototype,"isConnected",{get:function(){return this._isConnected.promise},enumerable:false,configurable:true});WalletClient.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var keyPair,p2pTransport;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.keyPair];case 1:keyPair=_a.sent();p2pTransport=new WalletP2PTransport_1.WalletP2PTransport(this.name,keyPair,this.storage,this.matrixNodes,this.iconUrl,this.appUrl);return[2,_super.prototype.init.call(this,p2pTransport)]}})})};WalletClient.prototype.connect=function(newMessageCallback){return __awaiter(this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){this.handleResponse=function(message,connectionContext){return __awaiter(_this,void 0,void 0,function(){var typedMessage,typedMessage;return __generator(this,function(_a){switch(_a.label){case 0:if(!(message.version==="3"))return[3,4];typedMessage=message;if(typedMessage.message.type===beacon_types_1.BeaconMessageType.Disconnect){return[2,this.disconnect(typedMessage.senderId)]}if(!!this.pendingRequests.some(function(request){return request[0].id===message.id}))return[3,3];this.pendingRequests.push([typedMessage,connectionContext]);return[4,this.sendAcknowledgeResponse(typedMessage,connectionContext)];case 1:_a.sent();return[4,IncomingRequestInterceptor_1.IncomingRequestInterceptor.intercept({message:typedMessage,connectionInfo:connectionContext,appMetadataManager:this.appMetadataManager,interceptorCallback:newMessageCallback})];case 2:_a.sent();_a.label=3;case 3:return[3,8];case 4:typedMessage=message;if(typedMessage.type===beacon_types_1.BeaconMessageType.Disconnect){return[2,this.disconnect(typedMessage.senderId)]}if(!!this.pendingRequests.some(function(request){return request[0].id===message.id}))return[3,8];this.pendingRequests.push([typedMessage,connectionContext]);if(!(typedMessage.version!=="1"))return[3,6];return[4,this.sendAcknowledgeResponse(typedMessage,connectionContext)];case 5:_a.sent();_a.label=6;case 6:return[4,IncomingRequestInterceptor_1.IncomingRequestInterceptor.intercept({message:typedMessage,connectionInfo:connectionContext,appMetadataManager:this.appMetadataManager,interceptorCallback:newMessageCallback})];case 7:_a.sent();_a.label=8;case 8:return[2]}})})};return[2,this._connect()]})})};WalletClient.prototype.getRegisterPushChallenge=function(backendUrl,accountPublicKey,oracleUrl){if(oracleUrl===void 0){oracleUrl=beacon_core_1.NOTIFICATION_ORACLE_URL}return __awaiter(this,void 0,void 0,function(){var challenge,constructedString,bytes,payloadBytes;return __generator(this,function(_a){switch(_a.label){case 0:return[4,axios_1.default.get("".concat(oracleUrl,"/challenge"))];case 1:challenge=_a.sent().data;constructedString=["Tezos Signed Message: ",challenge.id,challenge.timestamp,accountPublicKey,backendUrl].join(" ");bytes=(0,beacon_utils_1.toHex)(constructedString);payloadBytes="05"+"01"+bytes.length.toString(16).padStart(8,"0")+bytes;return[2,{challenge:challenge,payloadToSign:payloadBytes}]}})})};WalletClient.prototype.registerPush=function(challenge,signature,backendUrl,accountPublicKey,protocolIdentifier,deviceId,oracleUrl){if(oracleUrl===void 0){oracleUrl=beacon_core_1.NOTIFICATION_ORACLE_URL}return __awaiter(this,void 0,void 0,function(){var tokens,token,register,newToken;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.storage.get(beacon_types_1.StorageKey.PUSH_TOKENS)];case 1:tokens=_a.sent();token=tokens.find(function(el){return el.publicKey===accountPublicKey&&el.backendUrl===backendUrl});if(token){return[2,token]}return[4,axios_1.default.post("".concat(oracleUrl,"/register"),{name:this.name,challenge:challenge,accountPublicKey:accountPublicKey,signature:signature,backendUrl:backendUrl,protocolIdentifier:protocolIdentifier,deviceId:deviceId})];case 2:register=_a.sent().data;newToken={publicKey:accountPublicKey,backendUrl:backendUrl,accessToken:register.accessToken,managementToken:register.managementToken};tokens.push(newToken);return[4,this.storage.set(beacon_types_1.StorageKey.PUSH_TOKENS,tokens)];case 3:_a.sent();return[2,newToken]}})})};WalletClient.prototype._connect=function(){return __awaiter(this,void 0,void 0,function(){var transport;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.transport];case 1:transport=_a.sent();if(!(transport.connectionStatus===beacon_types_1.TransportStatus.NOT_CONNECTED))return[3,3];return[4,transport.connect()];case 2:_a.sent();transport.addListener(function(message,connectionInfo){return __awaiter(_this,void 0,void 0,function(){var deserializedMessage;return __generator(this,function(_a){switch(_a.label){case 0:if(!(typeof message==="string"))return[3,2];return[4,(new beacon_core_1.Serializer).deserialize(message)];case 1:deserializedMessage=_a.sent();this.handleResponse(deserializedMessage,connectionInfo);_a.label=2;case 2:return[2]}})})}).catch(function(error){return logger.log("_connect",error)});this._isConnected.resolve(true);return[3,3];case 3:return[2]}})})};WalletClient.prototype.respond=function(message){return __awaiter(this,void 0,void 0,function(){var request,_a,_b,_c;var _d;var _this=this;return __generator(this,function(_e){switch(_e.label){case 0:console.log("RESPONSE",message);request=this.pendingRequests.find(function(pendingRequest){return pendingRequest[0].id===message.id});if(!request){throw new Error("No matching request found!")}this.pendingRequests=this.pendingRequests.filter(function(pendingRequest){return pendingRequest[0].id!==message.id});_b=(_a=OutgoingResponseInterceptor_1.OutgoingResponseInterceptor).intercept;_d={};_c=beacon_core_1.getSenderId;return[4,this.beaconId];case 1:return[4,_c.apply(void 0,[_e.sent()])];case 2:_d.senderId=_e.sent(),_d.request=request[0],_d.message=message;return[4,this.getOwnAppMetadata()];case 3:return[4,_b.apply(_a,[(_d.ownAppMetadata=_e.sent(),_d.permissionManager=this.permissionManager,_d.appMetadataManager=this.appMetadataManager,_d.interceptorCallback=function(response){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.respondToMessage(response,request[1])];case 1:_a.sent();return[2]}})})},_d)])];case 4:_e.sent();return[2]}})})};WalletClient.prototype.getAppMetadataList=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.appMetadataManager.getAppMetadataList()]})})};WalletClient.prototype.getAppMetadata=function(senderId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.appMetadataManager.getAppMetadata(senderId)]})})};WalletClient.prototype.removeAppMetadata=function(senderId){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.appMetadataManager.removeAppMetadata(senderId)]})})};WalletClient.prototype.removeAllAppMetadata=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.appMetadataManager.removeAllAppMetadata()]})})};WalletClient.prototype.getPermissions=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.permissionManager.getPermissions()]})})};WalletClient.prototype.getPermission=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.permissionManager.getPermission(accountIdentifier)]})})};WalletClient.prototype.removePermission=function(accountIdentifier){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.permissionManager.removePermission(accountIdentifier)]})})};WalletClient.prototype.removeAllPermissions=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,this.permissionManager.removeAllPermissions()]})})};WalletClient.prototype.addPeer=function(peer,sendPairingResponse){if(sendPairingResponse===void 0){sendPairingResponse=true}return __awaiter(this,void 0,void 0,function(){var extendedPeer,_a;var _b;return __generator(this,function(_c){switch(_c.label){case 0:_a=[__assign({},peer)];_b={};return[4,(0,beacon_core_1.getSenderId)(peer.publicKey)];case 1:extendedPeer=__assign.apply(void 0,_a.concat([(_b.senderId=_c.sent(),_b)]));return[4,this.transport];case 2:return[2,_c.sent().addPeer(extendedPeer,sendPairingResponse)]}})})};WalletClient.prototype.removePeer=function(peer,sendDisconnectToPeer){if(sendDisconnectToPeer===void 0){sendDisconnectToPeer=false}return __awaiter(this,void 0,void 0,function(){var removePeerResult;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.transport];case 1:removePeerResult=_a.sent().removePeer(peer);return[4,this.removePermissionsForPeers([peer])];case 2:_a.sent();if(!sendDisconnectToPeer)return[3,4];return[4,this.sendDisconnectToPeer(peer)];case 3:_a.sent();_a.label=4;case 4:return[2,removePeerResult]}})})};WalletClient.prototype.removeAllPeers=function(sendDisconnectToPeers){if(sendDisconnectToPeers===void 0){sendDisconnectToPeers=false}return __awaiter(this,void 0,void 0,function(){var peers,removePeerResult,disconnectPromises;var _this=this;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.transport];case 1:return[4,_a.sent().getPeers()];case 2:peers=_a.sent();return[4,this.transport];case 3:removePeerResult=_a.sent().removeAllPeers();return[4,this.removePermissionsForPeers(peers)];case 4:_a.sent();if(!sendDisconnectToPeers)return[3,6];disconnectPromises=peers.map(function(peer){return _this.sendDisconnectToPeer(peer)});return[4,Promise.all(disconnectPromises)];case 5:_a.sent();_a.label=6;case 6:return[2,removePeerResult]}})})};WalletClient.prototype.removePermissionsForPeers=function(peersToRemove){return __awaiter(this,void 0,void 0,function(){var permissions,peerIdsToRemove,permissionsToRemove,permissionIdentifiersToRemove;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.permissionManager.getPermissions()];case 1:permissions=_a.sent();peerIdsToRemove=peersToRemove.map(function(peer){return peer.senderId});permissionsToRemove=permissions.filter(function(permission){return peerIdsToRemove.includes(permission.appMetadata.senderId)});permissionIdentifiersToRemove=permissionsToRemove.map(function(permissionInfo){return permissionInfo.accountIdentifier});return[4,this.permissionManager.removePermissions(permissionIdentifiersToRemove)];case 2:_a.sent();return[2]}})})};WalletClient.prototype.sendAcknowledgeResponse=function(request,connectionContext){return __awaiter(this,void 0,void 0,function(){var acknowledgeResponse,_a,_b,_c;var _d;var _this=this;return __generator(this,function(_e){switch(_e.label){case 0:acknowledgeResponse={id:request.id,type:beacon_types_1.BeaconMessageType.Acknowledge};_b=(_a=OutgoingResponseInterceptor_1.OutgoingResponseInterceptor).intercept;_d={};_c=beacon_core_1.getSenderId;return[4,this.beaconId];case 1:return[4,_c.apply(void 0,[_e.sent()])];case 2:_d.senderId=_e.sent(),_d.request=request,_d.message=acknowledgeResponse;return[4,this.getOwnAppMetadata()];case 3:return[4,_b.apply(_a,[(_d.ownAppMetadata=_e.sent(),_d.permissionManager=this.permissionManager,_d.appMetadataManager=this.appMetadataManager,_d.interceptorCallback=function(response){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.respondToMessage(response,connectionContext)];case 1:_a.sent();return[2]}})})},_d)])];case 4:_e.sent();return[2]}})})};WalletClient.prototype.respondToMessage=function(response,connectionContext){return __awaiter(this,void 0,void 0,function(){var serializedMessage,peerInfos,peer;return __generator(this,function(_a){switch(_a.label){case 0:return[4,(new beacon_core_1.Serializer).serialize(response)];case 1:serializedMessage=_a.sent();if(!connectionContext)return[3,5];return[4,this.getPeers()];case 2:peerInfos=_a.sent();peer=peerInfos.find(function(peerInfo){return peerInfo.publicKey===connectionContext.id});return[4,this.transport];case 3:return[4,_a.sent().send(serializedMessage,peer)];case 4:_a.sent();return[3,8];case 5:return[4,this.transport];case 6:return[4,_a.sent().send(serializedMessage)];case 7:_a.sent();_a.label=8;case 8:return[2]}})})};WalletClient.prototype.disconnect=function(senderId){return __awaiter(this,void 0,void 0,function(){var transport,peers,peer;return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.transport];case 1:transport=_a.sent();return[4,transport.getPeers()];case 2:peers=_a.sent();peer=peers.find(function(peerEl){return peerEl.senderId===senderId});if(!peer)return[3,4];return[4,this.removePeer(peer)];case 3:_a.sent();_a.label=4;case 4:return[2]}})})};return WalletClient}(beacon_core_1.Client);exports.WalletClient=WalletClient},{"../interceptors/IncomingRequestInterceptor":170,"../interceptors/OutgoingResponseInterceptor":171,"../transports/WalletP2PTransport":172,"@airgap/beacon-core":113,"@airgap/beacon-types":145,"@airgap/beacon-utils":163,axios:23}],169:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(exports,p))__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:true});exports.WalletClient=void 0;__exportStar(require("@airgap/beacon-core"),exports);__exportStar(require("@airgap/beacon-transport-matrix"),exports);__exportStar(require("@airgap/beacon-types"),exports);__exportStar(require("@airgap/beacon-utils"),exports);var WalletClient_1=require("./client/WalletClient");Object.defineProperty(exports,"WalletClient",{enumerable:true,get:function(){return WalletClient_1.WalletClient}})},{"./client/WalletClient":168,"@airgap/beacon-core":113,"@airgap/beacon-transport-matrix":132,"@airgap/beacon-types":145,"@airgap/beacon-utils":163}],170:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.IncomingRequestInterceptor=void 0;var beacon_types_1=require("@airgap/beacon-types");var beacon_core_1=require("@airgap/beacon-core");var logger=new beacon_core_1.Logger("IncomingRequestInterceptor");var IncomingRequestInterceptor=function(){function IncomingRequestInterceptor(){}IncomingRequestInterceptor.intercept=function(config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){console.log("INTERCEPTING REQUEST",config.message);if(config.message.version==="2"){IncomingRequestInterceptor.handleV2Message(config)}else if(config.message.version==="3"){IncomingRequestInterceptor.handleV3Message(config)}return[2]})})};IncomingRequestInterceptor.getAppMetadata=function(appMetadataManager,senderId){return __awaiter(this,void 0,void 0,function(){var appMetadata;return __generator(this,function(_a){switch(_a.label){case 0:return[4,appMetadataManager.getAppMetadata(senderId)];case 1:appMetadata=_a.sent();if(!appMetadata){throw new Error("AppMetadata not found")}return[2,appMetadata]}})})};IncomingRequestInterceptor.handleV2Message=function(config){return __awaiter(this,void 0,void 0,function(){var message,connectionInfo,appMetadataManager,interceptorCallback,_a,request,appMetadata,request,appMetadata,request,appMetadata,request;return __generator(this,function(_b){switch(_b.label){case 0:message=config.message,connectionInfo=config.connectionInfo,appMetadataManager=config.appMetadataManager,interceptorCallback=config.interceptorCallback;_a=message.type;switch(_a){case beacon_types_1.BeaconMessageType.PermissionRequest:return[3,1];case beacon_types_1.BeaconMessageType.OperationRequest:return[3,3];case beacon_types_1.BeaconMessageType.SignPayloadRequest:return[3,5];case beacon_types_1.BeaconMessageType.BroadcastRequest:return[3,7]}return[3,9];case 1:console.log("PERMISSION REQUEST V*",message);if(message.appMetadata.beaconId&&!message.appMetadata.senderId){message.appMetadata.senderId=message.appMetadata.beaconId;delete message.appMetadata.beaconId}return[4,appMetadataManager.addAppMetadata(message.appMetadata)];case 2:_b.sent();request=message;interceptorCallback(request,connectionInfo);return[3,10];case 3:return[4,IncomingRequestInterceptor.getAppMetadata(appMetadataManager,message.senderId)];case 4:appMetadata=_b.sent();request=__assign({appMetadata:appMetadata},message);interceptorCallback(request,connectionInfo);return[3,10];case 5:return[4,IncomingRequestInterceptor.getAppMetadata(appMetadataManager,message.senderId)];case 6:appMetadata=_b.sent();request=__assign({appMetadata:appMetadata},message);interceptorCallback(request,connectionInfo);return[3,10];case 7:return[4,IncomingRequestInterceptor.getAppMetadata(appMetadataManager,message.senderId)];case 8:appMetadata=_b.sent();request=__assign({appMetadata:appMetadata},message);interceptorCallback(request,connectionInfo);return[3,10];case 9:logger.log("intercept","Message not handled");assertNever(message);_b.label=10;case 10:return[2]}})})};IncomingRequestInterceptor.handleV3Message=function(config){return __awaiter(this,void 0,void 0,function(){var msg,connectionInfo,appMetadataManager,interceptorCallback,wrappedMessage,v3Message,_a,request,request;return __generator(this,function(_b){switch(_b.label){case 0:msg=config.message,connectionInfo=config.connectionInfo,appMetadataManager=config.appMetadataManager,interceptorCallback=config.interceptorCallback;wrappedMessage=msg;v3Message=wrappedMessage.message;_a=v3Message.type;switch(_a){case beacon_types_1.BeaconMessageType.PermissionRequest:return[3,1];case beacon_types_1.BeaconMessageType.BlockchainRequest:return[3,3]}return[3,4];case 1:return[4,appMetadataManager.addAppMetadata(__assign(__assign({},v3Message.blockchainData.appMetadata),{senderId:msg.senderId}))];case 2:_b.sent();request=wrappedMessage;interceptorCallback(request,connectionInfo);return[3,5];case 3:{request=__assign({},wrappedMessage);interceptorCallback(request,connectionInfo)}return[3,5];case 4:logger.log("intercept","Message not handled");assertNever(v3Message);_b.label=5;case 5:return[2]}})})};return IncomingRequestInterceptor}();exports.IncomingRequestInterceptor=IncomingRequestInterceptor;function assertNever(_message){throw new Error("Function not implemented.")}},{"@airgap/beacon-core":113,"@airgap/beacon-types":145}],171:[function(require,module,exports){"use strict";var __assign=this&&this.__assign||function(){__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.OutgoingResponseInterceptor=void 0;var beacon_core_1=require("@airgap/beacon-core");var beacon_types_1=require("@airgap/beacon-types");var beacon_utils_1=require("@airgap/beacon-utils");var logger=new beacon_core_1.Logger("OutgoingResponseInterceptor");var OutgoingResponseInterceptor=function(){function OutgoingResponseInterceptor(){}OutgoingResponseInterceptor.intercept=function(config){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){if(config.request.version==="2"){OutgoingResponseInterceptor.handleV2Message(config)}else if(config.request.version==="3"){OutgoingResponseInterceptor.handleV3Message(config)}return[2]})})};OutgoingResponseInterceptor.handleV3Message=function(config){return __awaiter(this,void 0,void 0,function(){var msg,appMetadataManager,interceptorCallback,wrappedMessage,v3Message;return __generator(this,function(_a){msg=config.message,appMetadataManager=config.appMetadataManager,interceptorCallback=config.interceptorCallback;wrappedMessage=msg;v3Message=wrappedMessage.message;console.log("LOGGING OUTGOING V3",v3Message,appMetadataManager);interceptorCallback(msg);return[2]})})};OutgoingResponseInterceptor.handleV2Message=function(config){return __awaiter(this,void 0,void 0,function(){var senderId,request,message,ownAppMetadata,permissionManager,appMetadataManager,interceptorCallback,_a,response,errorData,response,response,publicKey,address,appMetadata,permission,response,response,response;var _b;return __generator(this,function(_c){switch(_c.label){case 0:senderId=config.senderId,request=config.request,message=config.message,ownAppMetadata=config.ownAppMetadata,permissionManager=config.permissionManager,appMetadataManager=config.appMetadataManager,interceptorCallback=config.interceptorCallback;_a=message.type;switch(_a){case beacon_types_1.BeaconMessageType.Error:return[3,1];case beacon_types_1.BeaconMessageType.Acknowledge:return[3,2];case beacon_types_1.BeaconMessageType.PermissionResponse:return[3,3];case beacon_types_1.BeaconMessageType.OperationResponse:return[3,7];case beacon_types_1.BeaconMessageType.SignPayloadResponse:return[3,8];case beacon_types_1.BeaconMessageType.BroadcastResponse:return[3,9]}return[3,10];case 1:{response={type:message.type,version:"2",senderId:senderId,id:message.id,errorType:message.errorType};if(message.errorType===beacon_types_1.BeaconErrorType.TRANSACTION_INVALID_ERROR&&message.errorData){errorData=message.errorData;if(Array.isArray(errorData)&&errorData.every(function(item){return Boolean(item.kind)&&Boolean(item.id)})){response.errorData=message.errorData}else{logger.warn("ErrorData provided is not in correct format. It needs to be an array of RPC errors. It will not be included in the message sent to the dApp")}}interceptorCallback(response);return[3,11]}_c.label=2;case 2:{response={type:message.type,version:"2",senderId:senderId,id:message.id};interceptorCallback(response);return[3,11]}_c.label=3;case 3:response=__assign({senderId:senderId,version:"2",appMetadata:ownAppMetadata},message);publicKey=response.publicKey;return[4,(0,beacon_utils_1.getAddressFromPublicKey)(publicKey)];case 4:address=_c.sent();return[4,appMetadataManager.getAppMetadata(request.senderId)];case 5:appMetadata=_c.sent();if(!appMetadata){throw new Error("AppMetadata not found")}_b={};return[4,(0,beacon_core_1.getAccountIdentifier)(address,response.network)];case 6:permission=(_b.accountIdentifier=_c.sent(),_b.senderId=request.senderId,_b.appMetadata=appMetadata,_b.website="",_b.address=address,_b.publicKey=publicKey,_b.network=response.network,_b.scopes=response.scopes,_b.connectedAt=(new Date).getTime(),_b);permissionManager.addPermission(permission).catch(console.error);interceptorCallback(response);return[3,11];case 7:{response=__assign({senderId:senderId,version:"2"},message);interceptorCallback(response)}return[3,11];case 8:{response=__assign({senderId:senderId,version:"2"},message);interceptorCallback(response)}return[3,11];case 9:{response=__assign({senderId:senderId,version:"2"},message);interceptorCallback(response)}return[3,11];case 10:logger.log("intercept","Message not handled");assertNever(message);_c.label=11;case 11:return[2]}})})};return OutgoingResponseInterceptor}();exports.OutgoingResponseInterceptor=OutgoingResponseInterceptor;function assertNever(_message){throw new Error("Function not implemented.")}},{"@airgap/beacon-core":113,"@airgap/beacon-types":145,"@airgap/beacon-utils":163}],172:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(Object.prototype.hasOwnProperty.call(b,p))d[p]=b[p]};return extendStatics(d,b)};return function(d,b){if(typeof b!=="function"&&b!==null)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});exports.WalletP2PTransport=void 0;var beacon_types_1=require("@airgap/beacon-types");var beacon_transport_matrix_1=require("@airgap/beacon-transport-matrix");var WalletP2PTransport=function(_super){__extends(WalletP2PTransport,_super);function WalletP2PTransport(name,keyPair,storage,matrixNodes,iconUrl,appUrl){return _super.call(this,name,keyPair,storage,matrixNodes,beacon_types_1.StorageKey.TRANSPORT_P2P_PEERS_WALLET,iconUrl,appUrl)||this}WalletP2PTransport.prototype.addPeer=function(newPeer,sendPairingResponse){if(sendPairingResponse===void 0){sendPairingResponse=true}return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,_super.prototype.addPeer.call(this,newPeer)];case 1:_a.sent();if(!sendPairingResponse)return[3,3];return[4,this.client.sendPairingResponse(newPeer)];case 2:_a.sent();_a.label=3;case 3:return[2]}})})};return WalletP2PTransport}(beacon_transport_matrix_1.P2PTransport);exports.WalletP2PTransport=WalletP2PTransport},{"@airgap/beacon-transport-matrix":132,"@airgap/beacon-types":145}]},{},[169])(169)});
